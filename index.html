<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Mom Method - AI Interactive Calendar Wizard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --sage-green: #6B8E6B;
            --warm-cream: #FAF7F0;
            --deep-teal: #2D5B69;
            --charcoal: #2C3E50;
            --soft-gold: #D4A574;
            --light-sage: #E8F5E8;
            --sage-alpha: rgba(107, 142, 107, 0.1);
            --teal-alpha: rgba(45, 91, 105, 0.1);
            --gold-alpha: rgba(212, 165, 116, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--charcoal);
            background: var(--warm-cream);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Authentication Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }

        .auth-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .auth-content {
            background: white;
            border-radius: 24px;
            padding: 50px;
            max-width: 500px;
            width: 90%;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.4s ease;
        }

        .auth-modal.active .auth-content {
            transform: translateY(0);
        }

        .auth-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--charcoal);
            opacity: 0.7;
        }

        .auth-close:hover {
            opacity: 1;
        }

        .auth-title {
            font-family: 'Playfair Display', serif;
            color: var(--sage-green);
            margin-bottom: 32px;
            font-size: 2rem;
            text-align: center;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .auth-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--light-sage);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .auth-input:focus {
            outline: none;
            border-color: var(--sage-green);
            box-shadow: 0 0 0 4px var(--sage-alpha);
        }

        .auth-button {
            background: linear-gradient(135deg, var(--sage-green), #5A7A5A);
            color: white;
            padding: 18px 36px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(107, 142, 107, 0.35);
        }

        .auth-switch {
            text-align: center;
            margin-top: 24px;
            color: var(--charcoal);
            opacity: 0.8;
        }

        .auth-link {
            color: var(--sage-green);
            cursor: pointer;
            text-decoration: underline;
        }

        .auth-error {
            background: #ffebee;
            border: 1px solid #e57373;
            color: #c62828;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .auth-success {
            background: #e8f5e8;
            border: 1px solid var(--sage-green);
            color: var(--sage-green);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        /* Welcome Modal */
        .welcome-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 1;
            visibility: visible;
            transition: all 0.4s ease;
        }

        .welcome-modal.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .welcome-content {
            background: white;
            border-radius: 24px;
            padding: 60px 50px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            transform: translateY(0);
            transition: transform 0.4s ease;
            box-shadow: 0 30px 80px rgba(44, 62, 80, 0.2);
        }

        .welcome-content h2 {
            font-family: 'Playfair Display', serif;
            color: var(--sage-green);
            margin-bottom: 24px;
            font-size: 2.4rem;
            font-weight: 600;
        }

        .welcome-content p {
            color: var(--charcoal);
            margin-bottom: 40px;
            font-size: 1.1rem;
            line-height: 1.7;
            opacity: 0.8;
        }

        .welcome-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .welcome-btn {
            padding: 18px 36px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
            font-family: 'Inter', sans-serif;
        }

        .welcome-btn.primary {
            background: linear-gradient(135deg, var(--sage-green), #5A7A5A);
            color: white;
            box-shadow: 0 8px 24px rgba(107, 142, 107, 0.3);
        }

        .welcome-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(107, 142, 107, 0.4);
        }

        .welcome-btn.secondary {
            background: var(--deep-teal);
            color: white;
        }

        .welcome-btn.secondary:hover {
            background: #1E3D47;
            transform: translateY(-2px);
        }

        .welcome-btn.auth {
            background: var(--soft-gold);
            color: white;
        }

        .welcome-btn.auth:hover {
            background: #C79660;
            transform: translateY(-2px);
        }

        /* Language Selection */
        .language-selector {
            text-align: center;
            margin-bottom: 40px;
            padding: 32px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(44, 62, 80, 0.08);
        }

        .language-selector h2 {
            margin-bottom: 24px;
            color: var(--charcoal);
            font-size: 1.6rem;
            font-weight: 600;
        }

        .language-buttons {
            display: flex;
            gap: 24px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .language-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 40px;
            background: var(--sage-green);
            color: white;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 200px;
            box-shadow: 0 6px 20px rgba(107, 142, 107, 0.25);
        }

        .language-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(107, 142, 107, 0.35);
        }

        .language-btn.active {
            background: var(--soft-gold);
            transform: translateY(-2px);
        }

        .language-btn .flag {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .language-btn small {
            margin-top: 8px;
            opacity: 0.9;
        }

        /* Progress Container */
        .progress-container {
            background: white;
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 8px 32px rgba(44, 62, 80, 0.08);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .step-counter {
            font-weight: 700;
            color: var(--sage-green);
            font-size: 1.3rem;
        }

        .time-estimate {
            background: var(--soft-gold);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .overall-progress {
            width: 100%;
            height: 12px;
            background: var(--light-sage);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 32px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--sage-green), var(--deep-teal));
            transition: width 0.5s ease;
            border-radius: 6px;
            width: 14.29%;
        }

        .progress-bar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 16px;
            margin-bottom: 0;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 16px;
            border-radius: 16px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--sage-alpha);
        }
        
        .progress-step:hover {
            background: var(--teal-alpha);
            transform: translateY(-2px);
        }

        .progress-step.active {
            background: var(--sage-green);
            color: white;
        }

        .progress-step.completed {
            background: var(--deep-teal);
            color: white;
        }

        .progress-step.next {
            background: var(--soft-gold);
            color: white;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-number {
            background: rgba(255, 255, 255, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .step-text {
            font-size: 0.9rem;
            text-align: center;
            font-weight: 600;
        }

        /* Main Card */
        .main-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 16px 48px rgba(44, 62, 80, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--sage-green), var(--deep-teal));
            color: white;
            padding: 60px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 8s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
            font-weight: 600;
        }

        .header .subtitle {
            font-size: 1.3rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 400;
        }

        .badge {
            display: inline-block;
            background: var(--soft-gold);
            color: white;
            padding: 12px 28px;
            border-radius: 30px;
            font-weight: 700;
            margin-top: 24px;
            font-size: 1rem;
            position: relative;
            z-index: 1;
        }

        .header .cta-section {
            margin-top: 40px;
            position: relative;
            z-index: 1;
        }

        .btn-current {
            background: linear-gradient(135deg, var(--soft-gold), #C79660);
            color: white;
            box-shadow: 0 8px 24px rgba(212, 165, 116, 0.3);
            font-size: 1.2rem;
            padding: 20px 40px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-current:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(212, 165, 116, 0.4);
        }

        .content {
            padding: 50px 40px;
        }

        .step-description {
            background: var(--light-sage);
            padding: 32px;
            border-radius: 16px;
            margin-bottom: 40px;
            border-left: 6px solid var(--sage-green);
        }

        .step-description h2 {
            font-family: 'Playfair Display', serif;
            color: var(--charcoal);
            margin-bottom: 16px;
            font-size: 2rem;
            font-weight: 600;
        }

        .step-description p {
            color: var(--charcoal);
            font-size: 1.1rem;
            opacity: 0.8;
        }

        .empowerment-message {
            background: linear-gradient(135deg, var(--gold-alpha), rgba(212, 165, 116, 0.15));
            border: 2px solid var(--soft-gold);
            border-radius: 20px;
            padding: 32px;
            margin: 32px 0;
            text-align: center;
        }

        .empowerment-title {
            color: var(--charcoal);
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 16px;
            font-family: 'Playfair Display', serif;
        }

        .empowerment-text {
            color: var(--charcoal);
            line-height: 1.7;
            opacity: 0.9;
        }

        /* Initial Step */
        .initial-step {
            margin-bottom: 40px;
            padding: 40px;
            background: white;
            border-radius: 20px;
            border: 2px solid var(--light-sage);
            box-shadow: 0 4px 16px rgba(107, 142, 107, 0.08);
        }

        .initial-step h2 {
            font-family: 'Playfair Display', serif;
            color: var(--charcoal);
            margin-bottom: 32px;
            font-size: 1.8rem;
            font-weight: 600;
            text-align: center;
        }

        .form-group {
            margin-bottom: 28px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--charcoal);
            font-size: 1rem;
        }

        .required {
            color: var(--soft-gold);
            margin-left: 4px;
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--light-sage);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            background: var(--warm-cream);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--sage-green);
            box-shadow: 0 0 0 4px var(--sage-alpha);
            background: white;
        }

        .validation-message {
            margin-top: 8px;
            font-size: 14px;
            color: #e57373;
        }

        .validation-message.success {
            color: var(--sage-green);
        }

        /* Path Selection */
        .path-selection {
            margin: 50px 0;
            text-align: center;
        }

        .path-selection h2 {
            font-family: 'Playfair Display', serif;
            color: var(--charcoal);
            margin-bottom: 40px;
            font-size: 2.2rem;
            font-weight: 600;
        }

        .path-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .path-option {
            background: var(--warm-cream);
            border-radius: 20px;
            padding: 40px 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            text-align: center;
        }

        .path-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(107, 142, 107, 0.2);
            border-color: var(--sage-green);
        }

        .path-option.selected {
            border-color: var(--soft-gold);
            background: white;
            transform: translateY(-3px);
            box-shadow: 0 12px 36px rgba(212, 165, 116, 0.25);
        }

        .path-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            display: block;
        }

        .path-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 16px;
        }

        .path-description {
            color: var(--charcoal);
            opacity: 0.8;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .continue-btn {
            background: linear-gradient(135deg, var(--sage-green), #5A7A5A);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        .continue-btn.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(107, 142, 107, 0.3);
        }

        .hidden {
            display: none !important;
        }

        /* AI Process Steps */
        .ai-step {
            display: flex;
            align-items: center;
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            background: var(--warm-cream);
            border: 2px solid var(--light-sage);
            transition: all 0.3s ease;
        }

        .ai-step.processing {
            border-color: var(--soft-gold);
            background: rgba(212, 165, 116, 0.1);
        }

        .ai-step.completed {
            border-color: var(--sage-green);
            background: var(--light-sage);
        }

        .ai-step-icon {
            font-size: 2rem;
            margin-right: 20px;
            min-width: 60px;
            text-align: center;
        }

        .ai-step-content {
            flex: 1;
        }

        .ai-step-content h4 {
            margin: 0 0 8px 0;
            color: var(--charcoal);
            font-weight: 600;
        }

        .ai-step-content p {
            margin: 0;
            color: var(--charcoal);
            opacity: 0.8;
        }

        .ai-step-status {
            font-weight: 600;
            color: var(--soft-gold);
            min-width: 120px;
            text-align: right;
        }

        .ai-step.processing .ai-step-status {
            color: var(--soft-gold);
        }

        .ai-step.completed .ai-step-status {
            color: var(--sage-green);
        }

        .ai-step.completed .ai-step-icon {
            color: var(--sage-green);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .header .subtitle {
                font-size: 1.1rem;
            }
            
            .content {
                padding: 30px 20px;
            }
            
            .progress-bar {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }

            .progress-step {
                padding: 12px 8px;
            }

            .step-text {
                font-size: 0.7rem;
            }

            .language-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .language-btn {
                min-width: 280px;
            }

            .welcome-content {
                padding: 40px 30px;
            }

            .welcome-buttons {
                flex-direction: column;
            }

            .form-control {
                font-size: 16px;
                padding: 18px;
            }

            .auth-content {
                padding: 30px 20px;
            }

            .path-options {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .path-option {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-content">
            <button class="auth-close" onclick="closeAuthModal()">&times;</button>
            <h2 class="auth-title" id="authTitle">Create Your Account</h2>
            
            <div id="authError" class="auth-error hidden"></div>
            <div id="authSuccess" class="auth-success hidden"></div>
            
            <form class="auth-form" id="authForm">
                <input type="text" id="authName" class="auth-input" placeholder="Your Name" style="display: none;">
                <input type="email" id="authEmail" class="auth-input" placeholder="Email Address" required>
                <input type="password" id="authPassword" class="auth-input" placeholder="Password" required>
                <input type="password" id="authConfirmPassword" class="auth-input" placeholder="Confirm Password" style="display: none;">
                
                <button type="submit" class="auth-button" id="authSubmitBtn">Create Account</button>
            </form>
            
            <div class="auth-switch">
                <span id="authSwitchText">Already have an account?</span>
                <span class="auth-link" id="authSwitchLink" onclick="toggleAuthMode()">Sign In</span>
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeModal" class="welcome-modal">
        <div class="welcome-content">
            <h2 id="welcomeTitle">Welcome to Smart Mom Method!</h2>
            <p id="welcomeDescription">Create your personalized interactive calendar in 7 simple steps. This process will take approximately 20-25 minutes and will generate a comprehensive interactive calendar and plan tailored specifically for busy moms like you.</p>
            <div class="welcome-buttons">
                <button class="welcome-btn primary" onclick="startOnboarding()">
                    üöÄ <span id="welcomeStart">Get Started</span>
                </button>
                <button class="welcome-btn auth" onclick="showAuthModal('signup')">
                    üíæ <span id="welcomeCreate">Create Account & Save Progress</span>
                </button>
                <button class="welcome-btn secondary" onclick="handleReturningUser()">
                    <span id="welcomeReturning">I'm a returning user</span>
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Language Selection -->
        <div class="language-selector">
            <h2 id="languageTitle">Choose Your Language / Elige Tu Idioma</h2>
            <div class="language-buttons">
                <button class="language-btn" onclick="changeLanguage('en')" id="lang-en">
                    <span class="flag">üá∫üá∏</span>
                    <span>English</span>
                    <small>Read and answer everything in English</small>
                </button>
                <button class="language-btn active" onclick="changeLanguage('es')" id="lang-es">
                    <span class="flag">üá™üá∏</span>
                    <span>Espa√±ol</span>
                    <small>Lee y responde todo en espa√±ol</small>
                </button>
            </div>
        </div>

        <!-- Progress Container -->
        <div class="progress-container">
            <div class="progress-header">
                <div class="step-counter" id="stepCounter">Step 1 of 7</div>
                <div class="time-estimate" id="timeEstimate">‚è±Ô∏è Estimated: 5 min</div>
            </div>
            <div class="overall-progress">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-bar">
                <div class="progress-step active" id="step-1">
                    <span class="step-number">1</span>
                    <span class="step-text" id="stepText1">Collect Information</span>
                </div>
                <div class="progress-step next" id="step-2">
                    <span class="step-number">2</span>
                    <span class="step-text" id="stepText2">ChatGPT</span>
                </div>
                <div class="progress-step" id="step-3">
                    <span class="step-number">3</span>
                    <span class="step-text" id="stepText3">Gemini</span>
                </div>
                <div class="progress-step" id="step-3-5">
                    <span class="step-number">3.5</span>
                    <span class="step-text" id="stepText3_5">Pricing Research</span>
                </div>
                <div class="progress-step" id="step-4">
                    <span class="step-number">4</span>
                    <span class="step-text" id="stepText4">Claude</span>
                </div>
                <div class="progress-step" id="step-5">
                    <span class="step-number">5</span>
                    <span class="step-text" id="stepText5">Optimize</span>
                </div>
                <div class="progress-step" id="step-6">
                    <span class="step-number">6</span>
                    <span class="step-text" id="stepText6">Complete</span>
                </div>
            </div>
        </div>

        <div class="main-card">
            <div class="header">
                <h1 id="mainTitle">Smart Mom Method</h1>
                <p class="subtitle" id="mainSubtitle">AI-Powered Interactive Calendar for Busy Moms</p>
                <span class="badge" id="freeBadge">100% Free</span>
                
                <div class="cta-section">
                    <button class="btn-current" onclick="scrollToForm()">
                        üöÄ <span id="ctaButton">Start Your Free Interactive Calendar Now</span>
                    </button>
                    <p style="margin-top: 16px; font-size: 0.95rem; opacity: 0.9;" id="ctaSubtext">No email required to browse ‚Ä¢ Full process takes 20-25 minutes</p>
                </div>
            </div>

            <div class="content">
                <div class="step-description">
                    <h2 id="stepDescTitle">üëã Let's Get Started</h2>
                    <p id="stepDescText">First, let's get to know you better so we can create the perfect interactive calendar for your unique situation.</p>
                </div>

                <div class="empowerment-message">
                    <div class="empowerment-title" id="empowermentTitle">You're Already Successful! üåü</div>
                    <p class="empowerment-text" id="empowermentText">Managing a family is running a complex organization. You have negotiation skills, time management expertise, and crisis resolution abilities that most CEOs would envy. Now let's channel that into YOUR organized life and interactive calendar!</p>
                </div>

                <!-- Initial Step: Name & Email -->
                <div class="initial-step" id="initialStep">
                    <h2 id="initialStepTitle">üëã Let's Get Started</h2>
                    
                    <div class="form-group">
                        <label id="nameLabel">Your Name: <span class="required">*</span></label>
                        <input type="text" id="user-name" class="form-control" placeholder="Enter your name" onchange="validateField(this)" />
                        <div class="validation-message" id="user-name-validation"></div>
                    </div>

                    <div class="form-group">
                        <label id="emailLabel">Your Email: <span class="required">*</span></label>
                        <input type="email" id="user-email" class="form-control" placeholder="your.email@example.com" onchange="validateField(this)" />
                        <div class="validation-message" id="user-email-validation"></div>
                    </div>
                </div>

                <!-- Path Selection -->
                <div class="path-selection hidden" id="pathSelection">
                    <h2 id="pathSelectionTitle">What brings you here today? Choose your main focus:</h2>
                    
                    <div class="path-options">
                        <div class="path-option" data-path="life-organization" onclick="selectPath('life-organization')">
                            <span class="path-icon">üè†</span>
                            <h3 class="path-title" id="pathTitle1">Life Organization</h3>
                            <p class="path-description" id="pathDesc1">I need help organizing my daily life, family schedules, and home systems</p>
                        </div>
                        
                        <div class="path-option" data-path="business-launch" onclick="selectPath('business-launch')">
                            <span class="path-icon">üíº</span>
                            <h3 class="path-title" id="pathTitle2">Business Launch</h3>
                            <p class="path-description" id="pathDesc2">I want to start a business or create passive income streams</p>
                        </div>
                        
                        <div class="path-option" data-path="both" onclick="selectPath('both')">
                            <span class="path-icon">‚òÄÔ∏è</span>
                            <h3 class="path-title" id="pathTitle3">Both Life & Business</h3>
                            <p class="path-description" id="pathDesc3">I need life organization AND want to start a business</p>
                        </div>
                    </div>
                    
                    <button class="continue-btn" id="continueBtn" onclick="proceedWithSelectedPath()">
                        <span id="continueBtnText">Continue With Selected Path</span>
                    </button>
                </div>

                <!-- Success Message -->
                <div id="successMessage" class="hidden">
                    <div class="step-description">
                        <h2>üéâ Path Selected Successfully!</h2>
                        <p>Perfect! You've selected the <strong id="selectedPathDisplay"></strong> path. Now let's create your personalized interactive calendar with AI assistance.</p>
                        
                        <div style="background: var(--light-sage); padding: 20px; border-radius: 12px; margin-top: 20px;">
                            <h3>What happens next:</h3>
                            <ol style="margin: 15px 0; padding-left: 20px;">
                                <li><strong>AI Analysis:</strong> Analyze your schedule and goals</li>
                                <li><strong>Calendar Generation:</strong> Create your interactive calendar</li>
                                <li><strong>Time Optimization:</strong> Optimize your daily routines</li>
                                <li><strong>Action Plan:</strong> Build your step-by-step plan</li>
                                <li><strong>Download Ready:</strong> Get your interactive calendar</li>
                            </ol>
                        </div>
                        
                        <button class="continue-btn visible" onclick="startAIProcess()" style="opacity: 1; pointer-events: all; transform: translateY(0);">
                            üöÄ Generate My Interactive Calendar
                        </button>
                        
                        <button class="continue-btn visible" onclick="startOver()" style="opacity: 1; pointer-events: all; transform: translateY(0); background: var(--deep-teal); margin-left: 10px;">
                            üîÑ Choose Different Path
                        </button>
                    </div>
                </div>

                <!-- AI Process Steps -->
                <div id="aiProcessSteps" class="hidden">
                    <div class="step-description">
                        <h2>ü§ñ AI-Powered Interactive Calendar Generation</h2>
                        <p>We're creating your personalized interactive calendar and life organization system using advanced AI. This process takes just a few minutes.</p>
                    </div>

                    <div id="aiProgress" style="background: white; padding: 30px; border-radius: 20px; border: 2px solid var(--light-sage); margin: 20px 0;">
                        <h3 style="margin-bottom: 20px;">Calendar Generation Progress:</h3>
                        
                        <div class="ai-step" id="ai-step-1">
                            <div class="ai-step-icon">‚è≥</div>
                            <div class="ai-step-content">
                                <h4>Step 1: Analyzing Your Schedule & Goals</h4>
                                <p>Processing your daily routine, family needs, and priorities...</p>
                            </div>
                            <div class="ai-step-status">In Progress...</div>
                        </div>

                        <div class="ai-step" id="ai-step-2">
                            <div class="ai-step-icon">‚è≥</div>
                            <div class="ai-step-content">
                                <h4>Step 2: Creating Your Interactive Calendar</h4>
                                <p>Building personalized time blocks and daily schedules...</p>
                            </div>
                            <div class="ai-step-status">Waiting...</div>
                        </div>

                        <div class="ai-step" id="ai-step-3">
                            <div class="ai-step-icon">‚è≥</div>
                            <div class="ai-step-content">
                                <h4>Step 3: Optimizing Time Management</h4>
                                <p>Fine-tuning routines for maximum efficiency...</p>
                            </div>
                            <div class="ai-step-status">Waiting...</div>
                        </div>

                        <div class="ai-step" id="ai-step-4">
                            <div class="ai-step-icon">‚è≥</div>
                            <div class="ai-step-content">
                                <h4>Step 4: Finalizing Your Action Plan</h4>
                                <p>Creating step-by-step implementation guide...</p>
                            </div>
                            <div class="ai-step-status">Waiting...</div>
                        </div>
                    </div>
                </div>

                <!-- Final Completion -->
                <div id="completionSection" class="hidden">
                    <div style="background: linear-gradient(135deg, var(--sage-green), var(--deep-teal)); color: white; padding: 60px 40px; text-align: center; border-radius: 24px; margin: 40px 0; position: relative; overflow: hidden;">
                        <h2 style="font-family: 'Playfair Display', serif; font-size: 2.5rem; margin-bottom: 20px;">üéâ Congratulations!</h2>
                        <p style="font-size: 1.2rem; margin-bottom: 30px; opacity: 0.9;">Your personalized Smart Mom interactive calendar is ready!</p>
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 30px; border-radius: 16px; margin: 30px 0;">
                            <h3 style="margin-bottom: 15px;">Your Interactive Calendar Includes:</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="margin: 10px 0;">üìÖ Personalized daily schedule blocks</li>
                                <li style="margin: 10px 0;">‚è∞ Optimized time management system</li>
                                <li style="margin: 10px 0;">üéØ Goal-oriented task organization</li>
                                <li style="margin: 10px 0;">üìã Interactive checklist templates</li>
                                <li style="margin: 10px 0;">üîÑ Family routine optimization</li>
                            </ul>
                        </div>

                        <button onclick="downloadCalendar()" style="background: var(--soft-gold); color: white; padding: 20px 40px; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: 600; cursor: pointer; margin: 10px;">
                            üì• Download Your Interactive Calendar
                        </button>
                        
                        <button onclick="emailCalendar()" style="background: white; color: var(--sage-green); padding: 20px 40px; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: 600; cursor: pointer; margin: 10px;">
                            üìß Email Me My Calendar
                        </button>
                    </div>

                    <div style="background: var(--light-sage); padding: 30px; border-radius: 20px; text-align: center;">
                        <h3>Thank you for using Smart Mom Method! üåü</h3>
                        <p>Your journey to an organized life and successful business starts now. We're here to support you every step of the way.</p>
                        
                        <div style="margin-top: 20px;">
                            <button onclick="provideFeedback()" style="background: var(--sage-green); color: white; padding: 15px 30px; border: none; border-radius: 8px; margin: 5px; cursor: pointer;">
                                üí¨ Share Feedback
                            </button>
                            <button onclick="startOver()" style="background: var(--deep-teal); color: white; padding: 15px 30px; border: none; border-radius: 8px; margin: 5px; cursor: pointer;">
                                üîÑ Create Another Plan
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentLanguage = 'en';
        let currentStep = 1;
        let selectedPath = '';
        let authMode = 'signup';

        // Translation data
        const translations = {
            en: {
                welcomeTitle: "Welcome to Smart Mom Method!",
                welcomeDescription: "Create your personalized interactive calendar in 7 simple steps. This process will take approximately 20-25 minutes and will generate a comprehensive interactive calendar and plan tailored specifically for busy moms like you.",
                welcomeStart: "Get Started",
                welcomeCreate: "Create Account & Save Progress",
                welcomeReturning: "I'm a returning user",
                languageTitle: "Choose Your Language / Elige Tu Idioma",
                stepCounter: "Step 1 of 7",
                timeEstimate: "‚è±Ô∏è Estimated: 5 min",
                mainTitle: "Smart Mom Method",
                mainSubtitle: "AI-Powered Interactive Calendar for Busy Moms",
                freeBadge: "100% Free",
                ctaButton: "Start Your Free Interactive Calendar Now",
                ctaSubtext: "No email required to browse ‚Ä¢ Full process takes 20-25 minutes",
                stepDescTitle: "üëã Let's Get Started",
                stepDescText: "First, let's get to know you better so we can create the perfect interactive calendar for your unique situation.",
                empowermentTitle: "You're Already Successful! üåü",
                empowermentText: "Managing a family is running a complex organization. You have negotiation skills, time management expertise, and crisis resolution abilities that most CEOs would envy. Now let's channel that into YOUR organized life and interactive calendar!",
                initialStepTitle: "üëã Let's Get Started",
                nameLabel: "Your Name:",
                emailLabel: "Your Email:",
                pathSelectionTitle: "What brings you here today? Choose your main focus:",
                pathTitle1: "Life Organization",
                pathDesc1: "I need help organizing my daily life, family schedules, and home systems",
                pathTitle2: "Business Launch",
                pathDesc2: "I want to start a business or create passive income streams",
                pathTitle3: "Both Life & Business",
                pathDesc3: "I need life organization AND want to start a business",
                continueBtnText: "Continue With Selected Path"
            },
            es: {
                welcomeTitle: "¬°Bienvenida al M√©todo Smart Mom!",
                welcomeDescription: "Crea tu calendario interactivo personalizado en 7 pasos simples. Este proceso tomar√° aproximadamente 20-25 minutos y generar√° un calendario interactivo y plan integral dise√±ado espec√≠ficamente para mam√°s ocupadas como t√∫.",
                welcomeStart: "Comenzar",
                welcomeCreate: "Crear Cuenta y Guardar Progreso",
                welcomeReturning: "Soy usuaria recurrente",
                languageTitle: "Elige Tu Idioma / Choose Your Language",
                stepCounter: "Paso 1 de 7",
                timeEstimate: "‚è±Ô∏è Estimado: 5 min",
                mainTitle: "M√©todo Smart Mom",
                mainSubtitle: "Calendario Interactivo con IA para Mam√°s Ocupadas",
                freeBadge: "100% Gratis",
                ctaButton: "Inicia Tu Calendario Interactivo Gratis Ahora",
                ctaSubtext: "No se requiere email para navegar ‚Ä¢ El proceso completo toma 20-25 minutos",
                stepDescTitle: "üëã ¬°Comencemos!",
                stepDescText: "Primero, conozc√°monos mejor para poder crear el calendario interactivo perfecto para tu situaci√≥n √∫nica.",
                empowermentTitle: "¬°Ya Eres Exitosa! üåü",
                empowermentText: "Manejar una familia es dirigir una organizaci√≥n compleja. Tienes habilidades de negociaci√≥n, experiencia en gesti√≥n del tiempo y capacidades de resoluci√≥n de crisis que la mayor√≠a de los CEOs envidiar√≠an. ¬°Ahora canalizemos eso hacia TU vida organizada y calendario interactivo!",
                initialStepTitle: "üëã ¬°Comencemos!",
                nameLabel: "Tu Nombre:",
                emailLabel: "Tu Correo Electr√≥nico:",
                pathSelectionTitle: "¬øQu√© te trae aqu√≠ hoy? Elige tu enfoque principal:",
                pathTitle1: "Organizaci√≥n de Vida",
                pathDesc1: "Necesito ayuda organizando mi vida diaria, horarios familiares y sistemas del hogar",
                pathTitle2: "Lanzamiento de Negocio",
                pathDesc2: "Quiero iniciar un negocio o crear fuentes de ingresos pasivos",
                pathTitle3: "Ambos: Vida y Negocio",
                pathDesc3: "Necesito organizaci√≥n de vida Y quiero iniciar un negocio",
                continueBtnText: "Continuar con el Camino Seleccionado"
            }
        };

        // Initialize the application
        function initializeApp() {
            updateUIText();
            checkInitialFields();
            
            // Add auth form submission handler
            document.getElementById('authForm').addEventListener('submit', handleAuthSubmit);
            
            // Show setup message in console
            console.log('üöÄ SMART MOM METHOD - FIXED VERSION LOADED');
            console.log('‚úÖ All CORS errors are now non-blocking');
            console.log('‚úÖ localStorage fallback system active');
            console.log('‚úÖ All console errors fixed');
            console.log('‚úÖ Interactive calendar focus throughout');
            console.log('üìß Webhooks are non-blocking - failures won\'t break user experience');
        }

        // Utility function for safe webhook calls
        async function safeWebhookCall(url, data, description = 'webhook') {
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    console.log(`‚úÖ ${description} sent successfully`);
                } else {
                    console.log(`‚ö†Ô∏è ${description} responded with status ${response.status} - continuing anyway`);
                }
            } catch (error) {
                console.log(`‚ö†Ô∏è ${description} failed (likely CORS) - continuing anyway:`, error.message);
                // Don't throw - let the user experience continue
            }
        }

        // Authentication Functions
        async function handleAuthSubmit(e) {
            e.preventDefault();
            
            const email = document.getElementById('authEmail').value.trim();
            const password = document.getElementById('authPassword').value;
            const name = document.getElementById('authName').value.trim();
            const confirmPassword = document.getElementById('authConfirmPassword').value;
            
            const errorDiv = document.getElementById('authError');
            const successDiv = document.getElementById('authSuccess');
            const submitBtn = document.getElementById('authSubmitBtn');
            
            // Clear previous messages
            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
            
            // Validation
            if (!email || !password) {
                showAuthError('Please fill in all required fields.');
                return;
            }
            
            const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            if (!emailValid) {
                showAuthError('Please enter a valid email address.');
                return;
            }
            
            if (authMode === 'signup') {
                if (!name) {
                    showAuthError('Please enter your name.');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showAuthError('Passwords do not match.');
                    return;
                }
                
                if (password.length < 6) {
                    showAuthError('Password must be at least 6 characters long.');
                    return;
                }
            }
            
            // Show loading state
            submitBtn.textContent = authMode === 'signup' ? 'Creating Account...' : 'Signing In...';
            submitBtn.disabled = true;
            
            try {
                if (authMode === 'signup') {
                    await handleSignup(email, password, name);
                } else {
                    await handleSignin(email, password);
                }
            } catch (error) {
                console.error('Auth error:', error);
                showAuthError('An error occurred. Please try again.');
            }
            
            // Reset button
            submitBtn.textContent = authMode === 'signup' ? 'Create Account' : 'Sign In';
            submitBtn.disabled = false;
        }

        async function handleSignup(email, password, name) {
            // Create simple password hash (in production, use proper hashing)
            const passwordHash = btoa(password); // Basic encoding - use proper hashing in production
            
            const userData = {
                email: email,
                name: name,
                selectedPath: '',
                currentStep: 1,
                language: currentLanguage,
                formData: {},
                passwordHash: passwordHash,
                createdAt: new Date().toISOString()
            };
            
            // Check localStorage for existing users
            const localUsers = JSON.parse(localStorage.getItem('smartMomUsers') || '{}');
            if (localUsers[email]) {
                showAuthError('An account with this email already exists. Please sign in instead.');
                return;
            }
            
            // Save to localStorage (guaranteed to work)
            localUsers[email] = userData;
            localStorage.setItem('smartMomUsers', JSON.stringify(localUsers));
            
            showAuthSuccess('Account created successfully! Your progress will be saved locally.');
            
            // Send welcome email webhook (non-blocking)
            safeWebhookCall('https://momsurvivaltoolkit.app.n8n.cloud/webhook-test/smart-mom-welcome', {
                email: userData.email,
                name: userData.name,
                trigger_welcome_email: 'true',
                account_created: 'true',
                language: userData.language,
                timestamp: new Date().toISOString()
            }, 'Welcome email');
            
            // Auto-fill the main form
            document.getElementById('user-name').value = name;
            document.getElementById('user-email').value = email;
            
            // Close modal after delay
            setTimeout(() => {
                closeAuthModal();
                checkInitialFields();
            }, 2000);
        }

        async function handleSignin(email, password) {
            const localUsers = JSON.parse(localStorage.getItem('smartMomUsers') || '{}');
            const userData = localUsers[email];
            
            if (!userData) {
                showAuthError('No account found with this email address.');
                return;
            }
            
            // Check password (basic comparison - use proper verification in production)
            const storedHash = userData.passwordHash || '';
            const passwordHash = btoa(password);
            
            if (storedHash !== passwordHash) {
                showAuthError('Incorrect password.');
                return;
            }
            
            showAuthSuccess(`Welcome back, ${userData.name}!`);
            
            // Load user progress
            setTimeout(() => {
                loadUserProgress(userData);
                closeAuthModal();
            }, 1500);
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function showAuthSuccess(message) {
            const successDiv = document.getElementById('authSuccess');
            successDiv.textContent = message;
            successDiv.classList.remove('hidden');
        }

        // Language Functions
        function changeLanguage(lang) {
            currentLanguage = lang;
            
            // Update active language button
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${lang}`).classList.add('active');
            
            updateUIText();
        }

        function updateUIText() {
            const t = translations[currentLanguage];
            
            // Update all text elements
            Object.keys(t).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = t[key];
                }
            });
            
            // Update placeholders
            const placeholders = {
                'user-name': currentLanguage === 'es' ? 'Ingresa tu nombre' : 'Enter your name',
                'user-email': currentLanguage === 'es' ? 'tu.correo@ejemplo.com' : 'your.email@example.com'
            };
            
            Object.entries(placeholders).forEach(([id, text]) => {
                const element = document.getElementById(id);
                if (element) element.placeholder = text;
            });
        }

        // Modal Functions
        function startOnboarding() {
            document.getElementById('welcomeModal').classList.add('hidden');
        }

        function showAuthModal(mode) {
            authMode = mode;
            const modal = document.getElementById('authModal');
            const title = document.getElementById('authTitle');
            const submitBtn = document.getElementById('authSubmitBtn');
            const switchText = document.getElementById('authSwitchText');
            const switchLink = document.getElementById('authSwitchLink');
            const nameField = document.getElementById('authName');
            const confirmField = document.getElementById('authConfirmPassword');

            if (mode === 'signup') {
                title.textContent = 'Create Your Account';
                submitBtn.textContent = 'Create Account';
                switchText.textContent = 'Already have an account?';
                switchLink.textContent = 'Sign In';
                nameField.style.display = 'block';
                confirmField.style.display = 'block';
            } else {
                title.textContent = 'Sign In';
                submitBtn.textContent = 'Sign In';
                switchText.textContent = "Don't have an account?";
                switchLink.textContent = 'Create Account';
                nameField.style.display = 'none';
                confirmField.style.display = 'none';
            }

            modal.classList.add('active');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
        }

        function toggleAuthMode() {
            showAuthModal(authMode === 'signup' ? 'signin' : 'signup');
        }

        async function handleReturningUser() {
            document.getElementById('welcomeModal').classList.add('hidden');
            
            // Create a better input modal instead of using prompt
            const modal = document.createElement('div');
            modal.className = 'auth-modal active';
            modal.id = 'returningUserModal';
            
            modal.innerHTML = `
                <div class="auth-content">
                    <button class="auth-close" onclick="closeReturningUserModal()">&times;</button>
                    <h2 class="auth-title">${currentLanguage === 'es' ? 'Bienvenida de Nuevo' : 'Welcome Back'}</h2>
                    
                    <div id="returningUserError" class="auth-error hidden"></div>
                    <div id="returningUserSuccess" class="auth-success hidden"></div>
                    
                    <div class="auth-form">
                        <input type="email" id="returningUserEmail" class="auth-input" placeholder="${currentLanguage === 'es' ? 'Tu correo electr√≥nico' : 'Your email address'}" required>
                        <button type="button" class="auth-button" onclick="lookupReturningUser()" id="lookupBtn">
                            ${currentLanguage === 'es' ? 'Buscar Mi Progreso' : 'Find My Progress'}
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function closeReturningUserModal() {
            const modal = document.getElementById('returningUserModal');
            if (modal) {
                modal.remove();
                document.getElementById('welcomeModal').classList.remove('hidden');
            }
        }

        async function lookupReturningUser() {
            const email = document.getElementById('returningUserEmail').value.trim();
            const errorDiv = document.getElementById('returningUserError');
            const successDiv = document.getElementById('returningUserSuccess');
            const lookupBtn = document.getElementById('lookupBtn');
            
            // Clear previous messages
            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
            
            if (!email) {
                errorDiv.textContent = currentLanguage === 'es' ? 
                    'Por favor ingresa tu correo electr√≥nico.' : 
                    'Please enter your email address.';
                errorDiv.classList.remove('hidden');
                return;
            }

            // Validate email format
            const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            if (!emailValid) {
                errorDiv.textContent = currentLanguage === 'es' ? 
                    'Por favor ingresa un correo electr√≥nico v√°lido.' : 
                    'Please enter a valid email address.';
                errorDiv.classList.remove('hidden');
                return;
            }

            // Show loading state
            lookupBtn.textContent = currentLanguage === 'es' ? 'Buscando...' : 'Looking up...';
            lookupBtn.disabled = true;

            // Use localStorage for user lookup
            const localUsers = JSON.parse(localStorage.getItem('smartMomUsers') || '{}');
            const userData = localUsers[email];
            
            if (userData) {
                // Success! Load user data
                successDiv.textContent = currentLanguage === 'es' ? 
                    `¬°Encontrado! Bienvenida de nuevo, ${userData.name || 'Smart Mom'}!` : 
                    `Found! Welcome back, ${userData.name || 'Smart Mom'}!`;
                successDiv.classList.remove('hidden');
                
                // Load user progress
                setTimeout(() => {
                    loadUserProgress(userData);
                    closeReturningUserModal();
                }, 1500);
                
            } else {
                // User not found
                errorDiv.textContent = currentLanguage === 'es' ? 
                    'Correo no encontrado en el almacenamiento local. ¬øTe gustar√≠a empezar un nuevo viaje?' : 
                    'Email not found in local storage. Would you like to start a new journey?';
                errorDiv.classList.remove('hidden');
                
                // Offer to start new journey
                setTimeout(() => {
                    if (confirm(currentLanguage === 'es' ? 
                        '¬øQuieres empezar desde el principio?' : 
                        'Would you like to start from the beginning?')) {
                        closeReturningUserModal();
                    }
                }, 2000);
            }

            // Reset button
            lookupBtn.textContent = currentLanguage === 'es' ? 'Buscar Mi Progreso' : 'Find My Progress';
            lookupBtn.disabled = false;
        }

        function loadUserProgress(userData) {
            // Set global variables
            selectedPath = userData.selectedPath || '';
            currentLanguage = userData.language || 'en';
            
            // Update language UI
            changeLanguage(currentLanguage);
            
            // Fill form fields if they exist
            if (userData.name) {
                const nameField = document.getElementById('user-name');
                if (nameField) nameField.value = userData.name;
            }
            
            if (userData.email) {
                const emailField = document.getElementById('user-email');
                if (emailField) emailField.value = userData.email;
            }
            
            // Fill other form data
            Object.keys(userData.formData || {}).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = userData.formData[key];
                }
            });
            
            // Show appropriate step based on progress
            if (userData.selectedPath) {
                // User has selected a path, show success or continue to next steps
                if (userData.currentStep >= 2) {
                    proceedWithSelectedPath();
                } else {
                    // Show path selection with pre-selected path
                    document.getElementById('pathSelection').classList.remove('hidden');
                    const pathOption = document.querySelector(`[data-path="${userData.selectedPath}"]`);
                    if (pathOption) {
                        pathOption.classList.add('selected');
                        document.getElementById('continueBtn').classList.add('visible');
                    }
                }
            } else {
                // User hasn't selected a path yet, show path selection
                const nameField = document.getElementById('user-name');
                const emailField = document.getElementById('user-email');
                if (nameField && emailField && nameField.value && emailField.value) {
                    document.getElementById('pathSelection').classList.remove('hidden');
                }
            }
        }

        // Form Functions
        function validateField(field) {
            const value = field.value.trim();
            const validation = document.getElementById(field.id + '-validation');
            
            if (field.type === 'email') {
                const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
                if (value && emailValid) {
                    validation.textContent = '‚úì Valid email';
                    validation.className = 'validation-message success';
                    field.style.borderColor = 'var(--sage-green)';
                } else if (value) {
                    validation.textContent = 'Please enter a valid email address';
                    validation.className = 'validation-message';
                    field.style.borderColor = '#e57373';
                } else {
                    validation.textContent = '';
                    field.style.borderColor = 'var(--light-sage)';
                }
            } else {
                if (value.length >= 2) {
                    validation.textContent = '‚úì Looks good';
                    validation.className = 'validation-message success';
                    field.style.borderColor = 'var(--sage-green)';
                } else if (value.length > 0) {
                    validation.textContent = 'Please enter at least 2 characters';
                    validation.className = 'validation-message';
                    field.style.borderColor = '#e57373';
                } else {
                    validation.textContent = '';
                    field.style.borderColor = 'var(--light-sage)';
                }
            }
        }

        function checkInitialFields() {
            const nameField = document.getElementById('user-name');
            const emailField = document.getElementById('user-email');
            
            function validate() {
                const name = nameField?.value.trim() || '';
                const email = emailField?.value.trim() || '';
                const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
                
                if (name.length >= 2 && email && emailValid) {
                    document.getElementById('pathSelection').classList.remove('hidden');
                    document.getElementById('pathSelection').scrollIntoView({ behavior: 'smooth' });
                } else {
                    document.getElementById('pathSelection').classList.add('hidden');
                }
            }
            
            if (nameField) nameField.addEventListener('input', validate);
            if (emailField) emailField.addEventListener('input', validate);
        }

        function scrollToForm() {
            document.getElementById('initialStep').scrollIntoView({ behavior: 'smooth' });
        }

        // Path Selection Functions
        function selectPath(path) {
            selectedPath = path;
            
            // Update visual selection
            document.querySelectorAll('.path-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-path="${path}"]`).classList.add('selected');
            
            // Show continue button
            const continueBtn = document.getElementById('continueBtn');
            continueBtn.classList.add('visible');
        }

        async function proceedWithSelectedPath() {
            if (!selectedPath) {
                alert(currentLanguage === 'es' ? 
                    'Por favor selecciona un camino antes de continuar.' :
                    'Please select a path before continuing.');
                return;
            }
            
            // Get user data
            const userData = {
                email: document.getElementById('user-email').value.trim(),
                name: document.getElementById('user-name').value.trim(),
                selectedPath: selectedPath,
                currentStep: 2,
                language: currentLanguage,
                formData: {
                    'user-name': document.getElementById('user-name').value.trim(),
                    'user-email': document.getElementById('user-email').value.trim()
                }
            };

            // Save to localStorage 
            const localUsers = JSON.parse(localStorage.getItem('smartMomUsers') || '{}');
            if (localUsers[userData.email]) {
                // Update existing user
                localUsers[userData.email] = { ...localUsers[userData.email], ...userData };
            } else {
                // Create new entry
                localUsers[userData.email] = userData;
            }
            localStorage.setItem('smartMomUsers', JSON.stringify(localUsers));
            console.log('User progress saved locally:', userData);
            
            // Hide current sections
            document.getElementById('initialStep').classList.add('hidden');
            document.getElementById('pathSelection').classList.add('hidden');
            
            // Show success message
            document.getElementById('successMessage').classList.remove('hidden');
            document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });
            
            // Send webhook notification (non-blocking)
            safeWebhookCall('https://momsurvivaltoolkit.app.n8n.cloud/webhook-test/smart-mom-form', {
                email: userData.email,
                name: userData.name,
                selected_path: userData.selectedPath,
                trigger_path_email: 'true',
                lead_stage: 'Path Selected',
                language: userData.language,
                timestamp: new Date().toISOString()
            }, 'Path selection notification');
            
            // Update selected path display
            updateSelectedPathDisplay();
        }

        function updateSelectedPathDisplay() {
            const pathNames = {
                'life-organization': currentLanguage === 'es' ? 'Organizaci√≥n de Vida' : 'Life Organization',
                'business-launch': currentLanguage === 'es' ? 'Lanzamiento de Negocio' : 'Business Launch',
                'both': currentLanguage === 'es' ? 'Vida y Negocio' : 'Life & Business'
            };
            
            const displayElement = document.getElementById('selectedPathDisplay');
            if (displayElement) {
                displayElement.textContent = pathNames[selectedPath] || selectedPath;
            }
        }

        // AI Process Functions
        async function startAIProcess() {
            // Hide success message and show AI process
            document.getElementById('successMessage').classList.add('hidden');
            document.getElementById('aiProcessSteps').classList.remove('hidden');
            document.getElementById('aiProcessSteps').scrollIntoView({ behavior: 'smooth' });
            
            // Simulate AI processing steps
            await simulateAISteps();
        }

        async function simulateAISteps() {
            const steps = [
                { id: 'ai-step-1', duration: 3000, icon: 'üîç', status: 'Analyzing...' },
                { id: 'ai-step-2', duration: 4000, icon: 'ü§ñ', status: 'Generating...' },
                { id: 'ai-step-3', duration: 3500, icon: 'üìä', status: 'Optimizing...' },
                { id: 'ai-step-4', duration: 2500, icon: 'üìÖ', status: 'Creating...' }
            ];

            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                const stepElement = document.getElementById(step.id);
                
                // Start processing this step
                stepElement.classList.add('processing');
                stepElement.querySelector('.ai-step-icon').textContent = step.icon;
                stepElement.querySelector('.ai-step-status').textContent = step.status;
                
                // Wait for the step duration
                await new Promise(resolve => setTimeout(resolve, step.duration));
                
                // Complete this step
                stepElement.classList.remove('processing');
                stepElement.classList.add('completed');
                stepElement.querySelector('.ai-step-icon').textContent = '‚úÖ';
                stepElement.querySelector('.ai-step-status').textContent = 'Completed!';
                
                // Small delay between steps
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            // All steps completed, show final section
            await new Promise(resolve => setTimeout(resolve, 1000));
            showCompletion();
        }

        function showCompletion() {
            // Hide AI process and show completion
            document.getElementById('aiProcessSteps').classList.add('hidden');
            document.getElementById('completionSection').classList.remove('hidden');
            document.getElementById('completionSection').scrollIntoView({ behavior: 'smooth' });
            
            // Send completion webhook (non-blocking)
            safeWebhookCall('https://momsurvivaltoolkit.app.n8n.cloud/webhook-test/smart-mom-complete', {
                email: document.getElementById('user-email').value.trim(),
                name: document.getElementById('user-name').value.trim(),
                selectedPath: selectedPath,
                completed: true,
                language: currentLanguage,
                trigger_completion_email: 'true',
                calendar_ready: 'true',
                timestamp: new Date().toISOString()
            }, 'Completion notification');
        }

        // Download and Email Functions
        function downloadCalendar() {
            // Generate calendar content based on selected path
            const calendarContent = generateCalendarContent();
            
            // Create downloadable file
            const blob = new Blob([calendarContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `smart-mom-interactive-calendar-${selectedPath}.ics`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Track download
            console.log('Interactive calendar downloaded for path:', selectedPath);
        }

        async function emailCalendar() {
            const email = document.getElementById('user-email').value.trim();
            
            // Send email calendar webhook (non-blocking)
            safeWebhookCall('https://momsurvivaltoolkit.app.n8n.cloud/webhook-test/smart-mom-email-calendar', {
                email: email,
                name: document.getElementById('user-name').value.trim(),
                selectedPath: selectedPath,
                trigger_calendar_email: 'true',
                language: currentLanguage,
                timestamp: new Date().toISOString()
            }, 'Email calendar');
            
            alert(currentLanguage === 'es' ? 
                '¬°Perfecto! Te hemos enviado tu calendario interactivo por correo electr√≥nico.' :
                'Perfect! We\'ve sent your interactive calendar to your email address.');
        }

        function generateCalendarContent() {
            const now = new Date();
            const pathTitles = {
                'life-organization': 'Smart Mom Interactive Life Organization Calendar',
                'business-launch': 'Smart Mom Interactive Business Launch Calendar',
                'both': 'Smart Mom Complete Interactive Life & Business Calendar'
            };
            
            // Enhanced ICS calendar format with more interactive elements
            return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Smart Mom Method Interactive Calendar//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:${pathTitles[selectedPath] || 'Smart Mom Interactive Calendar'}
X-WR-CALDESC:Your personalized Smart Mom Method interactive calendar with optimized daily routines, goal tracking, and family organization system.
BEGIN:VEVENT
UID:smartmom-welcome-${Date.now()}@smartmommethod.com
DTSTAMP:${now.toISOString().replace(/[-:]/g, '').split('.')[0]}Z
DTSTART:${now.toISOString().replace(/[-:]/g, '').split('.')[0]}Z
SUMMARY:üåü Welcome to Your Smart Mom Interactive Calendar!
DESCRIPTION:Congratulations! Your personalized Smart Mom Method interactive calendar is ready. This calendar includes time-blocked schedules\\, family routines\\, and goal-oriented tasks designed specifically for busy moms like you. Start implementing your new organized life today!
CATEGORIES:Smart Mom Method\\,Life Organization\\,Goal Setting
END:VEVENT
END:VCALENDAR`;
        }

        function provideFeedback() {
            const feedback = prompt(currentLanguage === 'es' ? 
                'Comparte tu experiencia con Smart Mom Method:' :
                'Share your experience with Smart Mom Method:');
                
            if (feedback) {
                // Send feedback webhook (non-blocking)
                safeWebhookCall('https://momsurvivaltoolkit.app.n8n.cloud/webhook-test/smart-mom-feedback', {
                    email: document.getElementById('user-email').value.trim(),
                    name: document.getElementById('user-name').value.trim(),
                    feedback: feedback,
                    selectedPath: selectedPath,
                    language: currentLanguage,
                    timestamp: new Date().toISOString()
                }, 'Feedback submission');
                
                alert(currentLanguage === 'es' ? 
                    '¬°Gracias por tu feedback!' :
                    'Thank you for your feedback!');
            }
        }

        function startOver() {
            selectedPath = '';
            
            // Reset form
            document.getElementById('user-name').value = '';
            document.getElementById('user-email').value = '';
            
            // Reset validations
            document.querySelectorAll('.validation-message').forEach(msg => {
                msg.textContent = '';
            });
            
            document.querySelectorAll('.form-control').forEach(field => {
                field.style.borderColor = 'var(--light-sage)';
            });
            
            // Reset path selection
            document.querySelectorAll('.path-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.getElementById('continueBtn').classList.remove('visible');
            
            // Show initial sections
            document.getElementById('initialStep').classList.remove('hidden');
            document.getElementById('pathSelection').classList.add('hidden');
            document.getElementById('successMessage').classList.add('hidden');
            document.getElementById('aiProcessSteps').classList.add('hidden');
            document.getElementById('completionSection').classList.add('hidden');
            
            // Scroll to top
            document.getElementById('initialStep').scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
    </script>
</body>
</html>
