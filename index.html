<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Mom Method - AI Interactive Calendar & Business Wizard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        :root {
            --sage-green: #6B8E6B;
            --warm-cream: #FAF7F0;
            --deep-teal: #2D5B69;
            --charcoal: #2C3E50;
            --soft-gold: #D4A574;
            --light-sage: #E8F5E8;
            --sage-alpha: rgba(107, 142, 107, 0.1);
            --teal-alpha: rgba(45, 91, 105, 0.1);
            --gold-alpha: rgba(212, 165, 116, 0.1);
            --step-current: #3498db;
            --step-completed: #27ae60;
            --step-pending: #95a5a6;
            --button-next: #2ecc71;
            --button-done: #7f8c8d;
            --button-back: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--charcoal);
            background: var(--warm-cream);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* User Status Bar */
        .user-status-bar {
            background: white;
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(107, 142, 107, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--sage-green), var(--deep-teal));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 18px;
        }

        .user-details h4 {
            color: var(--charcoal);
            margin: 0;
            font-size: 16px;
        }

        .user-details p {
            color: var(--charcoal);
            opacity: 0.7;
            margin: 0;
            font-size: 14px;
        }

        .user-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.signed-in {
            background: var(--light-sage);
            color: var(--sage-green);
        }

        .status-badge.guest {
            background: #fff3cd;
            color: #856404;
        }

        /* Authentication Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }

        .auth-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .auth-content {
            background: white;
            border-radius: 24px;
            padding: 50px;
            max-width: 500px;
            width: 90%;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.4s ease;
        }

        .auth-modal.active .auth-content {
            transform: translateY(0);
        }

        .auth-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--charcoal);
            opacity: 0.7;
        }

        .auth-close:hover {
            opacity: 1;
        }

        .auth-title {
            font-family: 'Playfair Display', serif;
            color: var(--sage-green);
            margin-bottom: 32px;
            font-size: 2rem;
            text-align: center;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .auth-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--light-sage);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .auth-input:focus {
            outline: none;
            border-color: var(--sage-green);
            box-shadow: 0 0 0 4px var(--sage-alpha);
        }

        .auth-button {
            background: linear-gradient(135deg, var(--sage-green), #5A7A5A);
            color: white;
            padding: 18px 36px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(107, 142, 107, 0.35);
        }

        .auth-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .auth-switch {
            text-align: center;
            margin-top: 24px;
            color: var(--charcoal);
            opacity: 0.8;
        }

        .auth-link {
            color: var(--sage-green);
            cursor: pointer;
            text-decoration: underline;
        }

        .auth-error {
            background: #ffebee;
            border: 1px solid #e57373;
            color: #c62828;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .auth-success {
            background: #e8f5e8;
            border: 1px solid var(--sage-green);
            color: var(--sage-green);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--sage-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Welcome Modal */
        .welcome-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 1;
            visibility: visible;
            transition: all 0.4s ease;
        }

        .welcome-modal.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .welcome-content {
            background: white;
            border-radius: 24px;
            padding: 60px 50px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            transform: translateY(0);
            transition: transform 0.4s ease;
            box-shadow: 0 30px 80px rgba(44, 62, 80, 0.2);
        }

        .welcome-content h2 {
            font-family: 'Playfair Display', serif;
            color: var(--sage-green);
            margin-bottom: 24px;
            font-size: 2.4rem;
            font-weight: 600;
        }

        .welcome-content p {
            color: var(--charcoal);
            margin-bottom: 40px;
            font-size: 1.1rem;
            line-height: 1.7;
            opacity: 0.8;
        }

        .welcome-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .welcome-btn {
            padding: 18px 36px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
            font-family: 'Inter', sans-serif;
        }

        .welcome-btn.primary {
            background: linear-gradient(135deg, var(--sage-green), #5A7A5A);
            color: white;
            box-shadow: 0 8px 24px rgba(107, 142, 107, 0.3);
        }

        .welcome-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(107, 142, 107, 0.4);
        }

        .welcome-btn.secondary {
            background: var(--deep-teal);
            color: white;
        }

        .welcome-btn.secondary:hover {
            background: #1E3D47;
            transform: translateY(-2px);
        }

        .welcome-btn.auth {
            background: var(--soft-gold);
            color: white;
        }

        .welcome-btn.auth:hover {
            background: #C79660;
            transform: translateY(-2px);
        }

        /* Language Selection */
        .language-selector {
            text-align: center;
            margin-bottom: 40px;
            padding: 32px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(44, 62, 80, 0.08);
        }

        .language-selector h2 {
            margin-bottom: 24px;
            color: var(--charcoal);
            font-size: 1.6rem;
            font-weight: 600;
        }

        .language-buttons {
            display: flex;
            gap: 24px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .language-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 40px;
            background: var(--sage-green);
            color: white;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 200px;
            box-shadow: 0 6px 20px rgba(107, 142, 107, 0.25);
        }

        .language-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(107, 142, 107, 0.35);
        }

        .language-btn.active {
            background: var(--soft-gold);
            transform: translateY(-2px);
        }

        .language-btn .flag {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .language-btn small {
            margin-top: 8px;
            opacity: 0.9;
        }

        /* Progress Container */
        .progress-container {
            background: white;
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 8px 32px rgba(44, 62, 80, 0.08);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .step-counter {
            font-weight: 700;
            color: var(--sage-green);
            font-size: 1.3rem;
        }

        .overall-progress {
            width: 100%;
            height: 12px;
            background: var(--light-sage);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 32px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--sage-green), var(--deep-teal));
            transition: width 0.5s ease;
            border-radius: 6px;
            width: 16.67%;
        }

        .progress-bar {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
            margin-bottom: 0;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 16px;
            border-radius: 16px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--sage-alpha);
        }
        
        .progress-step:hover {
            background: var(--teal-alpha);
            transform: translateY(-2px);
        }

        .progress-step.active {
            background: var(--step-current);
            color: white;
        }

        .progress-step.completed {
            background: var(--step-completed);
            color: white;
        }

        .progress-step.pending {
            background: var(--step-pending);
            color: white;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-number {
            background: rgba(255, 255, 255, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .step-text {
            font-size: 0.9rem;
            text-align: center;
            font-weight: 600;
        }

        /* Main Card */
        .main-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 16px 48px rgba(44, 62, 80, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--sage-green), var(--deep-teal));
            color: white;
            padding: 60px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 8s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
            font-weight: 600;
        }

        .header .subtitle {
            font-size: 1.3rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 400;
        }

        .badge {
            display: inline-block;
            background: var(--soft-gold);
            color: white;
            padding: 12px 28px;
            border-radius: 30px;
            font-weight: 700;
            margin-top: 24px;
            font-size: 1rem;
            position: relative;
            z-index: 1;
        }

        .header .cta-section {
            margin-top: 40px;
            position: relative;
            z-index: 1;
        }

        .btn-current {
            background: linear-gradient(135deg, var(--soft-gold), #C79660);
            color: white;
            box-shadow: 0 8px 24px rgba(212, 165, 116, 0.3);
            font-size: 1.2rem;
            padding: 20px 40px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-current:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(212, 165, 116, 0.4);
        }

        .content {
            padding: 50px 40px;
        }

        .step-description {
            background: var(--light-sage);
            padding: 32px;
            border-radius: 16px;
            margin-bottom: 40px;
            border-left: 6px solid var(--sage-green);
        }

        .step-description h2 {
            font-family: 'Playfair Display', serif;
            color: var(--charcoal);
            margin-bottom: 16px;
            font-size: 2rem;
            font-weight: 600;
        }

        .step-description p {
            color: var(--charcoal);
            font-size: 1.1rem;
            opacity: 0.8;
        }

        .empowerment-message {
            background: linear-gradient(135deg, var(--gold-alpha), rgba(212, 165, 116, 0.15));
            border: 2px solid var(--soft-gold);
            border-radius: 20px;
            padding: 32px;
            margin: 32px 0;
            text-align: center;
        }

        .empowerment-title {
            color: var(--charcoal);
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 16px;
            font-family: 'Playfair Display', serif;
        }

        .empowerment-text {
            color: var(--charcoal);
            line-height: 1.7;
            opacity: 0.9;
        }

        /* Form Sections */
        .form-section {
            margin-bottom: 40px;
            padding: 40px;
            background: white;
            border-radius: 20px;
            border: 2px solid var(--light-sage);
            box-shadow: 0 4px 16px rgba(107, 142, 107, 0.08);
        }

        .form-section h2 {
            font-family: 'Playfair Display', serif;
            color: var(--charcoal);
            margin-bottom: 32px;
            font-size: 1.8rem;
            font-weight: 600;
            text-align: center;
        }

        .form-group {
            margin-bottom: 28px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--charcoal);
            font-size: 1rem;
        }

        .required {
            color: var(--soft-gold);
            margin-left: 4px;
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--light-sage);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            background: var(--warm-cream);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--sage-green);
            box-shadow: 0 0 0 4px var(--sage-alpha);
            background: white;
        }

        .validation-message {
            margin-top: 8px;
            font-size: 14px;
            color: #e57373;
        }

        .validation-message.success {
            color: var(--sage-green);
        }

        .char-counter {
            text-align: right;
            font-size: 12px;
            color: var(--charcoal);
            opacity: 0.6;
            margin-top: 4px;
        }

        /* Path Selection */
        .path-selection {
            margin: 50px 0;
            text-align: center;
        }

        .path-selection h2 {
            font-family: 'Playfair Display', serif;
            color: var(--charcoal);
            margin-bottom: 40px;
            font-size: 2.2rem;
            font-weight: 600;
        }

        .path-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .path-option {
            background: var(--warm-cream);
            border-radius: 20px;
            padding: 40px 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            text-align: center;
        }

        .path-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(107, 142, 107, 0.2);
            border-color: var(--sage-green);
        }

        .path-option.selected {
            border-color: var(--soft-gold);
            background: white;
            transform: translateY(-3px);
            box-shadow: 0 12px 36px rgba(212, 165, 116, 0.25);
        }

        .path-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            display: block;
        }

        .path-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 16px;
        }

        .path-description {
            color: var(--charcoal);
            opacity: 0.8;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .continue-btn {
            background: linear-gradient(135deg, var(--sage-green), #5A7A5A);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        .continue-btn.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(107, 142, 107, 0.3);
        }

        .continue-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Enhanced Interactive AI Steps */
        .interactive-ai-workflow {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            border: 2px solid var(--light-sage);
        }

        .ai-step-container {
            margin: 40px 0;
            padding: 30px;
            border-radius: 16px;
            border: 3px solid var(--step-pending);
            transition: all 0.3s ease;
        }

        .ai-step-container.current {
            border-color: var(--step-current);
            background: rgba(52, 152, 219, 0.05);
        }

        .ai-step-container.completed {
            border-color: var(--step-completed);
            background: rgba(39, 174, 96, 0.05);
        }

        .ai-step-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .ai-step-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--charcoal);
        }

        .ai-step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--step-pending);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .ai-step-container.current .ai-step-number {
            background: var(--step-current);
        }

        .ai-step-container.completed .ai-step-number {
            background: var(--step-completed);
        }

        .ai-step-status {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            background: var(--step-pending);
            color: white;
        }

        .ai-step-container.current .ai-step-status {
            background: var(--step-current);
        }

        .ai-step-container.completed .ai-step-status {
            background: var(--step-completed);
        }

        .ai-step-content {
            margin: 20px 0;
        }

        .ai-prompt-area {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .ai-prompt-label {
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 10px;
            display: block;
        }

        .ai-prompt-textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            background: white;
        }

        .ai-response-area {
            background: #f0f8ff;
            border: 2px solid #b3d9ff;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .ai-response-textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            background: white;
        }

        .ai-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .ai-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            min-width: 140px;
        }

        .ai-btn.next {
            background: var(--button-next);
            color: white;
        }

        .ai-btn.next:hover {
            background: #27ae60;
            transform: translateY(-1px);
        }

        .ai-btn.done {
            background: var(--button-done);
            color: white;
        }

        .ai-btn.done:hover {
            background: #6c7b7d;
            transform: translateY(-1px);
        }

        .ai-btn.back {
            background: var(--button-back);
            color: white;
        }

        .ai-btn.back:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .ai-btn.copy {
            background: var(--sage-green);
            color: white;
        }

        .ai-btn.copy:hover {
            background: #5A7A5A;
            transform: translateY(-1px);
        }

        .ai-btn.open {
            background: var(--soft-gold);
            color: white;
        }

        .ai-btn.open:hover {
            background: #C79660;
            transform: translateY(-1px);
        }

        .ai-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .instructions-box {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .instructions-title {
            font-weight: 600;
            color: #d68910;
            margin-bottom: 10px;
        }

        .instructions-list {
            list-style: none;
            padding: 0;
        }

        .instructions-list li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .instructions-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #d68910;
            font-weight: bold;
        }

        /* Final Dashboard */
        .final-dashboard {
            background: linear-gradient(135deg, var(--sage-green), var(--deep-teal));
            color: white;
            padding: 50px 40px;
            border-radius: 24px;
            margin: 40px 0;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .dashboard-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .dashboard-section {
            background: white;
            color: var(--charcoal);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .dashboard-section h3 {
            color: var(--sage-green);
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .infographic-container {
            min-height: 300px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px dashed #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #666;
        }

        .calendar-preview {
            min-height: 300px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px dashed #ddd;
        }

        .business-summary {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .final-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .final-action-btn {
            background: var(--soft-gold);
            color: white;
            padding: 18px 36px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .final-action-btn:hover {
            background: #C79660;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(212, 165, 116, 0.3);
        }

        .final-action-btn.primary {
            background: var(--button-next);
        }

        /* Interactive Calendar System */
        .calendar-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 8px 32px rgba(44, 62, 80, 0.08);
        }

        .calendar-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light-sage);
        }

        .calendar-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .week-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .week-btn {
            padding: 8px 16px;
            border: 2px solid var(--light-sage);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            min-width: 60px;
        }

        .week-btn.active {
            background: var(--sage-green);
            color: white;
            border-color: var(--sage-green);
        }

        .week-btn:hover {
            border-color: var(--sage-green);
            transform: translateY(-1px);
        }

        .calendar-progress {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .progress-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 4px solid var(--light-sage);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--sage-green);
            position: relative;
        }

        .week-content {
            display: none;
        }

        .week-content.active {
            display: block;
        }

        .day-card {
            background: var(--warm-cream);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 6px solid var(--sage-green);
            transition: all 0.3s ease;
        }

        .day-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(107, 142, 107, 0.15);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .day-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--charcoal);
        }

        .day-progress {
            background: var(--light-sage);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: var(--sage-green);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .task-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--light-sage);
            transition: all 0.3s ease;
        }

        .task-card.completed {
            border-color: var(--success-green);
            background: #f8fff8;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            gap: 15px;
        }

        .task-title-section {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .task-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .task-cost {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .cost-free {
            background: #e8f5e8;
            color: var(--success-green);
        }

        .cost-paid {
            background: #fff3cd;
            color: #856404;
        }

        .task-time {
            color: var(--charcoal);
            opacity: 0.7;
            font-size: 14px;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            margin-top: 2px;
            cursor: pointer;
        }

        .step-list {
            margin-top: 15px;
        }

        .step-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .step-item:hover {
            background: var(--sage-alpha);
        }

        .step-item.completed {
            background: #f8fff8;
            text-decoration: line-through;
            opacity: 0.8;
        }

        .step-checkbox {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            cursor: pointer;
        }

        .step-number {
            background: var(--sage-green);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .step-text {
            flex: 1;
            line-height: 1.5;
            color: var(--charcoal);
        }

        .calendar-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .calendar-btn {
            background: var(--sage-green);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-btn:hover {
            background: var(--deep-teal);
            transform: translateY(-1px);
        }

        .calendar-btn.secondary {
            background: var(--soft-gold);
        }

        .calendar-btn.secondary:hover {
            background: #C79660;
        }

        .calendar-stats {
            background: var(--light-sage);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            text-align: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--sage-green);
        }

        .stat-label {
            font-size: 14px;
            color: var(--charcoal);
            opacity: 0.8;
        }

        .calendar-empty {
            text-align: center;
            padding: 60px 20px;
            color: var(--charcoal);
            opacity: 0.6;
        }

        .calendar-empty h3 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .parse-calendar-section {
            background: var(--light-sage);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
            text-align: center;
        }

        .parse-calendar-section h3 {
            color: var(--sage-green);
            margin-bottom: 15px;
        }

        .calendar-input {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid var(--sage-green);
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            margin-bottom: 15px;
        }

        .parse-btn {
            background: var(--sage-green);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
        }

        .parse-btn:hover {
            background: var(--deep-teal);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .header .subtitle {
                font-size: 1.1rem;
            }
            
            .content {
                padding: 30px 20px;
            }
            
            .progress-bar {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            .progress-step {
                padding: 12px 8px;
            }

            .step-text {
                font-size: 0.7rem;
            }

            .language-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .language-btn {
                min-width: 280px;
            }

            .welcome-content {
                padding: 40px 30px;
            }

            .welcome-buttons {
                flex-direction: column;
            }

            .form-control {
                font-size: 16px;
                padding: 18px;
            }

            .auth-content {
                padding: 30px 20px;
            }

            .path-options {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .path-option {
                padding: 30px 20px;
            }

            .form-section {
                padding: 30px 20px;
            }

            .user-status-bar {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .user-actions {
                width: 100%;
                justify-content: space-between;
            }

            #paymentOptions [style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }

            .ai-buttons {
                flex-direction: column;
            }

            .ai-btn {
                min-width: 100%;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .final-actions {
                flex-direction: column;
                align-items: center;
            }

            .final-action-btn {
                min-width: 100%;
                max-width: 300px;
            }

            .ai-step-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .calendar-navigation {
                flex-direction: column;
                gap: 20px;
            }

            .week-selector {
                justify-content: center;
            }

            .calendar-progress {
                justify-content: center;
            }

            .task-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .task-meta {
                flex-direction: column;
                gap: 8px;
            }

            .calendar-actions {
                flex-direction: column;
                align-items: center;
            }

            .calendar-btn {
                min-width: 200px;
            }

            .calendar-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .step-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .step-number {
                align-self: flex-start;
            }

            .prompt-templates {
                flex-direction: column;
                gap: 8px;
            }

            .template-btn {
                min-width: 100%;
                text-align: center;
            }

            .variable-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .prompt-actions {
                flex-direction: column;
                gap: 10px;
            }

            .prompt-action-btn {
                min-width: 100%;
            }

            .preview-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .preview-stats {
                flex-direction: column;
                gap: 5px;
            }

            .checkbox-group {
                flex-direction: column;
                gap: 8px;
            }

            .context-chips {
                justify-content: center;
            }

            .prompt-customizer {
                padding: 15px;
            }

            .advanced-options {
                padding: 10px;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-content">
            <button class="auth-close" onclick="closeAuthModal()">&times;</button>
            <h2 class="auth-title" id="authTitle">Create Your Account</h2>
            
            <div id="authError" class="auth-error hidden"></div>
            <div id="authSuccess" class="auth-success hidden"></div>
            
            <form class="auth-form" id="authForm">
                <input type="text" id="authName" class="auth-input" placeholder="Your Name" style="display: none;">
                <input type="email" id="authEmail" class="auth-input" placeholder="Email Address" required>
                <input type="password" id="authPassword" class="auth-input" placeholder="Password" required>
                <input type="password" id="authConfirmPassword" class="auth-input" placeholder="Confirm Password" style="display: none;">
                
                <button type="submit" class="auth-button" id="authSubmitBtn">
                    <span id="authSubmitText">Create Account</span>
                </button>
            </form>
            
            <div class="auth-switch">
                <span id="authSwitchText">Already have an account?</span>
                <span class="auth-link" id="authSwitchLink" onclick="toggleAuthMode()">Sign In</span>
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeModal" class="welcome-modal">
        <div class="welcome-content">
            <h2 id="welcomeTitle">Welcome to Smart Mom Method!</h2>
            <p id="welcomeDescription">Create your personalized interactive calendar and business plan in 6 simple steps. This process will take approximately 25-30 minutes and will generate a comprehensive interactive calendar and plan tailored specifically for busy moms like you.</p>
            <div class="welcome-buttons">
                <button class="welcome-btn primary" onclick="startOnboarding()">
                    <span id="welcomeStart">Get Started</span>
                </button>
                <button class="welcome-btn auth" onclick="showAuthModal('signup')">
                    <span id="welcomeCreate">Create Account & Save Progress</span>
                </button>
                <button class="welcome-btn secondary" onclick="handleReturningUser()">
                    <span id="welcomeReturning">I'm a returning user</span>
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- User Status Bar -->
        <div id="userStatusBar" class="user-status-bar hidden">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">?</div>
                <div class="user-details">
                    <h4 id="userDisplayName">Guest User</h4>
                    <p id="userStatusText">Progress will not be saved</p>
                </div>
            </div>
            <div class="user-actions">
                <div class="status-badge guest" id="statusBadge">Guest Mode</div>
                <button onclick="showAuthModal('signup')" style="background: var(--sage-green); color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 14px; cursor: pointer;">
                    Save Progress
                </button>
                <button id="signOutBtn" onclick="signOut()" style="background: none; border: 1px solid var(--charcoal); color: var(--charcoal); padding: 8px 16px; border-radius: 8px; font-size: 14px; cursor: pointer; display: none;">
                    Sign Out
                </button>
            </div>
        </div>

        <!-- Language Selection -->
        <div class="language-selector">
            <h2 id="languageTitle">Choose Your Language / Elige Tu Idioma</h2>
            <div class="language-buttons">
                <button class="language-btn active" onclick="changeLanguage('en')" id="lang-en">
                    <span class="flag">🇺🇸</span>
                    <span>English</span>
                    <small>Read and answer everything in English</small>
                </button>
                <button class="language-btn" onclick="changeLanguage('es')" id="lang-es">
                    <span class="flag">🇪🇸</span>
                    <span>Español</span>
                    <small>Lee y responde todo en español</small>
                </button>
            </div>
        </div>

        <!-- Skip to Payment Button -->
        <div style="text-align: center; margin: 30px 0; padding: 20px; background: white; border-radius: 16px; box-shadow: 0 4px 16px rgba(107, 142, 107, 0.08);">
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 15px;">
                <button onclick="skipToPaymentOptions()" style="background: linear-gradient(135deg, var(--soft-gold), #C79660); color: white; padding: 15px 30px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    View Payment Options
                </button>
                <button id="calendarAccessBtn" onclick="showInteractiveCalendar()" style="background: linear-gradient(135deg, var(--sage-green), var(--deep-teal)); color: white; padding: 15px 30px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: none;">
                    📅 My Interactive Calendar
                </button>
            </div>
            <p style="color: var(--charcoal); font-size: 1.1rem;">Skip ahead to our solutions or continue with the free planning process below</p>
        </div>

        <!-- Progress Container -->
        <div class="progress-container">
            <div class="progress-header">
                <div class="step-counter" id="stepCounter">Step 1 of 6</div>
            </div>
            <div class="overall-progress">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-bar">
                <div class="progress-step active" id="step-1">
                    <span class="step-number">1</span>
                    <span class="step-text" id="stepText1">Basic Info</span>
                </div>
                <div class="progress-step pending" id="step-2">
                    <span class="step-number">2</span>
                    <span class="step-text" id="stepText2">Path Selection</span>
                </div>
                <div class="progress-step pending" id="step-3">
                    <span class="step-number">3</span>
                    <span class="step-text" id="stepText3">Questions</span>
                </div>
                <div class="progress-step pending" id="step-4">
                    <span class="step-number">4</span>
                    <span class="step-text" id="stepText4">AI Analysis</span>
                </div>
                <div class="progress-step pending" id="step-5">
                    <span class="step-number">5</span>
                    <span class="step-text" id="stepText5">Calendar</span>
                </div>
                <div class="progress-step pending" id="step-6">
                    <span class="step-number">6</span>
                    <span class="step-text" id="stepText6">Complete</span>
                </div>
            </div>
        </div>

        <div class="main-card">
            <div class="header">
                <h1 id="mainTitle">Smart Mom Method</h1>
                <p class="subtitle" id="mainSubtitle">AI-Powered Interactive Calendar & Business Planning for Busy Moms</p>
                <span class="badge" id="freeBadge">100% Free</span>
                
                <div class="cta-section">
                    <button class="btn-current" onclick="scrollToForm()">
                        <span id="ctaButton">Start Your Free Interactive Calendar & Business Plan Now</span>
                    </button>
                    <p style="margin-top: 16px; font-size: 0.95rem; opacity: 0.9;" id="ctaSubtext">No email required to browse • Full process takes 25-30 minutes</p>
                </div>
            </div>

            <div class="content">
                <!-- Basic Information Section -->
                <div class="form-section" id="basicInfoSection">
                    <h2 id="basicInfoTitle">Basic Information</h2>
                    
                    <div class="form-group">
                        <label id="nameLabel">Your Name: <span class="required">*</span></label>
                        <input type="text" id="user-name" class="form-control" placeholder="Enter your name" onchange="validateField(this)" />
                        <div class="validation-message" id="user-name-validation"></div>
                    </div>

                    <div class="form-group">
                        <label id="emailLabel">Your Email: <span class="required">*</span></label>
                        <input type="email" id="user-email" class="form-control" placeholder="your.email@example.com" onchange="validateField(this)" />
                        <div class="validation-message" id="user-email-validation"></div>
                    </div>
                </div>

                <div class="step-description">
                    <h2 id="stepDescTitle">Let's Get Started</h2>
                    <p id="stepDescText">First, let's get to know you better so we can create the perfect interactive calendar and business plan for your unique situation.</p>
                </div>

                <div class="empowerment-message">
                    <div class="empowerment-title" id="empowermentTitle">You're Already Successful!</div>
                    <p class="empowerment-text" id="empowermentText">Managing a family is running a complex organization. You have negotiation skills, time management expertise, and crisis resolution abilities that most CEOs would envy. Now let's channel that into YOUR organized life and successful business!</p>
                </div>

                <!-- Path Selection -->
                <div class="path-selection hidden" id="pathSelection">
                    <h2 id="pathSelectionTitle">What brings you here today? Choose your main focus:</h2>
                    
                    <div class="path-options">
                        <div class="path-option" data-path="life-organization" onclick="selectPath('life-organization')">
                            <span class="path-icon">🏠</span>
                            <h3 class="path-title" id="pathTitle1">Life Organization</h3>
                            <p class="path-description" id="pathDesc1">I need help organizing my daily life, family schedules, and home systems</p>
                        </div>
                        
                        <div class="path-option" data-path="business-launch" onclick="selectPath('business-launch')">
                            <span class="path-icon">💼</span>
                            <h3 class="path-title" id="pathTitle2">Business Launch</h3>
                            <p class="path-description" id="pathDesc2">I want to start a business or create passive income streams</p>
                        </div>
                        
                        <div class="path-option" data-path="both" onclick="selectPath('both')">
                            <span class="path-icon">☀️</span>
                            <h3 class="path-title" id="pathTitle3">Both Life & Business</h3>
                            <p class="path-description" id="pathDesc3">I need life organization AND want to start a business</p>
                        </div>
                    </div>
                    
                    <button class="continue-btn" id="continueBtn" onclick="showBusinessQuestionnaire()">
                        <span id="continueBtnText">Continue With Selected Path</span>
                    </button>
                </div>

                <!-- Business Questionnaire -->
                <div class="form-section hidden" id="businessQuestionnaire">
                    <h2 id="businessQuestionnaireTitle">Tell Us More About Your Situation</h2>
                    
                    <div class="form-group">
                        <label id="familyStructureLabel">Family structure & ages: <span class="required">*</span></label>
                        <textarea id="family-structure" class="form-control" rows="4" placeholder="Tell us about your family: How many kids? What ages? Any special needs or considerations?" oninput="updateCharCount(this, 1000)"></textarea>
                        <div class="char-counter" id="family-structure-counter">0/1000</div>
                        <div class="validation-message" id="family-structure-validation"></div>
                    </div>

                    <div class="form-group">
                        <label id="dailyScheduleLabel">Describe your typical daily schedule: <span class="required">*</span></label>
                        <textarea id="daily-schedule" class="form-control" rows="4" placeholder="Walk us through a typical day: When do you wake up? Kids' schedules? When do you have free time?" oninput="updateCharCount(this, 1000)"></textarea>
                        <div class="char-counter" id="daily-schedule-counter">0/1000</div>
                        <div class="validation-message" id="daily-schedule-validation"></div>
                    </div>

                    <div class="form-group">
                        <label id="investmentLabel">Investment level for business: <span class="required">*</span></label>
                        <select id="investment-level" class="form-control" onchange="validateField(this)">
                            <option value="">Select investment level...</option>
                            <option value="no-money">$0 - I need free options only</option>
                            <option value="minimal">Under $100 - Very limited budget</option>
                            <option value="moderate">$100-500 - Can invest if necessary</option>
                            <option value="flexible">$500+ - Flexible for right opportunity</option>
                        </select>
                        <div class="validation-message" id="investment-level-validation"></div>
                    </div>

                    <div class="form-group">
                        <label id="incomeTimelineLabel">Timeline to first income: <span class="required">*</span></label>
                        <select id="income-timeline" class="form-control" onchange="validateField(this)">
                            <option value="">Select timeline...</option>
                            <option value="immediate">Immediate need (within 1-2 months)</option>
                            <option value="moderate">3-6 months is fine</option>
                            <option value="patient">Can wait 6-12 months for good business</option>
                            <option value="long-term">Building for long-term (1+ years)</option>
                        </select>
                        <div class="validation-message" id="income-timeline-validation"></div>
                    </div>

                    <button class="continue-btn visible" onclick="proceedWithQuestionnaire()" id="proceedBtn">
                        <span id="proceedBtnText">Start AI-Powered Analysis</span>
                    </button>
                </div>

                <!-- Enhanced Interactive AI Workflow -->
                <div id="interactiveAIWorkflow" class="hidden">
                    <div class="step-description">
                        <h2>AI-Powered Business Plan Creation</h2>
                        <p>Follow the 5-step process below. Each step builds on the previous one to create your comprehensive business plan and interactive calendar.</p>
                    </div>

                    <div class="interactive-ai-workflow">
                        <!-- Step 1: ChatGPT Business Ideas -->
                        <div class="ai-step-container current" id="ai-step-1-container">
                            <div class="ai-step-header">
                                <div class="ai-step-title">
                                    <div class="ai-step-number">1</div>
                                    <span>ChatGPT Business Ideas</span>
                                </div>
                                <div class="ai-step-status">Current Step</div>
                            </div>
                            
                            <div class="ai-step-content">
                                <div class="instructions-box">
                                    <div class="instructions-title">Instructions:</div>
                                    <ul class="instructions-list">
                                        <li>Copy the prompt below</li>
                                        <li>Open ChatGPT in a new tab</li>
                                        <li>Paste the prompt and submit</li>
                                        <li>Copy ChatGPT's complete response</li>
                                        <li>Paste the response in the box below</li>
                                        <li>Click "Generate Next Prompt" to continue</li>
                                    </ul>
                                </div>

                                <div class="ai-prompt-area">
                                    <label class="ai-prompt-label">Generated Prompt for ChatGPT:</label>
                                    
                                    <!-- Interactive Prompt Customizer -->
                                    <div class="prompt-customizer" id="chatgpt-customizer">
                                        <div class="prompt-editor">
                                            <div class="prompt-templates">
                                                <button class="template-btn active" onclick="selectPromptTemplate('chatgpt', 'realistic')">Realistic Focus</button>
                                                <button class="template-btn" onclick="selectPromptTemplate('chatgpt', 'creative')">Creative Ideas</button>
                                                <button class="template-btn" onclick="selectPromptTemplate('chatgpt', 'practical')">Practical Only</button>
                                                <button class="template-btn" onclick="selectPromptTemplate('chatgpt', 'custom')">Custom</button>
                                            </div>
                                            
                                            <div class="context-variables">
                                                <div class="variable-grid" id="chatgpt-variables">
                                                    <div class="variable-item">
                                                        <div class="variable-label">👤 User Profile</div>
                                                        <div class="variable-value" id="var-user-profile">Loading...</div>
                                                    </div>
                                                    <div class="variable-item">
                                                        <div class="variable-label">🎯 Selected Path</div>
                                                        <div class="variable-value" id="var-selected-path">Loading...</div>
                                                    </div>
                                                    <div class="variable-item">
                                                        <div class="variable-label">💰 Investment Level</div>
                                                        <div class="variable-value" id="var-investment">Loading...</div>
                                                    </div>
                                                    <div class="variable-item">
                                                        <div class="variable-label">⏰ Timeline</div>
                                                        <div class="variable-value" id="var-timeline">Loading...</div>
                                                    </div>
                                                </div>
                                                <div class="context-chips">
                                                    <span class="context-chip">Realism Instructions</span>
                                                    <span class="context-chip dynamic">Family Context</span>
                                                    <span class="context-chip user">Budget Constraints</span>
                                                    <span class="context-chip dynamic">Geographic: Lincoln, NE</span>
                                                </div>
                                            </div>
                                            
                                            <div class="advanced-options" id="chatgpt-advanced">
                                                <div class="option-group">
                                                    <label class="option-label">Prompt Tone:</label>
                                                    <select class="option-select" id="chatgpt-tone" onchange="updatePromptPreview('chatgpt')">
                                                        <option value="encouraging">Encouraging & Supportive</option>
                                                        <option value="realistic" selected>Realistic & Honest</option>
                                                        <option value="detailed">Detailed & Analytical</option>
                                                        <option value="simple">Simple & Direct</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="option-group">
                                                    <label class="option-label">Focus Areas:</label>
                                                    <div class="checkbox-group">
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="focus-time" checked onchange="updatePromptPreview('chatgpt')">
                                                            <label for="focus-time">Time Management</label>
                                                        </div>
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="focus-budget" checked onchange="updatePromptPreview('chatgpt')">
                                                            <label for="focus-budget">Budget Constraints</label>
                                                        </div>
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="focus-family" checked onchange="updatePromptPreview('chatgpt')">
                                                            <label for="focus-family">Family Integration</label>
                                                        </div>
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="focus-skills" onchange="updatePromptPreview('chatgpt')">
                                                            <label for="focus-skills">Skill Building</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="option-group">
                                                    <label class="option-label">Number of Ideas:</label>
                                                    <select class="option-select" id="chatgpt-ideas" onchange="updatePromptPreview('chatgpt')">
                                                        <option value="3">3 Ideas (Focused)</option>
                                                        <option value="5" selected>5 Ideas (Balanced)</option>
                                                        <option value="7">7 Ideas (Comprehensive)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="prompt-actions">
                                                <button class="prompt-action-btn generate" onclick="generateInteractivePrompt('chatgpt')">
                                                    ⚡ Generate Enhanced Prompt
                                                </button>
                                                <button class="prompt-action-btn customize" onclick="toggleAdvancedOptions('chatgpt')">
                                                    ⚙️ Advanced Options
                                                </button>
                                                <button class="prompt-action-btn reset" onclick="resetPromptToDefault('chatgpt')">
                                                    🔄 Reset to Default
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Enhanced Prompt Preview -->
                                    <div class="prompt-preview" id="chatgpt-preview">
                                        <div class="preview-header">
                                            <div class="preview-title">📋 Enhanced Prompt Preview</div>
                                            <div class="preview-stats">
                                                <span id="chatgpt-word-count">0 words</span>
                                                <span id="chatgpt-char-count">0 characters</span>
                                                <span id="chatgpt-readability">Readability: Good</span>
                                            </div>
                                        </div>
                                        <div class="prompt-final" id="chatgpt-prompt-final">Click "Generate Enhanced Prompt" to see your customized prompt...</div>
                                        <div class="prompt-help">
                                            <strong>💡 Tip:</strong> This enhanced prompt includes your specific family situation, budget constraints, and realistic timelines. 
                                            It's designed to get more practical, actionable business ideas from ChatGPT.
                                        </div>
                                    </div>
                                    
                                    <textarea id="chatgpt-prompt" class="ai-prompt-textarea" readonly placeholder="Your enhanced ChatGPT prompt will be generated here..."></textarea>
                                </div>

                                <div class="ai-buttons">
                                    <button class="ai-btn copy" onclick="copyToClipboard('chatgpt-prompt')">Copy Prompt</button>
                                    <button class="ai-btn open" onclick="openChatGPT()">Open ChatGPT</button>
                                </div>

                                <div class="ai-response-area">
                                    <label class="ai-prompt-label">Paste ChatGPT's Response Here:</label>
                                    <textarea id="chatgpt-response" class="ai-response-textarea" placeholder="Paste the complete response from ChatGPT here..." oninput="checkResponseAndEnableNext(1)"></textarea>
                                </div>

                                <div class="ai-buttons">
                                    <button class="ai-btn next" id="next-btn-1" onclick="generateNextPrompt(2)" disabled>Generate Next Prompt</button>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Gemini Market Research -->
                        <div class="ai-step-container pending" id="ai-step-2-container">
                            <div class="ai-step-header">
                                <div class="ai-step-title">
                                    <div class="ai-step-number">2</div>
                                    <span>Gemini Market Research</span>
                                </div>
                                <div class="ai-step-status">Waiting</div>
                            </div>
                            
                            <div class="ai-step-content">
                                <div class="instructions-box">
                                    <div class="instructions-title">Instructions:</div>
                                    <ul class="instructions-list">
                                        <li>Copy the prompt below (generated from your ChatGPT response)</li>
                                        <li>Open Gemini in a new tab</li>
                                        <li>Paste the prompt and submit</li>
                                        <li>IMPORTANT: Choose "Deep Search" option when prompted</li>
                                        <li>Wait for complete Deep Search results</li>
                                        <li>Copy Gemini's complete response</li>
                                        <li>Paste the response in the box below</li>
                                    </ul>
                                </div>

                                <div class="ai-prompt-area">
                                    <label class="ai-prompt-label">Generated Prompt for Gemini (Market Research):</label>
                                    
                                    <!-- Interactive Prompt Customizer for Gemini -->
                                    <div class="prompt-customizer" id="gemini-market-customizer">
                                        <div class="prompt-editor">
                                            <div class="prompt-templates">
                                                <button class="template-btn active" onclick="selectPromptTemplate('gemini-market', 'comprehensive')">Comprehensive Research</button>
                                                <button class="template-btn" onclick="selectPromptTemplate('gemini-market', 'quick')">Quick Validation</button>
                                                <button class="template-btn" onclick="selectPromptTemplate('gemini-market', 'local')">Local Focus</button>
                                                <button class="template-btn" onclick="selectPromptTemplate('gemini-market', 'custom')">Custom</button>
                                            </div>
                                            
                                            <div class="context-variables">
                                                <div class="variable-grid">
                                                    <div class="variable-item">
                                                        <div class="variable-label">🏢 Business Ideas</div>
                                                        <div class="variable-value" id="var-business-ideas">From ChatGPT response...</div>
                                                    </div>
                                                    <div class="variable-item">
                                                        <div class="variable-label">📍 Location</div>
                                                        <div class="variable-value">Lincoln, Nebraska</div>
                                                    </div>
                                                    <div class="variable-item">
                                                        <div class="variable-label">🎯 Research Depth</div>
                                                        <div class="variable-value">Deep Search Enabled</div>
                                                    </div>
                                                </div>
                                                <div class="context-chips">
                                                    <span class="context-chip">Market Validation</span>
                                                    <span class="context-chip dynamic">Competition Analysis</span>
                                                    <span class="context-chip user">Local Market Focus</span>
                                                    <span class="context-chip dynamic">2024-2025 Data</span>
                                                </div>
                                            </div>
                                            
                                            <div class="advanced-options" id="gemini-market-advanced" style="display: none;">
                                                <div class="option-group">
                                                    <label class="option-label">Research Focus:</label>
                                                    <div class="checkbox-group">
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="research-demand" checked onchange="updatePromptPreview('gemini-market')">
                                                            <label for="research-demand">Market Demand</label>
                                                        </div>
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="research-competition" checked onchange="updatePromptPreview('gemini-market')">
                                                            <label for="research-competition">Competition Analysis</label>
                                                        </div>
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="research-pricing" checked onchange="updatePromptPreview('gemini-market')">
                                                            <label for="research-pricing">Pricing Research</label>
                                                        </div>
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="research-trends" onchange="updatePromptPreview('gemini-market')">
                                                            <label for="research-trends">Market Trends</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="prompt-actions">
                                                <button class="prompt-action-btn generate" onclick="generateInteractivePrompt('gemini-market')">
                                                    🔍 Generate Research Prompt
                                                </button>
                                                <button class="prompt-action-btn customize" onclick="toggleAdvancedOptions('gemini-market')">
                                                    ⚙️ Research Options
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="prompt-preview" id="gemini-market-preview">
                                        <div class="preview-header">
                                            <div class="preview-title">🔍 Market Research Prompt Preview</div>
                                            <div class="preview-stats">
                                                <span id="gemini-market-word-count">0 words</span>
                                                <span id="gemini-market-char-count">0 characters</span>
                                            </div>
                                        </div>
                                        <div class="prompt-final" id="gemini-market-prompt-final">Generate your market research prompt...</div>
                                        <div class="prompt-help">
                                            <strong>🎯 Research Tip:</strong> This prompt is optimized for Gemini's Deep Search feature to get the most current and relevant market data.
                                        </div>
                                    </div>
                                    
                                    <textarea id="gemini-market-prompt" class="ai-prompt-textarea" readonly placeholder="This prompt will be generated after you complete Step 1..."></textarea>
                                </div>

                                <div class="ai-buttons">
                                    <button class="ai-btn copy" onclick="copyToClipboard('gemini-market-prompt')" disabled id="copy-market-btn">Copy Prompt</button>
                                    <button class="ai-btn open" onclick="openGemini()" disabled id="open-gemini-market-btn">Open Gemini</button>
                                    <button class="ai-btn back" onclick="goBackToStep(1)">Go Back</button>
                                </div>

                                <div class="ai-response-area">
                                    <label class="ai-prompt-label">Paste Gemini's Market Research Response Here:</label>
                                    <textarea id="gemini-market-response" class="ai-response-textarea" placeholder="Paste the complete market research response from Gemini here..." oninput="checkResponseAndEnableNext(2)"></textarea>
                                </div>

                                <div class="ai-buttons">
                                    <button class="ai-btn next" id="next-btn-2" onclick="generateNextPrompt(3)" disabled>Generate Next Prompt</button>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Gemini Pricing Research -->
                        <div class="ai-step-container pending" id="ai-step-3-container">
                            <div class="ai-step-header">
                                <div class="ai-step-title">
                                    <div class="ai-step-number">3</div>
                                    <span>Gemini Pricing Research</span>
                                </div>
                                <div class="ai-step-status">Waiting</div>
                            </div>
                            
                            <div class="ai-step-content">
                                <div class="instructions-box">
                                    <div class="instructions-title">Instructions:</div>
                                    <ul class="instructions-list">
                                        <li>Copy the pricing research prompt below</li>
                                        <li>Open Gemini in a new tab</li>
                                        <li>Paste the prompt and submit</li>
                                        <li>IMPORTANT: Choose "Deep Search" option when prompted</li>
                                        <li>Wait for complete Deep Search results</li>
                                        <li>Copy Gemini's complete pricing response</li>
                                        <li>Paste the response in the box below</li>
                                    </ul>
                                </div>

                                <div class="ai-prompt-area">
                                    <label class="ai-prompt-label">Generated Prompt for Gemini (Pricing Research):</label>
                                    
                                    <!-- Interactive Prompt Customizer for Pricing -->
                                    <div class="prompt-customizer" id="gemini-pricing-customizer">
                                        <div class="prompt-editor">
                                            <div class="prompt-templates">
                                                <button class="template-btn active" onclick="selectPromptTemplate('gemini-pricing', 'beginner')">Beginner Pricing</button>
                                                <button class="template-btn" onclick="selectPromptTemplate('gemini-pricing', 'competitive')">Competitive Analysis</button>
                                                <button class="template-btn" onclick="selectPromptTemplate('gemini-pricing', 'progressive')">Growth Pricing</button>
                                                <button class="template-btn" onclick="selectPromptTemplate('gemini-pricing', 'custom')">Custom</button>
                                            </div>
                                            
                                            <div class="context-variables">
                                                <div class="variable-grid">
                                                    <div class="variable-item">
                                                        <div class="variable-label">📊 Market Data</div>
                                                        <div class="variable-value" id="var-market-data">From market research...</div>
                                                    </div>
                                                    <div class="variable-item">
                                                        <div class="variable-label">💼 Business Type</div>
                                                        <div class="variable-value" id="var-business-type">Service-based</div>
                                                    </div>
                                                    <div class="variable-item">
                                                        <div class="variable-label">⏱️ Experience Level</div>
                                                        <div class="variable-value">Beginner</div>
                                                    </div>
                                                </div>
                                                <div class="context-chips">
                                                    <span class="context-chip">Beginner-Friendly</span>
                                                    <span class="context-chip dynamic">Geographic Pricing</span>
                                                    <span class="context-chip user">Growth Strategy</span>
                                                    <span class="context-chip dynamic">Market Rates</span>
                                                </div>
                                            </div>
                                            
                                            <div class="advanced-options" id="gemini-pricing-advanced" style="display: none;">
                                                <div class="option-group">
                                                    <label class="option-label">Pricing Strategy Focus:</label>
                                                    <div class="checkbox-group">
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="pricing-beginner" checked onchange="updatePromptPreview('gemini-pricing')">
                                                            <label for="pricing-beginner">Beginner Rates</label>
                                                        </div>
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="pricing-progression" checked onchange="updatePromptPreview('gemini-pricing')">
                                                            <label for="pricing-progression">Growth Progression</label>
                                                        </div>
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="pricing-packages" onchange="updatePromptPreview('gemini-pricing')">
                                                            <label for="pricing-packages">Package Deals</label>
                                                        </div>
                                                        <div class="checkbox-item">
                                                            <input type="checkbox" class="option-checkbox" id="pricing-seasonal" onchange="updatePromptPreview('gemini-pricing')">
                                                            <label for="pricing-seasonal">Seasonal Pricing</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="option-group">
                                                    <label class="option-label">Timeline Focus:</label>
                                                    <select class="option-select" id="pricing-timeline" onchange="updatePromptPreview('gemini-pricing')">
                                                        <option value="immediate">Immediate (0-3 months)</option>
                                                        <option value="short" selected>Short-term (3-6 months)</option>
                                                        <option value="medium">Medium-term (6-12 months)</option>
                                                        <option value="long">Long-term (1+ years)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="prompt-actions">
                                                <button class="prompt-action-btn generate" onclick="generateInteractivePrompt('gemini-pricing')">
                                                    💰 Generate Pricing Prompt
                                                </button>
                                                <button class="prompt-action-btn customize" onclick="toggleAdvancedOptions('gemini-pricing')">
                                                    ⚙️ Pricing Options
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="prompt-preview" id="gemini-pricing-preview">
                                        <div class="preview-header">
                                            <div class="preview-title">💰 Pricing Research Prompt Preview</div>
                                            <div class="preview-stats">
                                                <span id="gemini-pricing-word-count">0 words</span>
                                                <span id="gemini-pricing-char-count">0 characters</span>
                                            </div>
                                        </div>
                                        <div class="prompt-final" id="gemini-pricing-prompt-final">Generate your pricing research prompt...</div>
                                        <div class="prompt-help">
                                            <strong>💡 Pricing Tip:</strong> This prompt focuses on realistic beginner pricing that actually gets clients, not scary expert rates.
                                        </div>
                                    </div>
                                    
                                    <textarea id="gemini-pricing-prompt" class="ai-prompt-textarea" readonly placeholder="This prompt will be generated after you complete Step 2..."></textarea>
                                </div>

                                <div class="ai-buttons">
                                    <button class="ai-btn copy" onclick="copyToClipboard('gemini-pricing-prompt')" disabled id="copy-pricing-btn">Copy Prompt</button>
                                    <button class="ai-btn open" onclick="openGemini()" disabled id="open-gemini-pricing-btn">Open Gemini</button>
                                    <button class="ai-btn back" onclick="goBackToStep(2)">Go Back</button>
                                </div>

                                <div class="ai-response-area">
                                    <label class="ai-prompt-label">Paste Gemini's Pricing Research Response Here:</label>
                                    <textarea id="gemini-pricing-response" class="ai-response-textarea" placeholder="Paste the complete pricing research response from Gemini here..." oninput="checkResponseAndEnableNext(3)"></textarea>
                                </div>

                                <div class="ai-buttons">
                                    <button class="ai-btn next" id="next-btn-3" onclick="generateNextPrompt(4)" disabled>Generate Next Prompt</button>
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Claude Interactive Calendar -->
                        <div class="ai-step-container pending" id="ai-step-4-container">
                            <div class="ai-step-header">
                                <div class="ai-step-title">
                                    <div class="ai-step-number">4</div>
                                    <span>Claude Interactive Calendar</span>
                                </div>
                                <div class="ai-step-status">Waiting</div>
                            </div>
                            
                            <div class="ai-step-content">
                                <div class="instructions-box">
                                    <div class="instructions-title">Instructions:</div>
                                    <ul class="instructions-list">
                                        <li>Copy the comprehensive prompt below</li>
                                        <li>Open Claude in a new tab</li>
                                        <li>Paste the prompt and submit</li>
                                        <li>Wait for Claude to create your interactive calendar</li>
                                        <li>Copy the ENTIRE calendar artifact code from Claude</li>
                                        <li>Paste the calendar code below to complete your workflow</li>
                                    </ul>
                                </div>

                                <div class="ai-prompt-area">
                                    <label class="ai-prompt-label">Generated Prompt for Claude (Interactive Calendar):</label>
                                    <textarea id="claude-calendar-prompt" class="ai-prompt-textarea" readonly placeholder="This prompt will be generated after you complete Step 3..."></textarea>
                                </div>

                                <div class="ai-buttons">
                                    <button class="ai-btn copy" onclick="copyToClipboard('claude-calendar-prompt')" disabled id="copy-claude-btn">Copy Prompt</button>
                                    <button class="ai-btn open" onclick="openClaude()" disabled id="open-claude-btn">Open Claude</button>
                                    <button class="ai-btn back" onclick="goBackToStep(3)">Go Back</button>
                                </div>

                                <div class="ai-response-area">
                                    <label class="ai-prompt-label">Paste Your Complete Calendar Code Here:</label>
                                    <textarea id="claude-calendar-code" class="ai-response-textarea" placeholder="Paste the complete interactive calendar artifact code from Claude here..." oninput="checkCalendarCodeAndEnableFinish()"></textarea>
                                </div>

                                <div class="ai-buttons">
                                    <button class="ai-btn next" id="finish-workflow-btn" onclick="finishAIWorkflow()" disabled>Complete Workflow</button>
                                </div>
                            </div>
                        </div>

                        <!-- Step 5: Final Dashboard -->
                        <div class="ai-step-container pending" id="ai-step-5-container">
                            <div class="ai-step-header">
                                <div class="ai-step-title">
                                    <div class="ai-step-number">5</div>
                                    <span>Final Dashboard</span>
                                </div>
                                <div class="ai-step-status">Waiting</div>
                            </div>
                            
                            <div class="ai-step-content">
                                <p>Your complete Smart Mom Method plan will be displayed here once all steps are completed.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Calendar Display -->
                <div id="interactiveCalendarDisplay" class="hidden">
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <h2 style="font-family: 'Playfair Display', serif; color: var(--sage-green); margin-bottom: 15px;">Your Interactive 12-Week Calendar</h2>
                            <p style="color: var(--charcoal); opacity: 0.8;">Track your progress, check off completed tasks, and stay organized on your journey!</p>
                        </div>

                        <!-- Calendar Stats -->
                        <div class="calendar-stats">
                            <div class="stat-item">
                                <div class="stat-number" id="totalTasks">0</div>
                                <div class="stat-label">Total Tasks</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="completedTasks">0</div>
                                <div class="stat-label">Completed</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="overallProgress">0%</div>
                                <div class="stat-label">Progress</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="currentWeekProgress">0%</div>
                                <div class="stat-label">This Week</div>
                            </div>
                        </div>

                        <!-- Parse Calendar Section (shown if no calendar data) -->
                        <div class="parse-calendar-section" id="parseCalendarSection">
                            <h3>Paste Your Calendar from Claude</h3>
                            <p style="margin-bottom: 20px;">Copy the complete calendar code from Claude and paste it below to create your interactive calendar:</p>
                            <textarea id="calendarInput" class="calendar-input" placeholder="Paste your calendar content here...

Example format:
WEEK 1 - DAY 1:
Task 1: Create Instagram Business Account (FREE - 30 minutes)
- Step 1: Go to instagram.com/business
- Step 2: Click 'Create account' → Select 'Business Account'
- Step 3: Choose username: [yourname] + 'business'

WEEK 1 - DAY 2:
Task 1: Research Competitors (FREE - 45 minutes)
- Step 1: Search Google for '[your service] in [location]'
- Step 2: Make list of top 5 competitors"></textarea>
                            <button class="parse-btn" onclick="parseAndDisplayCalendar()">Create Interactive Calendar</button>
                        </div>

                        <!-- Calendar Navigation -->
                        <div class="calendar-navigation" id="calendarNavigation" style="display: none;">
                            <div class="week-selector" id="weekSelector">
                                <!-- Week buttons will be generated here -->
                            </div>
                            <div class="calendar-progress">
                                <div class="progress-circle" id="progressCircle">
                                    <span id="progressPercent">0%</span>
                                </div>
                                <div>
                                    <div style="font-weight: 600;">Week Progress</div>
                                    <div style="font-size: 14px; opacity: 0.7;" id="weekProgressText">0 of 0 tasks completed</div>
                                </div>
                            </div>
                        </div>

                        <!-- Calendar Content -->
                        <div id="calendarContent">
                            <!-- Week contents will be generated here -->
                        </div>

                        <!-- Calendar Actions -->
                        <div class="calendar-actions" id="calendarActions" style="display: none;">
                            <button class="calendar-btn" onclick="downloadCalendarProgress()">Download Progress</button>
                            <button class="calendar-btn secondary" onclick="printCalendar()">Print Calendar</button>
                            <button class="calendar-btn" onclick="resetCalendarProgress()">Reset Progress</button>
                            <button class="calendar-btn secondary" onclick="skipToPaymentOptions()">Get Professional Help</button>
                        </div>

                        <!-- Empty State -->
                        <div class="calendar-empty" id="calendarEmpty">
                            <h3>🗓️ Ready to Create Your Calendar?</h3>
                            <p>Complete the AI workflow above to generate your personalized interactive calendar, or paste existing calendar content to get started!</p>
                        </div>
                    </div>
                </div>

                <!-- Final Dashboard -->
                <div id="finalDashboard" class="hidden">
                    <div class="final-dashboard">
                        <div class="dashboard-header">
                            <h2>Your Complete Smart Mom Method Plan</h2>
                            <p>Here's your comprehensive business plan with integrated pricing strategy and interactive calendar.</p>
                        </div>
                        
                        <div class="dashboard-grid">
                            <div class="dashboard-section">
                                <h3>Business Plan Summary</h3>
                                <div id="business-summary-content" class="business-summary">
                                    <p>Your business plan summary will appear here based on all AI responses.</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-section">
                                <h3>Market Research Results</h3>
                                <div id="market-research-summary" class="business-summary">
                                    <p>Your market research insights will appear here.</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-section">
                                <h3>Pricing Strategy</h3>
                                <div id="pricing-strategy-summary" class="business-summary">
                                    <p>Your pricing research results will appear here.</p>
                                </div>
                            </div>
                            
                            <div class="dashboard-section">
                                <h3>Interactive Calendar</h3>
                                <div id="calendar-preview-display" class="calendar-preview">
                                    <div style="text-align: center; padding: 20px;">
                                        <p style="margin-bottom: 20px;">Your interactive calendar is ready!</p>
                                        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                            <button class="ai-btn open" onclick="showInteractiveCalendar()" style="margin-top: 10px;">View Interactive Calendar</button>
                                            <button class="ai-btn copy" onclick="previewCalendar()" style="margin-top: 10px;">Preview Calendar Code</button>
                                        </div>
                                        <p style="margin-top: 15px; font-size: 14px; opacity: 0.7;">
                                            Click "View Interactive Calendar" to use your personalized calendar with progress tracking.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="final-actions">
                            <button class="final-action-btn primary" onclick="showInteractiveCalendar()">
                                📅 Use Interactive Calendar
                            </button>
                            <button class="final-action-btn" onclick="downloadCompletePackage()">
                                Download Complete Package
                            </button>
                            <button class="final-action-btn" onclick="skipToPaymentOptions()">
                                Get Professional Implementation
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Success Message -->
                <div id="successMessage" class="hidden" style="background: linear-gradient(135deg, var(--sage-green), var(--deep-teal)); color: white; padding: 60px 40px; text-align: center; border-radius: 24px; margin: 40px 0;">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 2.5rem; margin-bottom: 20px;">🎉 Thank You!</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 30px; opacity: 0.9;">Your information has been saved successfully!</p>
                    
                    <div style="background: rgba(255,255,255,0.15); padding: 30px; border-radius: 16px; margin: 30px 0;">
                        <h3 style="margin-bottom: 15px;">What's Next:</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin: 10px 0;">📧 Check your email for welcome information</li>
                            <li style="margin: 10px 0;">📅 You can now proceed with the AI workflow</li>
                            <li style="margin: 10px 0;">💾 Your progress will be automatically saved</li>
                            <li style="margin: 10px 0;">🔒 Your data is secure in our Airtable database</li>
                        </ul>
                    </div>

                    <button onclick="proceedToAIWorkflow()" style="background: var(--soft-gold); color: white; padding: 20px 40px; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: 600; cursor: pointer; margin: 10px;">
                        Continue to AI Analysis
                    </button>
                    
                    <button onclick="startOver()" style="background: white; color: var(--sage-green); padding: 20px 40px; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: 600; cursor: pointer; margin: 10px;">
                        Create Another Plan
                    </button>
                </div>

                <!-- Payment Options -->
                <div id="paymentOptions" class="hidden">
                    <div style="background: linear-gradient(135deg, var(--sage-green), var(--deep-teal)); color: white; padding: 50px 40px; border-radius: 24px; margin: 40px 0; text-align: center;">
                        <h2 style="font-family: 'Playfair Display', serif; font-size: 2.5rem; margin-bottom: 20px;">Transform Your Plan Into Action</h2>
                        <p style="font-size: 1.2rem; margin-bottom: 40px; opacity: 0.9;">You've got the ideas - now let's make them happen! Get your personalized interactive calendar and expert guidance to succeed.</p>
                        
                        <!-- Back to Planning Button -->
                        <div style="text-align: center; margin-bottom: 30px;">
                            <button onclick="returnToPlanningProcess()" style="background: var(--deep-teal); color: white; padding: 12px 24px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                                ← Return to Free Planning Process
                            </button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-top: 40px;">
                            <!-- FREE Life Organization Support Card -->
                            <div style="background: white; color: var(--charcoal); padding: 40px 30px; border-radius: 20px; transition: all 0.3s ease;">
                                <div style="font-size: 3rem; font-weight: 700; color: var(--sage-green); margin-bottom: 10px;">$0</div>
                                <div style="font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; color: var(--charcoal);">Life Organization Support</div>
                                <div style="margin-bottom: 20px; color: var(--charcoal); opacity: 0.8;">Struggling with daily chaos? Let's troubleshoot your family organization challenges together!</div>
                                <ul style="list-style: none; margin-bottom: 30px; text-align: left;">
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        30-minute support call
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Family schedule troubleshooting
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Organization quick wins
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Executive function strategies
                                    </li>
                                </ul>
                                <button onclick="window.open('https://calendly.com/momsurvivaltoolkit/free-smart-mom-call-30-min', '_blank')" style="width: 100%; padding: 15px; background: var(--sage-green); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                                    Book Free Support Call
                                </button>
                            </div>

                            <!-- FREE Business Planning Support Card -->
                            <div style="background: white; color: var(--charcoal); padding: 40px 30px; border-radius: 20px; transition: all 0.3s ease;">
                                <div style="font-size: 3rem; font-weight: 700; color: var(--sage-green); margin-bottom: 10px;">$0</div>
                                <div style="font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; color: var(--charcoal);">Business Planning Support</div>
                                <div style="margin-bottom: 20px; color: var(--charcoal); opacity: 0.8;">Stuck with your business calendar? Let's troubleshoot your entrepreneurial challenges together!</div>
                                <ul style="list-style: none; margin-bottom: 30px; text-align: left;">
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        30-minute strategy call
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Business calendar troubleshooting
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Revenue planning advice
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Mom entrepreneur tips
                                    </li>
                                </ul>
                                <button onclick="window.open('https://calendly.com/momsurvivaltoolkit/30min', '_blank')" style="width: 100%; padding: 15px; background: var(--sage-green); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                                    Book Free Strategy Call
                                </button>
                            </div>

                            <div style="background: white; color: var(--charcoal); padding: 40px 30px; border-radius: 20px; transition: all 0.3s ease;">
                                <div style="font-size: 3rem; font-weight: 700; color: var(--sage-green); margin-bottom: 10px;">$39</div>
                                <div style="font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; color: var(--charcoal);">Life Organization Calendar</div>
                                <ul style="list-style: none; margin-bottom: 30px; text-align: left;">
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Personalized interactive calendar
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Daily routines & time blocks
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Family schedule optimization
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Goal tracking templates
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Printable planning sheets
                                    </li>
                                </ul>
                                <button onclick="window.open('https://buy.stripe.com/cN100gj9M0fo83eUa1a17Vm07', '_blank')" style="width: 100%; padding: 15px; background: var(--sage-green); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                                    Get Life Calendar
                                </button>
                            </div>

                            <div style="background: white; color: var(--charcoal); padding: 40px 30px; border-radius: 20px; transition: all 0.3s ease; border: 3px solid var(--soft-gold);">
                                <div style="font-size: 3rem; font-weight: 700; color: var(--sage-green); margin-bottom: 10px;">$89</div>
                                <div style="font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; color: var(--charcoal);">Life + Training Package</div>
                                <ul style="list-style: none; margin-bottom: 30px; text-align: left;">
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Everything in Life Calendar
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        90-minute video training course
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Step-by-step implementation guide
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Time management strategies
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Bonus productivity tools
                                    </li>
                                </ul>
                                <button onclick="window.open('https://buy.stripe.com/5kQ6oHb946RSn22zbz7Vm06', '_blank')" style="width: 100%; padding: 15px; background: var(--soft-gold); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                                    Get Life + Training
                                </button>
                            </div>

                            <div style="background: white; color: var(--charcoal); padding: 40px 30px; border-radius: 20px; transition: all 0.3s ease;">
                                <div style="font-size: 3rem; font-weight: 700; color: var(--sage-green); margin-bottom: 10px;">$49</div>
                                <div style="font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; color: var(--charcoal);">Business Launch Calendar</div>
                                <ul style="list-style: none; margin-bottom: 30px; text-align: left;">
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Business planning calendar
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Revenue milestone tracking
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Marketing action plans
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Client management system
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Financial tracking tools
                                    </li>
                                </ul>
                                <button onclick="window.open('https://buy.stripe.com/3cI8wP7NS2BmbLqgc9L7Vm05', '_blank')" style="width: 100%; padding: 15px; background: var(--sage-green); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                                    Get Business Calendar
                                </button>
                            </div>

                            <div style="background: white; color: var(--charcoal); padding: 40px 30px; border-radius: 20px; transition: all 0.3s ease; border: 3px solid var(--soft-gold);">
                                <div style="font-size: 3rem; font-weight: 700; color: var(--sage-green); margin-bottom: 10px;">$100</div>
                                <div style="font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; color: var(--charcoal);">Complete Business Package</div>
                                <ul style="list-style: none; margin-bottom: 30px; text-align: left;">
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Everything in Business Calendar
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        2-hour business training course
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Market research templates
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Pricing & sales strategies
                                    </li>
                                    <li style="padding: 8px 0; position: relative; padding-left: 25px;">
                                        <span style="position: absolute; left: 0; color: var(--sage-green); font-weight: bold;">✓</span>
                                        Launch timeline with milestones
                                    </li>
                                </ul>
                                <button onclick="window.open('https://buy.stripe.com/fZu8wP8RW1x8i18eec97Vm04', '_blank')" style="width: 100%; padding: 15px; background: var(--soft-gold); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                                    Get Complete Package
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== AIRTABLE CONFIGURATION =====
        const airtableConfig = {
            baseId: "appQUFJzVLlHbB4Fp",
            apiKey: "patje3I65ajVyNTSN.3963cc18c6dc227b6e290d5da83da3bde2f4d089d60d4a0e49787fecdb676f65",
            apiUrl: "https://api.airtable.com/v0/appQUFJzVLlHbB4Fp"
        };

        const WEBHOOK_URL = 'https://momsurvivaltoolkit.app.n8n.cloud/webhook-test/smart-mom-form';

        // ===== GLOBAL VARIABLES =====
        let currentLanguage = 'en';
        let selectedPath = '';
        let authMode = 'signup';
        let currentUser = null;
        let formData = {};
        let currentStep = 1;
        let currentAIStep = 1;
        let aiResponses = {};
        let calendarData = null;
        let currentWeek = 1;

        // AI Platform URLs
        const AI_PLATFORMS = {
            chatgpt: 'https://chat.openai.com',
            gemini: 'https://gemini.google.com',
            claude: 'https://claude.ai'
        };

        // AI Realism Instructions
        const realismInstructions = `
**CRITICAL INSTRUCTIONS - BE EXTREMELY REALISTIC:**
- This person is a BEGINNER, not an expert
- Be brutally honest about challenges and timelines  
- Don't suggest businesses requiring experience they don't have
- Focus on DOWN-TO-EARTH, practical solutions only
- Consider their family constraints and available time
- If they said "free only," respect that completely
- Suggest pricing that will actually get clients, not scare them away

**REMEMBER:** A mom with 2 hours/day and no business experience should NOT be suggested:
- Businesses requiring 40+ hours/week
- High-skill services they've never done
- Anything requiring significant upfront investment (if they said free)
- Complex businesses with steep learning curves

        Focus on what's ACTUALLY doable for their situation.
`;

        // ===== INTERACTIVE AI PROMPT GENERATION SYSTEM =====
        
        // Prompt Templates
        const promptTemplates = {
            'chatgpt': {
                'realistic': {
                    name: 'Realistic Focus',
                    tone: 'realistic',
                    emphasis: 'practical constraints and realistic timelines',
                    focusAreas: ['time', 'budget', 'family'],
                    numberOfIdeas: 5
                },
                'creative': {
                    name: 'Creative Ideas',
                    tone: 'encouraging',
                    emphasis: 'creative possibilities and innovation',
                    focusAreas: ['skills', 'family'],
                    numberOfIdeas: 7
                },
                'practical': {
                    name: 'Practical Only',
                    tone: 'simple',
                    emphasis: 'immediate actionable steps',
                    focusAreas: ['time', 'budget'],
                    numberOfIdeas: 3
                },
                'custom': {
                    name: 'Custom',
                    tone: 'realistic',
                    emphasis: 'user-defined focus',
                    focusAreas: ['time', 'budget', 'family'],
                    numberOfIdeas: 5
                }
            },
            'gemini-market': {
                'comprehensive': {
                    name: 'Comprehensive Research',
                    researchAreas: ['demand', 'competition', 'pricing', 'trends'],
                    depth: 'deep',
                    focus: 'complete market analysis'
                },
                'quick': {
                    name: 'Quick Validation',
                    researchAreas: ['demand', 'competition'],
                    depth: 'surface',
                    focus: 'rapid validation'
                },
                'local': {
                    name: 'Local Focus',
                    researchAreas: ['demand', 'competition', 'pricing'],
                    depth: 'deep',
                    focus: 'local market conditions'
                },
                'custom': {
                    name: 'Custom',
                    researchAreas: ['demand', 'competition'],
                    depth: 'deep',
                    focus: 'user-defined research'
                }
            },
            'gemini-pricing': {
                'beginner': {
                    name: 'Beginner Pricing',
                    focus: ['beginner', 'progression'],
                    timeline: 'short',
                    emphasis: 'entry-level pricing strategy'
                },
                'competitive': {
                    name: 'Competitive Analysis',
                    focus: ['beginner', 'progression', 'packages'],
                    timeline: 'medium',
                    emphasis: 'competitive positioning'
                },
                'progressive': {
                    name: 'Growth Pricing',
                    focus: ['progression', 'packages', 'seasonal'],
                    timeline: 'medium',
                    emphasis: 'long-term growth strategy'
                },
                'custom': {
                    name: 'Custom',
                    focus: ['beginner', 'progression'],
                    timeline: 'short',
                    emphasis: 'user-defined pricing strategy'
                }
            }
        };

        // Current prompt configurations
        let currentPromptConfigs = {
            'chatgpt': promptTemplates.chatgpt.realistic,
            'gemini-market': promptTemplates['gemini-market'].comprehensive,
            'gemini-pricing': promptTemplates['gemini-pricing'].beginner
        };

        function initializePromptGeneration() {
            // Update context variables with current user data
            updateContextVariables();
            
            // Generate initial prompts
            generateInteractivePrompt('chatgpt');
            
            // Hide advanced options initially
            document.querySelectorAll('.advanced-options').forEach(el => {
                el.style.display = 'none';
            });
        }

        function updateContextVariables() {
            // Update ChatGPT variables
            document.getElementById('var-user-profile').textContent = formData.name || 'Smart Mom';
            document.getElementById('var-selected-path').textContent = selectedPath || 'Not selected';
            document.getElementById('var-investment').textContent = formData.investmentLevel || 'Not specified';
            document.getElementById('var-timeline').textContent = formData.incomeTimeline || 'Not specified';
            
            // Update other variables based on AI responses
            if (aiResponses.step1) {
                document.getElementById('var-business-ideas').textContent = 
                    aiResponses.step1.substring(0, 100) + '...';
            }
            
            if (aiResponses.step2) {
                document.getElementById('var-market-data').textContent = 
                    aiResponses.step2.substring(0, 100) + '...';
            }
        }

        function selectPromptTemplate(aiType, templateKey) {
            // Update active template button
            const container = document.getElementById(`${aiType}-customizer`);
            container.querySelectorAll('.template-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update current configuration
            currentPromptConfigs[aiType] = { ...promptTemplates[aiType][templateKey] };
            
            // Update UI elements based on template
            updateUIFromTemplate(aiType, templateKey);
            
            // Generate new prompt
            generateInteractivePrompt(aiType);
        }

        function updateUIFromTemplate(aiType, templateKey) {
            const template = promptTemplates[aiType][templateKey];
            
            if (aiType === 'chatgpt') {
                // Update tone selection
                const toneSelect = document.getElementById('chatgpt-tone');
                if (toneSelect) toneSelect.value = template.tone;
                
                // Update focus area checkboxes
                ['time', 'budget', 'family', 'skills'].forEach(area => {
                    const checkbox = document.getElementById(`focus-${area}`);
                    if (checkbox) {
                        checkbox.checked = template.focusAreas.includes(area);
                    }
                });
                
                // Update number of ideas
                const ideasSelect = document.getElementById('chatgpt-ideas');
                if (ideasSelect) ideasSelect.value = template.numberOfIdeas.toString();
            }
            
            if (aiType === 'gemini-market') {
                // Update research focus checkboxes
                ['demand', 'competition', 'pricing', 'trends'].forEach(area => {
                    const checkbox = document.getElementById(`research-${area}`);
                    if (checkbox) {
                        checkbox.checked = template.researchAreas.includes(area);
                    }
                });
            }
            
            if (aiType === 'gemini-pricing') {
                // Update pricing focus checkboxes
                ['beginner', 'progression', 'packages', 'seasonal'].forEach(focus => {
                    const checkbox = document.getElementById(`pricing-${focus}`);
                    if (checkbox) {
                        checkbox.checked = template.focus.includes(focus);
                    }
                });
                
                // Update timeline selection
                const timelineSelect = document.getElementById('pricing-timeline');
                if (timelineSelect) timelineSelect.value = template.timeline;
            }
        }

        function toggleAdvancedOptions(aiType) {
            const advancedDiv = document.getElementById(`${aiType}-advanced`);
            if (advancedDiv) {
                const isHidden = advancedDiv.style.display === 'none';
                advancedDiv.style.display = isHidden ? 'block' : 'none';
                
                // Update button text
                const button = event.target;
                if (button) {
                    button.textContent = isHidden ? '⚙️ Hide Options' : '⚙️ Advanced Options';
                }
            }
        }

        function generateInteractivePrompt(aiType) {
            updateContextVariables();
            
            let prompt = '';
            
            switch(aiType) {
                case 'chatgpt':
                    prompt = generateEnhancedChatGPTPrompt();
                    break;
                case 'gemini-market':
                    prompt = generateEnhancedGeminiMarketPrompt();
                    break;
                case 'gemini-pricing':
                    prompt = generateEnhancedGeminiPricingPrompt();
                    break;
            }
            
            // Update the textarea and preview
            document.getElementById(`${aiType}-prompt`).value = prompt;
            updatePromptPreview(aiType, prompt);
        }

        function generateEnhancedChatGPTPrompt() {
            const config = currentPromptConfigs.chatgpt;
            const userData = formData;
            
            // Get current settings from UI
            const tone = document.getElementById('chatgpt-tone')?.value || config.tone;
            const numberOfIdeas = document.getElementById('chatgpt-ideas')?.value || config.numberOfIdeas;
            
            // Get focus areas from checkboxes
            const focusAreas = [];
            ['time', 'budget', 'family', 'skills'].forEach(area => {
                const checkbox = document.getElementById(`focus-${area}`);
                if (checkbox && checkbox.checked) {
                    focusAreas.push(area);
                }
            });
            
            let toneInstructions = '';
            switch(tone) {
                case 'encouraging':
                    toneInstructions = 'Be encouraging and supportive while maintaining realism.';
                    break;
                case 'detailed':
                    toneInstructions = 'Provide detailed, analytical breakdown of each opportunity.';
                    break;
                case 'simple':
                    toneInstructions = 'Keep explanations simple and direct. Focus on immediate next steps.';
                    break;
                default:
                    toneInstructions = 'Be brutally honest about challenges and realistic about timelines.';
            }
            
            let focusInstructions = '';
            if (focusAreas.includes('time')) {
                focusInstructions += '\n- Pay special attention to time constraints and family schedules';
            }
            if (focusAreas.includes('budget')) {
                focusInstructions += '\n- Emphasize budget-friendly options and realistic financial expectations';
            }
            if (focusAreas.includes('family')) {
                focusInstructions += '\n- Consider family integration and work-life balance';
            }
            if (focusAreas.includes('skills')) {
                focusInstructions += '\n- Include skill-building recommendations and learning paths';
            }
            
            const prompt = `${realismInstructions}

${toneInstructions}

I'm a mom with these specific details:
- Name: ${userData.name || 'Smart Mom'}
- Selected Path: ${selectedPath || 'general business guidance'}
- Investment Level: ${userData.investmentLevel || 'minimal budget'}
- Timeline: ${userData.incomeTimeline || 'as soon as possible'}
- Family Situation: ${userData.familyStructure || 'busy family'}
- Daily Schedule: ${userData.dailySchedule || 'limited time available'}
- Location: Lincoln, Nebraska

Please suggest ${numberOfIdeas} REALISTIC business ideas that fit my situation.${focusInstructions}

For each business idea, include:
1. **Business Overview**: What this actually involves day-to-day
2. **Realistic Timeline**: Honest timeline to first income
3. **Investment Required**: Startup costs and ongoing expenses
4. **First 3 Steps**: Concrete actions I can take this week
5. **Potential Challenges**: What could go wrong and how to prepare
6. **Income Potential**: Realistic revenue expectations for year 1

Focus on businesses that:
- Work with my available time and family obligations
- Match my investment level (${userData.investmentLevel || 'minimal budget'})
- Can realistically generate income within my timeline (${userData.incomeTimeline || 'as soon as possible'})
- Are appropriate for beginners in Lincoln, Nebraska market
- Have been proven successful by other moms in similar situations

Be specific about Nebraska market conditions and what actually works for mom entrepreneurs in the Midwest in 2024-2025.`;

            return prompt;
        }

        function generateEnhancedGeminiMarketPrompt() {
            const config = currentPromptConfigs['gemini-market'];
            const chatgptResponse = aiResponses.step1 || 'Previous business ideas analysis';
            
            // Get research focus areas from checkboxes
            const researchAreas = [];
            ['demand', 'competition', 'pricing', 'trends'].forEach(area => {
                const checkbox = document.getElementById(`research-${area}`);
                if (checkbox && checkbox.checked) {
                    researchAreas.push(area);
                }
            });
            
            let researchInstructions = 'Please conduct a DEEP SEARCH to research:\n';
            
            if (researchAreas.includes('demand')) {
                researchInstructions += '1. **Market Demand Analysis**: Real demand data for these business types in 2024-2025\n';
            }
            if (researchAreas.includes('competition')) {
                researchInstructions += '2. **Competition Analysis**: Who else is doing this in Lincoln, Nebraska area\n';
            }
            if (researchAreas.includes('pricing')) {
                researchInstructions += '3. **Pricing Research**: What people actually charge vs. what clients pay\n';
            }
            if (researchAreas.includes('trends')) {
                researchInstructions += '4. **Market Trends**: Growth patterns and emerging opportunities\n';
            }
            
            const prompt = `Based on this ChatGPT business analysis:
"${chatgptResponse.substring(0, 500)}..."

${researchInstructions}

**CRITICAL**: Use Deep Search to find current, accurate data from 2024-2025.

Focus specifically on:
- Lincoln, Nebraska and surrounding Midwest markets
- Small business and mom entrepreneur success stories
- Realistic market conditions (not inflated online claims)
- Seasonal considerations for Nebraska businesses
- Local business licensing and requirements
- Competition density and market saturation
- Economic factors affecting small businesses in Nebraska

For each business idea mentioned, provide:
- **Market Reality Check**: Is there actual demand in Lincoln, NE?
- **Competition Level**: How many others are doing this locally?
- **Success Stories**: Find real examples of moms succeeding in this business
- **Market Barriers**: What challenges are unique to this market?
- **Local Advantages**: What makes Lincoln, NE good/bad for this business?

Validate or challenge each business idea with real data, not theoretical possibilities.`;

            return prompt;
        }

        function generateEnhancedGeminiPricingPrompt() {
            const config = currentPromptConfigs['gemini-pricing'];
            const marketResponse = aiResponses.step2 || 'Market research findings';
            
            // Get pricing focus areas from checkboxes
            const pricingFocus = [];
            ['beginner', 'progression', 'packages', 'seasonal'].forEach(focus => {
                const checkbox = document.getElementById(`pricing-${focus}`);
                if (checkbox && checkbox.checked) {
                    pricingFocus.push(focus);
                }
            });
            
            const timeline = document.getElementById('pricing-timeline')?.value || config.timeline;
            
            let pricingInstructions = 'Please conduct a DEEP SEARCH on pricing strategies focusing on:\n';
            
            if (pricingFocus.includes('beginner')) {
                pricingInstructions += '1. **Beginner Pricing**: Rates that actually get clients (not scare them away)\n';
            }
            if (pricingFocus.includes('progression')) {
                pricingInstructions += '2. **Growth Progression**: How to increase prices over 6-12 months\n';
            }
            if (pricingFocus.includes('packages')) {
                pricingInstructions += '3. **Package Deals**: What packages work better than hourly rates\n';
            }
            if (pricingFocus.includes('seasonal')) {
                pricingInstructions += '4. **Seasonal Pricing**: How demand changes throughout the year\n';
            }
            
            let timelineInstructions = '';
            switch(timeline) {
                case 'immediate':
                    timelineInstructions = 'Focus on pricing that gets immediate clients within 1-3 months.';
                    break;
                case 'short':
                    timelineInstructions = 'Balance quick client acquisition with sustainable pricing over 3-6 months.';
                    break;
                case 'medium':
                    timelineInstructions = 'Plan pricing strategy for 6-12 month business growth.';
                    break;
                case 'long':
                    timelineInstructions = 'Design pricing for long-term business development over 1+ years.';
                    break;
            }
            
            const prompt = `Based on this market research:
"${marketResponse.substring(0, 500)}..."

${pricingInstructions}

**TIMELINE FOCUS**: ${timelineInstructions}

Use Deep Search to find real pricing data from 2024-2025. Research:

**Geographic Pricing**:
- Current market rates in Lincoln, Nebraska and Midwest region
- How Midwest pricing compares to coastal areas
- What Nebraska clients actually budget for these services

**Beginner-Specific Pricing**:
- What successful mom entrepreneurs charge in their first 6 months
- Common pricing mistakes that kill new businesses
- How to price competitively without undervaluing yourself

**Practical Pricing Strategy**:
- Package deals vs. hourly rates effectiveness for beginners
- Payment structures that work for mom entrepreneurs
- How to raise prices as you gain experience and testimonials

**Real Market Data**:
- What clients actually pay (not just what businesses quote)
- Seasonal demand fluctuations in Nebraska
- Industry standards for quality and pricing expectations

Provide ACTIONABLE pricing advice for a mom entrepreneur starting in Lincoln, Nebraska, not theoretical pricing models. Include specific dollar amounts and ranges based on current market research.`;

            return prompt;
        }

        function updatePromptPreview(aiType, prompt = null) {
            if (!prompt) {
                generateInteractivePrompt(aiType);
                return;
            }
            
            // Update preview
            const previewElement = document.getElementById(`${aiType}-prompt-final`);
            if (previewElement) {
                previewElement.textContent = prompt;
            }
            
            // Update statistics
            const wordCount = prompt.split(/\s+/).length;
            const charCount = prompt.length;
            
            const wordCountElement = document.getElementById(`${aiType}-word-count`);
            const charCountElement = document.getElementById(`${aiType}-char-count`);
            
            if (wordCountElement) wordCountElement.textContent = `${wordCount} words`;
            if (charCountElement) charCountElement.textContent = `${charCount} characters`;
            
            // Update readability (simple calculation)
            const readabilityElement = document.getElementById(`${aiType}-readability`);
            if (readabilityElement) {
                const avgWordsPerSentence = wordCount / (prompt.split(/[.!?]+/).length - 1);
                let readability = 'Good';
                if (avgWordsPerSentence > 25) readability = 'Complex';
                if (avgWordsPerSentence < 15) readability = 'Simple';
                readabilityElement.textContent = `Readability: ${readability}`;
            }
        }

        function resetPromptToDefault(aiType) {
            // Reset to default template
            const defaultTemplate = Object.keys(promptTemplates[aiType])[0];
            selectPromptTemplate(aiType, defaultTemplate);
            
            // Reset UI elements
            updateUIFromTemplate(aiType, defaultTemplate);
            
            // Regenerate prompt
            generateInteractivePrompt(aiType);
            
            // Hide advanced options
            const advancedDiv = document.getElementById(`${aiType}-advanced`);
            if (advancedDiv) {
                advancedDiv.style.display = 'none';
            }
        }

        // Enhanced version of existing functions
        function generateChatGPTPrompt(userData) {
            // Initialize the interactive system
            initializePromptGeneration();
            
            // Generate the enhanced prompt
            generateInteractivePrompt('chatgpt');
        }

        function generateGeminiMarketPrompt() {
            const chatgptResponse = aiResponses.step1;
            if (chatgptResponse) {
                generateInteractivePrompt('gemini-market');
            }
        }

        function generateGeminiPricingPrompt() {
            const marketResponse = aiResponses.step2;
            if (marketResponse) {
                generateInteractivePrompt('gemini-pricing');
            }
        }

        // ===== INTERACTIVE CALENDAR SYSTEM =====
        
        function parseCalendarContent(content) {
            if (!content || content.trim().length < 50) {
                throw new Error('Calendar content is too short or empty');
            }

            const weeks = [];
            const lines = content.split('\n');
            let currentWeek = null;
            let currentDay = null;
            let currentTask = null;

            // Regex patterns from documentation
            const weekDayPattern = /WEEK (\d+) - DAY (\d+):/;
            const taskPattern = /Task (\d+): (.*?) \((.*?)\)/;
            const stepPattern = /- Step (\d+): (.*)/;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // Check for week/day header
                const weekDayMatch = line.match(weekDayPattern);
                if (weekDayMatch) {
                    const weekNum = parseInt(weekDayMatch[1]);
                    const dayNum = parseInt(weekDayMatch[2]);

                    // Find or create week
                    let week = weeks.find(w => w.weekNumber === weekNum);
                    if (!week) {
                        week = { weekNumber: weekNum, days: [] };
                        weeks.push(week);
                    }

                    // Find or create day
                    let day = week.days.find(d => d.dayNumber === dayNum);
                    if (!day) {
                        day = { dayNumber: dayNum, tasks: [] };
                        week.days.push(day);
                    }

                    currentWeek = week;
                    currentDay = day;
                    currentTask = null;
                    continue;
                }

                // Check for task
                const taskMatch = line.match(taskPattern);
                if (taskMatch && currentDay) {
                    const taskNum = parseInt(taskMatch[1]);
                    const title = taskMatch[2].trim();
                    const metaInfo = taskMatch[3].trim();
                    
                    // Parse cost and time from meta info
                    const costMatch = metaInfo.match(/(FREE|PAID|\$\d+)/i);
                    const timeMatch = metaInfo.match(/(\d+)\s*(minutes?|mins?|hours?|hrs?)/i);
                    
                    const task = {
                        taskNumber: taskNum,
                        title: title,
                        cost: costMatch ? costMatch[1] : 'FREE',
                        time: timeMatch ? `${timeMatch[1]} ${timeMatch[2]}` : '30 minutes',
                        steps: [],
                        completed: false
                    };

                    currentDay.tasks.push(task);
                    currentTask = task;
                    continue;
                }

                // Check for step
                const stepMatch = line.match(stepPattern);
                if (stepMatch && currentTask) {
                    const stepNum = parseInt(stepMatch[1]);
                    const instruction = stepMatch[2].trim();
                    
                    currentTask.steps.push({
                        stepNumber: stepNum,
                        instruction: instruction,
                        completed: false
                    });
                    continue;
                }
            }

            // Sort weeks and days
            weeks.sort((a, b) => a.weekNumber - b.weekNumber);
            weeks.forEach(week => {
                week.days.sort((a, b) => a.dayNumber - b.dayNumber);
            });

            return { weeks };
        }

        function parseAndDisplayCalendar() {
            const content = document.getElementById('calendarInput').value.trim();
            
            if (!content) {
                alert('Please paste your calendar content first.');
                return;
            }

            try {
                calendarData = parseCalendarContent(content);
                
                if (!calendarData.weeks || calendarData.weeks.length === 0) {
                    throw new Error('No weeks found in calendar content');
                }

                // Save calendar data
                localStorage.setItem('smartMomCalendar', JSON.stringify(calendarData));
                if (currentUser) {
                    saveCalendarToAirtable(calendarData);
                }

                // Display the calendar
                displayInteractiveCalendar();
                
                // Hide parse section, show calendar
                document.getElementById('parseCalendarSection').style.display = 'none';
                document.getElementById('calendarNavigation').style.display = 'flex';
                document.getElementById('calendarActions').style.display = 'flex';
                document.getElementById('calendarEmpty').style.display = 'none';
                
                // Show calendar access button now that calendar exists
                showCalendarAccessButton();
                
                alert(`✅ Calendar created successfully!\n\n${calendarData.weeks.length} weeks with ${getTotalTasks()} total tasks loaded.`);
                
            } catch (error) {
                console.error('Calendar parsing error:', error);
                alert(`❌ Error parsing calendar: ${error.message}\n\nPlease check the format and try again.`);
            }
        }

        function displayInteractiveCalendar() {
            if (!calendarData) return;

            generateWeekSelector();
            generateCalendarContent();
            updateCalendarStats();
            loadCalendarProgress();
            showWeek(1);
        }

        function generateWeekSelector() {
            const weekSelector = document.getElementById('weekSelector');
            weekSelector.innerHTML = '';

            calendarData.weeks.forEach(week => {
                const btn = document.createElement('button');
                btn.className = 'week-btn';
                btn.textContent = `Week ${week.weekNumber}`;
                btn.onclick = () => showWeek(week.weekNumber);
                weekSelector.appendChild(btn);
            });
        }

        function generateCalendarContent() {
            const container = document.getElementById('calendarContent');
            container.innerHTML = '';

            calendarData.weeks.forEach(week => {
                const weekDiv = document.createElement('div');
                weekDiv.className = 'week-content';
                weekDiv.id = `week-${week.weekNumber}`;

                week.days.forEach(day => {
                    const dayCard = document.createElement('div');
                    dayCard.className = 'day-card';
                    
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'day-header';
                    
                    const dayTitle = document.createElement('h3');
                    dayTitle.className = 'day-title';
                    dayTitle.textContent = `Day ${day.dayNumber}`;
                    
                    const dayProgress = document.createElement('div');
                    dayProgress.className = 'day-progress';
                    dayProgress.id = `day-${week.weekNumber}-${day.dayNumber}-progress`;
                    
                    dayHeader.appendChild(dayTitle);
                    dayHeader.appendChild(dayProgress);
                    dayCard.appendChild(dayHeader);
                    
                    const taskList = document.createElement('div');
                    taskList.className = 'task-list';
                    
                    day.tasks.forEach(task => {
                        const taskCard = createTaskCard(week.weekNumber, day.dayNumber, task);
                        taskList.appendChild(taskCard);
                    });
                    
                    dayCard.appendChild(taskList);
                    weekDiv.appendChild(dayCard);
                });

                container.appendChild(weekDiv);
            });
        }

        function createTaskCard(weekNum, dayNum, task) {
            const taskCard = document.createElement('div');
            taskCard.className = 'task-card';
            taskCard.id = `task-${weekNum}-${dayNum}-${task.taskNumber}`;
            
            const taskHeader = document.createElement('div');
            taskHeader.className = 'task-header';
            
            const titleSection = document.createElement('div');
            titleSection.className = 'task-title-section';
            
            const title = document.createElement('div');
            title.className = 'task-title';
            title.textContent = task.title;
            
            const meta = document.createElement('div');
            meta.className = 'task-meta';
            
            const cost = document.createElement('span');
            cost.className = `task-cost ${task.cost.toLowerCase().includes('free') ? 'cost-free' : 'cost-paid'}`;
            cost.textContent = task.cost;
            
            const time = document.createElement('span');
            time.className = 'task-time';
            time.textContent = task.time;
            
            meta.appendChild(cost);
            meta.appendChild(time);
            titleSection.appendChild(title);
            titleSection.appendChild(meta);
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'task-checkbox';
            checkbox.checked = task.completed;
            checkbox.onchange = () => toggleTaskCompletion(weekNum, dayNum, task.taskNumber);
            
            taskHeader.appendChild(titleSection);
            taskHeader.appendChild(checkbox);
            taskCard.appendChild(taskHeader);
            
            if (task.steps && task.steps.length > 0) {
                const stepList = document.createElement('div');
                stepList.className = 'step-list';
                
                task.steps.forEach(step => {
                    const stepItem = document.createElement('div');
                    stepItem.className = 'step-item';
                    stepItem.id = `step-${weekNum}-${dayNum}-${task.taskNumber}-${step.stepNumber}`;
                    
                    const stepCheckbox = document.createElement('input');
                    stepCheckbox.type = 'checkbox';
                    stepCheckbox.className = 'step-checkbox';
                    stepCheckbox.checked = step.completed;
                    stepCheckbox.onchange = () => toggleStepCompletion(weekNum, dayNum, task.taskNumber, step.stepNumber);
                    
                    const stepNumber = document.createElement('div');
                    stepNumber.className = 'step-number';
                    stepNumber.textContent = step.stepNumber;
                    
                    const stepText = document.createElement('div');
                    stepText.className = 'step-text';
                    stepText.textContent = step.instruction;
                    
                    stepItem.appendChild(stepCheckbox);
                    stepItem.appendChild(stepNumber);
                    stepItem.appendChild(stepText);
                    stepList.appendChild(stepItem);
                });
                
                taskCard.appendChild(stepList);
            }
            
            return taskCard;
        }

        function showWeek(weekNumber) {
            currentWeek = weekNumber;
            
            // Update week buttons
            document.querySelectorAll('.week-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === `Week ${weekNumber}`) {
                    btn.classList.add('active');
                }
            });
            
            // Show/hide week content
            document.querySelectorAll('.week-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const currentWeekContent = document.getElementById(`week-${weekNumber}`);
            if (currentWeekContent) {
                currentWeekContent.classList.add('active');
                updateWeekProgress(weekNumber);
            }
        }

        function toggleTaskCompletion(weekNum, dayNum, taskNum) {
            if (!calendarData) return;
            
            const week = calendarData.weeks.find(w => w.weekNumber === weekNum);
            const day = week?.days.find(d => d.dayNumber === dayNum);
            const task = day?.tasks.find(t => t.taskNumber === taskNum);
            
            if (task) {
                task.completed = !task.completed;
                
                // If task is completed, mark all steps as completed
                if (task.completed && task.steps) {
                    task.steps.forEach(step => {
                        step.completed = true;
                        const stepElement = document.getElementById(`step-${weekNum}-${dayNum}-${taskNum}-${step.stepNumber}`);
                        if (stepElement) {
                            stepElement.classList.add('completed');
                            stepElement.querySelector('.step-checkbox').checked = true;
                        }
                    });
                }
                
                // Update UI
                const taskCard = document.getElementById(`task-${weekNum}-${dayNum}-${taskNum}`);
                if (taskCard) {
                    taskCard.classList.toggle('completed', task.completed);
                }
                
                updateProgressDisplays();
                saveCalendarProgress();
            }
        }

        function toggleStepCompletion(weekNum, dayNum, taskNum, stepNum) {
            if (!calendarData) return;
            
            const week = calendarData.weeks.find(w => w.weekNumber === weekNum);
            const day = week?.days.find(d => d.dayNumber === dayNum);
            const task = day?.tasks.find(t => t.taskNumber === taskNum);
            const step = task?.steps.find(s => s.stepNumber === stepNum);
            
            if (step) {
                step.completed = !step.completed;
                
                // Update step UI
                const stepElement = document.getElementById(`step-${weekNum}-${dayNum}-${taskNum}-${stepNum}`);
                if (stepElement) {
                    stepElement.classList.toggle('completed', step.completed);
                }
                
                // Check if all steps are completed to auto-complete task
                if (task.steps.every(s => s.completed)) {
                    task.completed = true;
                    const taskCard = document.getElementById(`task-${weekNum}-${dayNum}-${taskNum}`);
                    const taskCheckbox = taskCard?.querySelector('.task-checkbox');
                    if (taskCard && taskCheckbox) {
                        taskCard.classList.add('completed');
                        taskCheckbox.checked = true;
                    }
                } else if (task.completed && !step.completed) {
                    // If unchecking a step, uncheck the task
                    task.completed = false;
                    const taskCard = document.getElementById(`task-${weekNum}-${dayNum}-${taskNum}`);
                    const taskCheckbox = taskCard?.querySelector('.task-checkbox');
                    if (taskCard && taskCheckbox) {
                        taskCard.classList.remove('completed');
                        taskCheckbox.checked = false;
                    }
                }
                
                updateProgressDisplays();
                saveCalendarProgress();
            }
        }

        function updateProgressDisplays() {
            updateCalendarStats();
            updateWeekProgress(currentWeek);
            
            // Update day progress for all days
            calendarData.weeks.forEach(week => {
                week.days.forEach(day => {
                    updateDayProgress(week.weekNumber, day.dayNumber);
                });
            });
        }

        function updateCalendarStats() {
            if (!calendarData) return;
            
            const totalTasks = getTotalTasks();
            const completedTasks = getCompletedTasks();
            const overallProgress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            const currentWeekProgress = getCurrentWeekProgress();
            
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('overallProgress').textContent = `${overallProgress}%`;
            document.getElementById('currentWeekProgress').textContent = `${currentWeekProgress}%`;
        }

        function updateWeekProgress(weekNum) {
            if (!calendarData) return;
            
            const week = calendarData.weeks.find(w => w.weekNumber === weekNum);
            if (!week) return;
            
            const weekTasks = week.days.flatMap(day => day.tasks);
            const completedWeekTasks = weekTasks.filter(task => task.completed);
            const weekProgress = weekTasks.length > 0 ? Math.round((completedWeekTasks.length / weekTasks.length) * 100) : 0;
            
            document.getElementById('progressPercent').textContent = `${weekProgress}%`;
            document.getElementById('weekProgressText').textContent = `${completedWeekTasks.length} of ${weekTasks.length} tasks completed`;
            
            // Update progress circle
            const progressCircle = document.getElementById('progressCircle');
            if (progressCircle) {
                progressCircle.style.background = `conic-gradient(var(--sage-green) ${weekProgress * 3.6}deg, var(--light-sage) 0deg)`;
            }
        }

        function updateDayProgress(weekNum, dayNum) {
            if (!calendarData) return;
            
            const week = calendarData.weeks.find(w => w.weekNumber === weekNum);
            const day = week?.days.find(d => d.dayNumber === dayNum);
            if (!day) return;
            
            const dayTasks = day.tasks;
            const completedDayTasks = dayTasks.filter(task => task.completed);
            const dayProgress = dayTasks.length > 0 ? Math.round((completedDayTasks.length / dayTasks.length) * 100) : 0;
            
            const progressElement = document.getElementById(`day-${weekNum}-${dayNum}-progress`);
            if (progressElement) {
                progressElement.textContent = `${completedDayTasks.length}/${dayTasks.length} tasks (${dayProgress}%)`;
                progressElement.style.background = dayProgress === 100 ? 'var(--success-green)' : 'var(--light-sage)';
                progressElement.style.color = dayProgress === 100 ? 'white' : 'var(--sage-green)';
            }
        }

        function getTotalTasks() {
            if (!calendarData) return 0;
            return calendarData.weeks.reduce((total, week) => {
                return total + week.days.reduce((dayTotal, day) => dayTotal + day.tasks.length, 0);
            }, 0);
        }

        function getCompletedTasks() {
            if (!calendarData) return 0;
            return calendarData.weeks.reduce((total, week) => {
                return total + week.days.reduce((dayTotal, day) => {
                    return dayTotal + day.tasks.filter(task => task.completed).length;
                }, 0);
            }, 0);
        }

        function getCurrentWeekProgress() {
            if (!calendarData) return 0;
            
            const week = calendarData.weeks.find(w => w.weekNumber === currentWeek);
            if (!week) return 0;
            
            const weekTasks = week.days.flatMap(day => day.tasks);
            const completedWeekTasks = weekTasks.filter(task => task.completed);
            return weekTasks.length > 0 ? Math.round((completedWeekTasks.length / weekTasks.length) * 100) : 0;
        }

        function saveCalendarProgress() {
            if (!calendarData) return;
            
            const progressData = {
                calendarData: calendarData,
                currentWeek: currentWeek,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('smartMomCalendarProgress', JSON.stringify(progressData));
            
            // Also save to Airtable if user is signed in
            if (currentUser) {
                saveCalendarToAirtable(progressData);
            }
        }

        function loadCalendarProgress() {
            const savedProgress = localStorage.getItem('smartMomCalendarProgress');
            if (savedProgress) {
                try {
                    const progressData = JSON.parse(savedProgress);
                    if (progressData.calendarData) {
                        calendarData = progressData.calendarData;
                        currentWeek = progressData.currentWeek || 1;
                        
                        // Update UI with loaded progress
                        updateProgressDisplays();
                        console.log('Calendar progress loaded from localStorage');
                    }
                } catch (error) {
                    console.error('Error loading calendar progress:', error);
                }
            }
        }

        async function saveCalendarToAirtable(data) {
            if (!currentUser) return;
            
            try {
                const calendarData = {
                    UserEmail: currentUser.email,
                    CalendarData: JSON.stringify(data),
                    LastUpdated: new Date().toISOString()
                };
                
                // Check if calendar record exists
                const existingResponse = await fetch(
                    `${airtableConfig.apiUrl}/Calendars?filterByFormula={UserEmail}='${currentUser.email}'`,
                    {
                        headers: {
                            'Authorization': `Bearer ${airtableConfig.apiKey}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );
                
                const existingData = await existingResponse.json();
                
                if (existingData.records && existingData.records.length > 0) {
                    // Update existing
                    const recordId = existingData.records[0].id;
                    await updateRecord('Calendars', recordId, calendarData);
                } else {
                    // Create new
                    await createRecord('Calendars', calendarData);
                }
                
                console.log('Calendar data saved to Airtable');
            } catch (error) {
                console.error('Error saving calendar to Airtable:', error);
            }
        }

        function downloadCalendarProgress() {
            if (!calendarData) {
                alert('No calendar data to download.');
                return;
            }
            
            const stats = {
                totalTasks: getTotalTasks(),
                completedTasks: getCompletedTasks(),
                overallProgress: Math.round((getCompletedTasks() / getTotalTasks()) * 100),
                lastUpdated: new Date().toLocaleDateString()
            };
            
            let content = `SMART MOM METHOD - CALENDAR PROGRESS REPORT
Generated: ${new Date().toLocaleDateString()}

=== PROGRESS SUMMARY ===
Total Tasks: ${stats.totalTasks}
Completed Tasks: ${stats.completedTasks}
Overall Progress: ${stats.overallProgress}%
Last Updated: ${stats.lastUpdated}

=== WEEKLY BREAKDOWN ===
`;

            calendarData.weeks.forEach(week => {
                const weekTasks = week.days.flatMap(day => day.tasks);
                const completedWeekTasks = weekTasks.filter(task => task.completed);
                const weekProgress = weekTasks.length > 0 ? Math.round((completedWeekTasks.length / weekTasks.length) * 100) : 0;
                
                content += `\nWEEK ${week.weekNumber}: ${completedWeekTasks.length}/${weekTasks.length} tasks (${weekProgress}%)\n`;
                
                week.days.forEach(day => {
                    const dayCompletedTasks = day.tasks.filter(task => task.completed);
                    content += `  Day ${day.dayNumber}: ${dayCompletedTasks.length}/${day.tasks.length} tasks\n`;
                    
                    day.tasks.forEach(task => {
                        const status = task.completed ? '✅' : '⏳';
                        content += `    ${status} ${task.title}\n`;
                        
                        if (task.steps) {
                            task.steps.forEach(step => {
                                const stepStatus = step.completed ? '✅' : '⏳';
                                content += `      ${stepStatus} Step ${step.stepNumber}: ${step.instruction}\n`;
                            });
                        }
                    });
                });
            });
            
            content += `\n=== NEXT STEPS ===
1. Continue working through your calendar tasks
2. Check off completed items regularly
3. Book a consultation if you need support
4. Update your progress weekly

Need help? Book a free call: https://calendly.com/momsurvivaltoolkit/free-smart-mom-call-30-min
`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `smart-mom-calendar-progress-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            
            URL.revokeObjectURL(url);
        }

        function printCalendar() {
            if (!calendarData) {
                alert('No calendar data to print.');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            const printContent = generatePrintableCalendar();
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Smart Mom Method Calendar</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .week { page-break-before: always; margin-bottom: 30px; }
                        .week:first-child { page-break-before: auto; }
                        .day { margin-bottom: 20px; border: 1px solid #ddd; padding: 15px; }
                        .task { margin-bottom: 15px; padding: 10px; background: #f9f9f9; }
                        .step { margin-left: 20px; margin-bottom: 5px; }
                        .checkbox { width: 15px; height: 15px; margin-right: 10px; }
                        h1, h2, h3 { color: #6B8E6B; }
                        .completed { text-decoration: line-through; opacity: 0.7; }
                    </style>
                </head>
                <body>
                    ${printContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        function generatePrintableCalendar() {
            let content = '<h1>Smart Mom Method - Interactive Calendar</h1>';
            content += `<p>Generated: ${new Date().toLocaleDateString()}</p>`;
            content += `<p>Progress: ${getCompletedTasks()}/${getTotalTasks()} tasks completed</p>`;
            
            calendarData.weeks.forEach(week => {
                content += `<div class="week">`;
                content += `<h2>Week ${week.weekNumber}</h2>`;
                
                week.days.forEach(day => {
                    content += `<div class="day">`;
                    content += `<h3>Day ${day.dayNumber}</h3>`;
                    
                    day.tasks.forEach(task => {
                        const taskClass = task.completed ? 'task completed' : 'task';
                        content += `<div class="${taskClass}">`;
                        content += `<input type="checkbox" class="checkbox" ${task.completed ? 'checked' : ''}> `;
                        content += `<strong>${task.title}</strong> (${task.cost} - ${task.time})`;
                        
                        if (task.steps) {
                            task.steps.forEach(step => {
                                const stepClass = step.completed ? 'step completed' : 'step';
                                content += `<div class="${stepClass}">`;
                                content += `<input type="checkbox" class="checkbox" ${step.completed ? 'checked' : ''}> `;
                                content += `Step ${step.stepNumber}: ${step.instruction}`;
                                content += `</div>`;
                            });
                        }
                        
                        content += `</div>`;
                    });
                    
                    content += `</div>`;
                });
                
                content += `</div>`;
            });
            
            return content;
        }

        function resetCalendarProgress() {
            if (!calendarData) return;
            
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                calendarData.weeks.forEach(week => {
                    week.days.forEach(day => {
                        day.tasks.forEach(task => {
                            task.completed = false;
                            if (task.steps) {
                                task.steps.forEach(step => {
                                    step.completed = false;
                                });
                            }
                        });
                    });
                });
                
                // Update UI
                document.querySelectorAll('.task-card').forEach(card => {
                    card.classList.remove('completed');
                    card.querySelector('.task-checkbox').checked = false;
                });
                
                document.querySelectorAll('.step-item').forEach(step => {
                    step.classList.remove('completed');
                    step.querySelector('.step-checkbox').checked = false;
                });
                
                updateProgressDisplays();
                saveCalendarProgress();
                
                alert('Calendar progress has been reset.');
            }
        }

        function showInteractiveCalendar() {
            // Hide other sections and show calendar
            document.querySelectorAll('.form-section, .step-description, .empowerment-message, .path-selection, #businessQuestionnaire, #successMessage, #interactiveAIWorkflow, #finalDashboard, #paymentOptions').forEach(el => {
                el.classList.add('hidden');
            });
            
            document.getElementById('interactiveCalendarDisplay').classList.remove('hidden');
            document.getElementById('interactiveCalendarDisplay').scrollIntoView({ behavior: 'smooth' });
            
            // Load existing calendar data if available
            const savedCalendar = localStorage.getItem('smartMomCalendar');
            if (savedCalendar) {
                try {
                    calendarData = JSON.parse(savedCalendar);
                    displayInteractiveCalendar();
                    document.getElementById('parseCalendarSection').style.display = 'none';
                    document.getElementById('calendarNavigation').style.display = 'flex';
                    document.getElementById('calendarActions').style.display = 'flex';
                    document.getElementById('calendarEmpty').style.display = 'none';
                } catch (error) {
                    console.error('Error loading saved calendar:', error);
                }
            }
        }

        // ===== AIRTABLE API FUNCTIONS =====
        
        // Password hashing function
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        // Find user by email
        async function findUserByEmail(email) {
            try {
                const response = await fetch(
                    `${airtableConfig.apiUrl}/Users?filterByFormula={Email}='${email}'`,
                    {
                        headers: {
                            'Authorization': `Bearer ${airtableConfig.apiKey}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return data.records[0] || null;
            } catch (error) {
                console.error('Error finding user:', error);
                return null;
            }
        }

        // Create new record
       // CORS proxy wrapper function
async function corsProxyFetch(url, options = {}) {
    const proxyUrl = 'https://api.allorigins.win/raw?url=';
    const proxiedUrl = proxyUrl + encodeURIComponent(url);
    
    try {
        return await fetch(proxiedUrl, {
            ...options,
            headers: {
                ...options.headers,
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
    } catch (error) {
        console.log('Primary proxy failed, trying fallback...');
        try {
            return await fetch('https://cors-anywhere.herokuapp.com/' + url, options);
        } catch (fallbackError) {
            console.error('Both proxies failed:', fallbackError);
            throw error;
        }
    }
}

// Create new record (CORS proxy version)
async function createRecord(table, fields) {
    try {
        const response = await corsProxyFetch(`https://api.airtable.com/v0/appQUF3zVLlHbB4fP/${table}`, {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer patjes1GsajwyYTSN.39633c18c6dc227b6e290d5da8lda3bde2f4d089d6bd4ae049787fecdb676f65',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ fields })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        return await response.json();
    } catch (error) {
        console.error('Error creating record:', error);
        throw error;
    }
}

// Update existing record (CORS proxy version)
async function updateRecord(table, recordId, fields) {
    try {
        const response = await corsProxyFetch(`https://api.airtable.com/v0/appQUF3zVLlHbB4fP/${table}/${recordId}`, {
            method: 'PATCH',
            headers: {
                'Authorization': 'Bearer patjes1GsajwyYTSN.39633c18c6dc227b6e290d5da8lda3bde2f4d089d6bd4ae049787fecdb676f65',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ fields })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        return await response.json();
    } catch (error) {
        console.error('Error updating record:', error);
        throw error;
    }
}
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('Error creating record:', error);
                throw error;
            }
        }

        // Update existing record
        async function updateRecord(table, recordId, fields) {
            try {
                const response = await fetch(
                    `${airtableConfig.apiUrl}/${table}/${recordId}`,
                    {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${airtableConfig.apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ fields })
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('Error updating record:', error);
                throw error;
            }
        }

        // Create user account
        async function createUser(email, password, name) {
            try {
                const hashedPassword = await hashPassword(password);
                
                const userData = {
                    Name: name,
                    Email: email,
                    Password: hashedPassword,
                    CreatedAt: new Date().toISOString(),
                    Language: currentLanguage,
                    Provider: 'email'
                };

                const result = await createRecord('Users', userData);
                console.log('User created successfully:', result);
                
                // Set current user
                currentUser = {
                    id: result.id,
                    email: email,
                    name: name,
                    displayName: name
                };
                
                // Update session
                updateUserSession(currentUser);
                
                return result;
            } catch (error) {
                console.error('Error creating user:', error);
                throw error;
            }
        }

        // Sign in user
        async function signIn(email, password) {
            try {
                const user = await findUserByEmail(email);
                if (!user) {
                    throw new Error('User not found');
                }

                const hashedPassword = await hashPassword(password);
                if (user.fields.Password !== hashedPassword) {
                    throw new Error('Invalid password');
                }

                // Set current user
                currentUser = {
                    id: user.id,
                    email: email,
                    name: user.fields.Name,
                    displayName: user.fields.Name
                };

                // Update session
                updateUserSession(currentUser);
                
                // Load user progress
                await loadUserProgress(email);
                
                return user;
            } catch (error) {
                console.error('Error signing in:', error);
                throw error;
            }
        }

        // Save user progress
        async function saveProgress(userEmail, data) {
            try {
                const progressData = {
                    UserEmail: userEmail,
                    FormData: JSON.stringify(data),
                    CurrentStep: currentStep,
                    SelectedPath: selectedPath,
                    LastSaved: new Date().toISOString(),
                    Language: currentLanguage
                };

                // Check if progress already exists for this user
                const existingResponse = await fetch(
                    `${airtableConfig.apiUrl}/Progress?filterByFormula={UserEmail}='${userEmail}'`,
                    {
                        headers: {
                            'Authorization': `Bearer ${airtableConfig.apiKey}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );

                const existingData = await existingResponse.json();
                
                if (existingData.records && existingData.records.length > 0) {
                    // Update existing record
                    const recordId = existingData.records[0].id;
                    return await updateRecord('Progress', recordId, progressData);
                } else {
                    // Create new record
                    return await createRecord('Progress', progressData);
                }
            } catch (error) {
                console.error('Error saving progress:', error);
                // Still save to localStorage as backup
                localStorage.setItem('smartMomProgress', JSON.stringify({
                    userEmail,
                    data,
                    currentStep,
                    selectedPath,
                    lastSaved: new Date().toISOString()
                }));
            }
        }

        // Load user progress
        async function loadUserProgress(userEmail) {
            try {
              const response = await corsProxyFetch(
    `${airtableConfig.apiUrl}/Progress?filterByFormula={userEmail}='${userEmail}'`,
                    {
                        headers: {
                            'Authorization': `Bearer ${airtableConfig.apiKey}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );

                const data = await response.json();
                
                if (data.records && data.records.length > 0) {
                    const progressRecord = data.records[0].fields;
                    
                    // Restore form data
                    if (progressRecord.FormData) {
                        formData = JSON.parse(progressRecord.FormData);
                        restoreFormData(formData);
                    }
                    
                    // Restore current step and path
                    currentStep = progressRecord.CurrentStep || 1;
                    selectedPath = progressRecord.SelectedPath || '';
                    
                    // Update UI
                    updateProgressDisplay();
                    showReturningUserStatus(progressRecord.LastSaved);
                    
                    console.log('Progress loaded successfully');
                    return progressRecord;
                }
            } catch (error) {
                console.error('Error loading progress:', error);
                // Try to load from localStorage as backup
                const localProgress = localStorage.getItem('smartMomProgress');
                if (localProgress) {
                    const parsed = JSON.parse(localProgress);
                    if (parsed.userEmail === userEmail) {
                        formData = parsed.data || {};
                        currentStep = parsed.currentStep || 1;
                        selectedPath = parsed.selectedPath || '';
                        restoreFormData(formData);
                        updateProgressDisplay();
                    }
                }
            }
        }

        // Submit testimonial
        async function submitTestimonial(testimonial, userName, selectedPath) {
            try {
                const testimonialData = {
                    UserEmail: currentUser ? currentUser.email : 'anonymous',
                    UserName: userName || 'Anonymous',
                    Testimonial: testimonial,
                    SelectedPath: selectedPath,
                    SubmittedAt: new Date().toISOString()
                };

                const result = await createRecord('Testimonials', testimonialData);
                
             await sendToWebhook({
                    trigger: 'testimonial',
                    testimonial: testimonial,
                    user_name: userName,
                    selected_path: selectedPath,
                    timestamp: new Date().toISOString()
                });
                
                return result;
            } catch (error) {
                console.error('Error submitting testimonial:', error);
                throw error;
            }
        }

        // ===== USER SESSION MANAGEMENT =====
        
        function updateUserSession(user) {
            currentUser = user;
            
            // Update localStorage for session persistence
            localStorage.setItem('smartMomUser', JSON.stringify(user));
            
            // Update UI
            document.getElementById('userStatusBar').classList.remove('hidden');
            document.getElementById('userAvatar').textContent = user.name.charAt(0).toUpperCase();
            document.getElementById('userDisplayName').textContent = user.name;
            document.getElementById('userStatusText').textContent = `Signed in as ${user.email}`;
            document.getElementById('statusBadge').textContent = 'Signed In';
            document.getElementById('statusBadge').className = 'status-badge signed-in';
            document.getElementById('signOutBtn').style.display = 'block';
            
            // Hide save progress button
            const saveBtn = document.querySelector('[onclick="showAuthModal(\'signup\')"]');
            if (saveBtn) saveBtn.style.display = 'none';
        }

        function checkExistingSession() {
            const savedUser = localStorage.getItem('smartMomUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    updateUserSession(currentUser);
                    loadUserProgress(currentUser.email);
                } catch (error) {
                    console.error('Error restoring session:', error);
                    localStorage.removeItem('smartMomUser');
                }
            } else {
                // Show user status bar in guest mode
                document.getElementById('userStatusBar').classList.remove('hidden');
            }
        }

        function signOut() {
            currentUser = null;
            localStorage.removeItem('smartMomUser');
            localStorage.removeItem('smartMomProgress');
            
            // Reset UI to guest mode
            document.getElementById('userAvatar').textContent = '?';
            document.getElementById('userDisplayName').textContent = 'Guest User';
            document.getElementById('userStatusText').textContent = 'Progress will not be saved';
            document.getElementById('statusBadge').textContent = 'Guest Mode';
            document.getElementById('statusBadge').className = 'status-badge guest';
            document.getElementById('signOutBtn').style.display = 'none';
            
            // Show save progress button
            const saveBtn = document.querySelector('[onclick="showAuthModal(\'signup\')"]');
            if (saveBtn) saveBtn.style.display = 'block';
            
            // Reset form
            document.querySelectorAll('.form-control').forEach(field => {
                field.value = '';
            });
            
            // Reset progress
            currentStep = 1;
            selectedPath = '';
            formData = {};
            updateProgressDisplay();
        }

        // ===== AUTHENTICATION MODAL FUNCTIONS =====
        
        function showAuthModal(mode) {
            authMode = mode || 'signup';
            
            const modal = document.getElementById('authModal');
            const title = document.getElementById('authTitle');
            const submitBtn = document.getElementById('authSubmitText');
            const switchText = document.getElementById('authSwitchText');
            const switchLink = document.getElementById('authSwitchLink');
            const nameField = document.getElementById('authName');
            const confirmField = document.getElementById('authConfirmPassword');

            clearAuthMessages();

            if (authMode === 'signup') {
                title.textContent = 'Create Your Account';
                submitBtn.textContent = 'Create Account';
                switchText.textContent = 'Already have an account?';
                switchLink.textContent = 'Sign In';
                nameField.style.display = 'block';
                confirmField.style.display = 'block';
                nameField.required = true;
                confirmField.required = true;
            } else {
                title.textContent = 'Sign In';
                submitBtn.textContent = 'Sign In';
                switchText.textContent = "Don't have an account?";
                switchLink.textContent = 'Create Account';
                nameField.style.display = 'none';
                confirmField.style.display = 'none';
                nameField.required = false;
                confirmField.required = false;
            }

            modal.classList.add('active');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            clearAuthMessages();
            document.getElementById('authForm').reset();
        }

        function toggleAuthMode() {
            showAuthModal(authMode === 'signup' ? 'signin' : 'signup');
        }

        function clearAuthMessages() {
            document.getElementById('authError').classList.add('hidden');
            document.getElementById('authSuccess').classList.add('hidden');
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function showAuthSuccess(message) {
            const successDiv = document.getElementById('authSuccess');
            successDiv.textContent = message;
            successDiv.classList.remove('hidden');
        }

        // ===== MODAL FUNCTIONS =====
        
        function startOnboarding() {
            document.getElementById('welcomeModal').classList.add('hidden');
        }

        function handleReturningUser() {
            document.getElementById('welcomeModal').classList.add('hidden');
            showAuthModal('signin');
        }

               
       // ===== WEBHOOK FUNCTIONS =====
async function corsProxyFetch(url, options = {}) {
    const proxyUrl = 'https://api.allorigins.win/raw?url=';
    const proxiedUrl = proxyUrl + encodeURIComponent(url);
    
    try {
        return await fetch(proxiedUrl, {
            ...options,
            headers: {
                ...options.headers,
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
    } catch (error) {
        console.log('Primary proxy failed, trying fallback...');
        try {
            return await fetch('https://cors-anywhere.herokuapp.com/' + url, options);
        } catch (fallbackError) {
            console.error('Both proxies failed:', fallbackError);
            throw error;
        }
    }
}

async function sendToWebhook(data) {
    try {
        const response = await corsProxyFetch(WEBHOOK_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                ...data,
                source: 'smart-mom-method-website',
                version: '2.0'
            })
        });

        if (response.ok) {
            console.log('📧 Webhook sent successfully!');
            return true;
        } else {
            console.warn('⚠️ Webhook failed:', response.status);
            return false;
        }
    } catch (error) {
        console.warn('⚠️ Webhook error (expected - webhook may be broken):', error.message);
        return false;
    }
}
        async function sendWelcomeEmail(name, email) {
            const welcomeData = {
                trigger: 'welcome_email',
                name: name,
                email: email,
                timestamp: new Date().toISOString(),
                language: currentLanguage,
                source: 'smart-mom-method-website'
            };
            
            return await sendToWebhook(welcomeData);
        }

        // ===== UTILITY FUNCTIONS =====
        
        function scrollToForm() {
            document.getElementById('basicInfoSection').scrollIntoView({ behavior: 'smooth' });
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${lang}`).classList.add('active');
            
            // Save language preference
            localStorage.setItem('smartMomLanguage', lang);
            
            updateLanguageContent(lang);
        }

        function updateLanguageContent(lang) {
            const translations = {
                en: {
                    welcomeTitle: 'Welcome to Smart Mom Method!',
                    welcomeDescription: 'Create your personalized interactive calendar and business plan in 6 simple steps. This process will take approximately 25-30 minutes and will generate a comprehensive interactive calendar and plan tailored specifically for busy moms like you.',
                    welcomeStart: 'Get Started',
                    welcomeCreate: 'Create Account & Save Progress',
                    welcomeReturning: "I'm a returning user",
                    mainTitle: 'Smart Mom Method',
                    mainSubtitle: 'AI-Powered Interactive Calendar & Business Planning for Busy Moms',
                    freeBadge: '100% Free',
                    ctaButton: 'Start Your Free Interactive Calendar & Business Plan Now',
                    ctaSubtext: 'No email required to browse • Full process takes 25-30 minutes',
                    stepDescTitle: "Let's Get Started",
                    stepDescText: "First, let's get to know you better so we can create the perfect interactive calendar and business plan for your unique situation.",
                    empowermentTitle: "You're Already Successful!",
                    empowermentText: "Managing a family is running a complex organization. You have negotiation skills, time management expertise, and crisis resolution abilities that most CEOs would envy. Now let's channel that into YOUR organized life and successful business!",
                    basicInfoTitle: 'Basic Information',
                    nameLabel: 'Your Name:',
                    emailLabel: 'Your Email:',
                    pathSelectionTitle: 'What brings you here today? Choose your main focus:',
                    pathTitle1: 'Life Organization',
                    pathDesc1: 'I need help organizing my daily life, family schedules, and home systems',
                    pathTitle2: 'Business Launch',
                    pathDesc2: 'I want to start a business or create passive income streams',
                    pathTitle3: 'Both Life & Business',
                    pathDesc3: 'I need life organization AND want to start a business',
                    continueBtnText: 'Continue With Selected Path',
                    businessQuestionnaireTitle: 'Tell Us More About Your Situation',
                    familyStructureLabel: 'Family structure & ages:',
                    dailyScheduleLabel: 'Describe your typical daily schedule:',
                    investmentLabel: 'Investment level for business:',
                    incomeTimelineLabel: 'Timeline to first income:',
                    proceedBtnText: 'Start AI-Powered Analysis'
                },
                es: {
                    welcomeTitle: '¡Bienvenida al Método Smart Mom!',
                    welcomeDescription: 'Crea tu calendario interactivo personalizado y plan de negocio en 6 simples pasos. Este proceso tomará aproximadamente 25-30 minutos y generará un calendario interactivo completo y plan adaptado específicamente para madres ocupadas como tú.',
                    welcomeStart: 'Comenzar',
                    welcomeCreate: 'Crear Cuenta y Guardar Progreso',
                    welcomeReturning: 'Soy usuaria que regresa',
                    mainTitle: 'Método Smart Mom',
                    mainSubtitle: 'Calendario Interactivo y Planificación de Negocio con IA para Madres Ocupadas',
                    freeBadge: '100% Gratis',
                    ctaButton: 'Comienza Tu Calendario Interactivo y Plan de Negocio Gratis Ahora',
                    ctaSubtext: 'No se requiere correo para navegar • El proceso completo toma 25-30 minutos',
                    stepDescTitle: 'Comencemos',
                    stepDescText: 'Primero, vamos a conocerte mejor para crear el calendario interactivo perfecto y plan de negocio para tu situación única.',
                    empowermentTitle: '¡Ya Eres Exitosa!',
                    empowermentText: 'Manejar una familia es dirigir una organización compleja. Tienes habilidades de negociación, experiencia en gestión del tiempo y capacidades de resolución de crisis que la mayoría de los CEOs envidiarían. ¡Ahora vamos a canalizar eso hacia TU vida organizada y negocio exitoso!',
                    basicInfoTitle: 'Información Básica',
                    nameLabel: 'Tu Nombre:',
                    emailLabel: 'Tu Correo Electrónico:',
                    pathSelectionTitle: '¿Qué te trae aquí hoy? Elige tu enfoque principal:',
                    pathTitle1: 'Organización de Vida',
                    pathDesc1: 'Necesito ayuda organizando mi vida diaria, horarios familiares y sistemas del hogar',
                    pathTitle2: 'Lanzamiento de Negocio',
                    pathDesc2: 'Quiero iniciar un negocio o crear fuentes de ingresos pasivos',
                    pathTitle3: 'Vida y Negocio',
                    pathDesc3: 'Necesito organización de vida Y quiero iniciar un negocio',
                    continueBtnText: 'Continuar Con el Camino Seleccionado',
                    businessQuestionnaireTitle: 'Cuéntanos Más Sobre Tu Situación',
                    familyStructureLabel: 'Estructura familiar y edades:',
                    dailyScheduleLabel: 'Describe tu horario diario típico:',
                    investmentLabel: 'Nivel de inversión para negocio:',
                    incomeTimelineLabel: 'Cronograma para primeros ingresos:',
                    proceedBtnText: 'Comenzar Análisis con IA'
                }
            };

            const text = translations[lang];
            if (text) {
                // Update all translatable elements
                Object.keys(text).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.tagName === 'INPUT' && element.placeholder) {
                            // Don't change input text, just placeholder if needed
                        } else {
                            element.textContent = text[key];
                        }
                    }
                });
                
                console.log('Language content updated to:', lang);
            }
        }

        function validateField(field) {
            const value = field.value.trim();
            const validationDiv = document.getElementById(field.id + '-validation');
            
            if (field.required && value.length === 0) {
                if (validationDiv) {
                    validationDiv.textContent = 'This field is required';
                    validationDiv.className = 'validation-message';
                }
                return false;
            } else if (field.type === 'email' && value && !value.includes('@')) {
                if (validationDiv) {
                    validationDiv.textContent = 'Please enter a valid email address';
                    validationDiv.className = 'validation-message';
                }
                return false;
            } else {
                if (validationDiv) {
                    validationDiv.textContent = '✓ Looks good!';
                    validationDiv.className = 'validation-message success';
                }
                return true;
            }
        }

        function updateCharCount(textarea, maxLength) {
            const currentLength = textarea.value.length;
            const counter = document.getElementById(textarea.id + '-counter');
            if (counter) {
                counter.textContent = `${currentLength}/${maxLength}`;
                if (currentLength > maxLength * 0.8) {
                    counter.style.color = '#e57373';
                } else {
                    counter.style.color = 'var(--charcoal)';
                }
            }
        }

        function updateProgressDisplay() {
            // Update step counter
            document.getElementById('stepCounter').textContent = `Step ${currentStep} of 6`;
            
            // Update progress bar
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${(currentStep / 6) * 100}%`;
            
            // Update step indicators
            for (let i = 1; i <= 6; i++) {
                const stepElement = document.getElementById(`step-${i}`);
                if (stepElement) {
                    stepElement.className = i < currentStep ? 'progress-step completed' :
                                           i === currentStep ? 'progress-step active' :
                                           'progress-step pending';
                }
            }
        }

        function showReturningUserStatus(lastSaved) {
            const date = new Date(lastSaved).toLocaleDateString();
            const welcomeBack = document.createElement('div');
            welcomeBack.style.cssText = `
                background: var(--light-sage);
                padding: 20px;
                border-radius: 12px;
                margin: 20px 0;
                text-align: center;
                border: 2px solid var(--sage-green);
            `;
            welcomeBack.innerHTML = `
                <h3 style="color: var(--sage-green); margin-bottom: 10px;">Welcome Back!</h3>
                <p>Your progress from ${date} has been restored. You can continue where you left off.</p>
            `;
            
            document.querySelector('.content').insertBefore(welcomeBack, document.querySelector('.form-section'));
        }

        function restoreFormData(data) {
            Object.keys(data).forEach(key => {
                const field = document.getElementById(key);
                if (field) {
                    field.value = data[key];
                    validateField(field);
                }
            });
        }

        // ===== PATH SELECTION FUNCTIONS =====
        
        function selectPath(pathType) {
            selectedPath = pathType;
            
            // Clear previous selections
            document.querySelectorAll('.path-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Select current option
            const selectedOption = document.querySelector(`[data-path="${pathType}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
            
            // Show continue button
            const continueBtn = document.getElementById('continueBtn');
            if (continueBtn) {
                continueBtn.classList.add('visible');
            }
            
            console.log('Path selected:', pathType);
        }

        function showBusinessQuestionnaire() {
            if (!selectedPath) {
                alert('Please select a path first');
                return;
            }
            
            currentStep = 3;
            updateProgressDisplay();
            
            document.getElementById('pathSelection').classList.add('hidden');
            document.getElementById('businessQuestionnaire').classList.remove('hidden');
            document.getElementById('businessQuestionnaire').scrollIntoView({ behavior: 'smooth' });
        }

        // ===== FORM PROCESSING =====
        
        function collectFormData() {
            const name = document.getElementById('user-name').value.trim();
            const email = document.getElementById('user-email').value.trim();
            
            if (!name || !email) {
                alert('Please fill in your name and email');
                return null;
            }
            
            const userData = {
                name,
                email,
                selectedPath,
                familyStructure: document.getElementById('family-structure')?.value || '',
                dailySchedule: document.getElementById('daily-schedule')?.value || '',
                investmentLevel: document.getElementById('investment-level')?.value || '',
                incomeTimeline: document.getElementById('income-timeline')?.value || '',
                timestamp: new Date().toISOString()
            };
            
            return userData;
        }

        async function proceedWithQuestionnaire() {
            const userData = collectFormData();
            if (!userData) return;
            
            // Disable button and show loading
            const proceedBtn = document.getElementById('proceedBtn');
            const originalText = proceedBtn.innerHTML;
            proceedBtn.disabled = true;
            proceedBtn.innerHTML = '<div class="loading-spinner"></div>Saving your information...';
            
            try {
                // Send welcome email
                await sendWelcomeEmail(userData.name, userData.email);
                
                // Save to Airtable (if user is signed in)
                if (currentUser) {
                    await saveProgress(currentUser.email, userData);
                } else {
                    // Save to localStorage for guest users
                    localStorage.setItem('smartMomGuestData', JSON.stringify(userData));
                }
                
                // Send to webhook
                await sendToWebhook({
                    trigger: 'form_submission',
                    ...userData
                });
                
                // Update form data
                formData = userData;
                
                // Initialize interactive prompt generation system
                initializePromptGeneration();
                
                // Generate first AI prompt with enhanced system
                generateChatGPTPrompt(userData);
                
                // Show AI workflow instead of success message
                currentStep = 4;
                updateProgressDisplay();
                
                document.getElementById('businessQuestionnaire').classList.add('hidden');
                document.getElementById('interactiveAIWorkflow').classList.remove('hidden');
                document.getElementById('interactiveAIWorkflow').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Error processing form:', error);
                alert('There was an error saving your information. Please try again.');
            } finally {
                // Reset button
                proceedBtn.disabled = false;
                proceedBtn.innerHTML = originalText;
            }
        }

        function proceedToAIWorkflow() {
            currentStep = 5;
            updateProgressDisplay();
            
            document.getElementById('successMessage').classList.add('hidden');
            document.getElementById('interactiveAIWorkflow').classList.remove('hidden');
            document.getElementById('interactiveAIWorkflow').scrollIntoView({ behavior: 'smooth' });
        }

        // ===== AI WORKFLOW FUNCTIONS =====
        
        function generateChatGPTPrompt(userData) {
            const prompt = `${realismInstructions}

I'm a mom with these specific details:
- Name: ${userData.name}
- Path: ${userData.selectedPath}
- Investment Level: ${userData.investmentLevel}
- Timeline: ${userData.incomeTimeline}
- Family: ${userData.familyStructure}
- Daily Schedule: ${userData.dailySchedule}

Please suggest 3-5 REALISTIC business ideas that fit my situation. Be brutally honest about what's actually achievable with my constraints. Include specific first steps I can take this week.

Focus on businesses that:
- Work with my available time and family obligations
- Match my investment level and timeline
- Can realistically generate income
- Are appropriate for beginners

For each idea, include:
1. What the business actually involves day-to-day
2. Realistic timeline to first income
3. Startup costs and ongoing expenses
4. First 3 concrete steps to start
5. Potential challenges and how to overcome them`;

            document.getElementById('chatgpt-prompt').value = prompt;
            console.log('ChatGPT prompt generated');
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.select();
                document.execCommand('copy');
                
                // Visual feedback
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.style.background = '#27ae60';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            }
        }

        function openChatGPT() {
            window.open(AI_PLATFORMS.chatgpt, '_blank');
        }

        function openGemini() {
            window.open(AI_PLATFORMS.gemini, '_blank');
        }

        function openClaude() {
            window.open(AI_PLATFORMS.claude, '_blank');
        }

        function checkResponseAndEnableNext(stepNumber) {
            let responseField;
            if (stepNumber === 1) {
                responseField = document.getElementById('chatgpt-response');
            } else if (stepNumber === 2) {
                responseField = document.getElementById('gemini-market-response');
            } else if (stepNumber === 3) {
                responseField = document.getElementById('gemini-pricing-response');
            }
            
            const nextButton = document.getElementById(`next-btn-${stepNumber}`);
            
            if (responseField && nextButton) {
                const hasContent = responseField.value.trim().length > 100;
                nextButton.disabled = !hasContent;
                
                if (hasContent) {
                    nextButton.style.background = '#27ae60';
                    nextButton.style.opacity = '1';
                } else {
                    nextButton.style.background = '#95a5a6';
                    nextButton.style.opacity = '0.5';
                }
            }
        }

        function checkCalendarCodeAndEnableFinish() {
            const codeField = document.getElementById('claude-calendar-code');
            const finishButton = document.getElementById('finish-workflow-btn');
            
            if (codeField && finishButton) {
                const code = codeField.value.trim();
                const isValidCode = code.length > 200 && 
                                  (code.includes('<') || code.includes('calendar') || code.includes('schedule'));
                finishButton.disabled = !isValidCode;
                
                if (isValidCode) {
                    finishButton.style.background = '#27ae60';
                    finishButton.style.opacity = '1';
                } else {
                    finishButton.style.background = '#95a5a6';
                    finishButton.style.opacity = '0.5';
                }
            }
        }

        function generateNextPrompt(stepNumber) {
            // Save current response
            const currentResponse = getCurrentStepResponse(stepNumber - 1);
            if (currentResponse) {
                aiResponses[`step${stepNumber - 1}`] = currentResponse;
            }
            
            // Update step status
            updateAIStepStatus(stepNumber - 1, 'completed');
            updateAIStepStatus(stepNumber, 'current');
            
            // Generate next prompt
            switch(stepNumber) {
                case 2:
                    generateGeminiMarketPrompt();
                    break;
                case 3:
                    generateGeminiPricingPrompt();
                    break;
                case 4:
                    generateClaudeCalendarPrompt();
                    break;
            }
            
            // Enable copy and open buttons for next step
            enableStepButtons(stepNumber);
            
            // Scroll to next step
            document.getElementById(`ai-step-${stepNumber}-container`).scrollIntoView({ behavior: 'smooth' });
        }

        function getCurrentStepResponse(stepNumber) {
            switch(stepNumber) {
                case 1:
                    return document.getElementById('chatgpt-response').value;
                case 2:
                    return document.getElementById('gemini-market-response').value;
                case 3:
                    return document.getElementById('gemini-pricing-response').value;
                case 4:
                    return document.getElementById('claude-calendar-code').value;
                default:
                    return '';
            }
        }

        function updateAIStepStatus(stepNumber, status) {
            const container = document.getElementById(`ai-step-${stepNumber}-container`);
            if (container) {
                container.className = `ai-step-container ${status}`;
                
                const statusElement = container.querySelector('.ai-step-status');
                if (statusElement) {
                    statusElement.textContent = status === 'current' ? 'Current Step' : 
                                              status === 'completed' ? 'Completed' : 'Waiting';
                }
            }
        }

        function enableStepButtons(stepNumber) {
            const copyBtnId = stepNumber === 2 ? 'copy-market-btn' : 
                             stepNumber === 3 ? 'copy-pricing-btn' : 
                             stepNumber === 4 ? 'copy-claude-btn' : '';
            
            const openBtnId = stepNumber === 2 ? 'open-gemini-market-btn' : 
                             stepNumber === 3 ? 'open-gemini-pricing-btn' : 
                             stepNumber === 4 ? 'open-claude-btn' : '';
            
            const copyBtn = document.getElementById(copyBtnId);
            const openBtn = document.getElementById(openBtnId);
            
            if (copyBtn) copyBtn.disabled = false;
            if (openBtn) openBtn.disabled = false;
        }

        function generateGeminiMarketPrompt() {
            const chatgptResponse = aiResponses.step1;
            const prompt = `Based on this ChatGPT business analysis: "${chatgptResponse.substring(0, 500)}..."

Please do a DEEP SEARCH to research and validate these business ideas. Find:
1. Real market demand data for ${new Date().getFullYear()}
2. Competition analysis in Lincoln, Nebraska area
3. Actual success stories from similar moms
4. Required skills/resources breakdown
5. Realistic revenue potential with examples

Focus on what's actually working for mom entrepreneurs in 2024/2025. Use Deep Search to get current market data and validate these specific business ideas.

Pay special attention to:
- Local market conditions in Nebraska
- Current economic climate impact
- Real pricing that customers pay (not just what businesses charge)
- Seasonal considerations
- Time investment vs. income reality`;

            document.getElementById('gemini-market-prompt').value = prompt;
        }

        function generateGeminiPricingPrompt() {
            const marketResponse = aiResponses.step2;
            const prompt = `Based on this market research: "${marketResponse.substring(0, 500)}..."

Please do a DEEP SEARCH on pricing strategies for these specific business types. Research:
1. Current market rates in Nebraska/Midwest for similar services
2. Pricing strategies that actually work for mom entrepreneurs
3. How successful moms price their services (beginner → expert progression)
4. What clients actually pay vs. what they're quoted
5. Seasonal pricing variations and demand cycles

Use Deep Search to find real pricing data from 2024-2025. Include:
- Beginner pricing that gets clients (not scares them away)
- 6-month and 1-year pricing progression paths
- Package deals vs. hourly rates effectiveness
- Geographic pricing differences (Midwest vs. coastal)
- What pricing mistakes to avoid as a beginner

Focus on ACTIONABLE pricing advice for someone just starting out.`;

            document.getElementById('gemini-pricing-prompt').value = prompt;
        }

        function generateClaudeCalendarPrompt() {
            const userData = formData;
            const allResponses = Object.values(aiResponses).join('\n\n');
            
            const prompt = `Create an interactive 12-week calendar for a mom entrepreneur with these details:

USER PROFILE:
${JSON.stringify(userData, null, 2)}

AI RESEARCH RESULTS:
${allResponses}

Please create a comprehensive 12-week interactive calendar that includes:

**STRUCTURE:**
- Week-by-week breakdown (WEEK 1 through WEEK 12)
- Daily tasks (maximum 4 tasks per day)
- Each task should have 3-7 specific steps

**TASK FORMAT:**
Task 1: [Task Title] ([FREE/PAID $X] - [X minutes])
- Step 1: [Exact instruction]
- Step 2: [Exact instruction]
- Step 3: [Exact instruction]

**REQUIREMENTS:**
1. Make it realistic for her family situation and available time
2. Include both business development AND life organization tasks
3. Balance free activities with small investments as budget allows
4. Include accountability check-ins and progress celebrations
5. Add self-care and family time blocks
6. Make each step actionable and specific

**PROGRESSION:**
- Weeks 1-2: Foundation and setup
- Weeks 3-6: Building momentum and habits
- Weeks 7-10: Growth and optimization
- Weeks 11-12: Evaluation and next steps

Make it practical, achievable, and tailored to her specific constraints and goals.`;

            document.getElementById('claude-calendar-prompt').value = prompt;
        }

        function goBackToStep(stepNumber) {
            updateAIStepStatus(stepNumber + 1, 'pending');
            updateAIStepStatus(stepNumber, 'current');
            
            // Scroll to previous step
            document.getElementById(`ai-step-${stepNumber}-container`).scrollIntoView({ behavior: 'smooth' });
        }

        function finishAIWorkflow() {
            // Save final calendar response
            const calendarCode = document.getElementById('claude-calendar-code').value.trim();
            aiResponses.calendar = calendarCode;
            
            // Update final step
            updateAIStepStatus(4, 'completed');
            updateAIStepStatus(5, 'current');
            
            // Parse and set up calendar if code provided
            if (calendarCode && calendarCode.length > 200) {
                try {
                    calendarData = parseCalendarContent(calendarCode);
                    localStorage.setItem('smartMomCalendar', JSON.stringify(calendarData));
                    
                    if (currentUser) {
                        saveCalendarToAirtable({ calendarData, currentWeek: 1 });
                    }
                    
                    // Show calendar access button now that calendar exists
                    showCalendarAccessButton();
                } catch (error) {
                    console.error('Error parsing calendar in workflow:', error);
                }
            }
            
            // Show final dashboard
            currentStep = 5;
            updateProgressDisplay();
            
            populateFinalDashboard();
            
            document.getElementById('interactiveAIWorkflow').classList.add('hidden');
            document.getElementById('finalDashboard').classList.remove('hidden');
            document.getElementById('finalDashboard').scrollIntoView({ behavior: 'smooth' });
        }

        function showCalendarAccessButton() {
            const calendarBtn = document.getElementById('calendarAccessBtn');
            if (calendarBtn) {
                calendarBtn.style.display = 'inline-block';
            }
        }

        function hideCalendarAccessButton() {
            const calendarBtn = document.getElementById('calendarAccessBtn');
            if (calendarBtn) {
                calendarBtn.style.display = 'none';
            }
        }

        function checkForExistingCalendar() {
            // Check if user has existing calendar data
            const savedCalendar = localStorage.getItem('smartMomCalendar');
            if (savedCalendar) {
                try {
                    const parsedCalendar = JSON.parse(savedCalendar);
                    if (parsedCalendar && parsedCalendar.weeks && parsedCalendar.weeks.length > 0) {
                        calendarData = parsedCalendar;
                        showCalendarAccessButton();
                    }
                } catch (error) {
                    console.error('Error checking existing calendar:', error);
                }
            }
        }

        function populateFinalDashboard() {
            // Populate business summary
            const businessSummary = document.getElementById('business-summary-content');
            if (businessSummary && aiResponses.step1) {
                businessSummary.innerHTML = `
                    <h4>Selected Path: ${selectedPath}</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <strong>Business Ideas (ChatGPT Analysis):</strong>
                        <p>${aiResponses.step1.substring(0, 500)}...</p>
                    </div>
                `;
            }
            
            // Populate market research
            const marketSummary = document.getElementById('market-research-summary');
            if (marketSummary && aiResponses.step2) {
                marketSummary.innerHTML = `
                    <div style="max-height: 300px; overflow-y: auto;">
                        <strong>Market Validation Results:</strong>
                        <p>${aiResponses.step2.substring(0, 500)}...</p>
                    </div>
                `;
            }
            
            // Populate pricing strategy
            const pricingSummary = document.getElementById('pricing-strategy-summary');
            if (pricingSummary && aiResponses.step3) {
                pricingSummary.innerHTML = `
                    <div style="max-height: 300px; overflow-y: auto;">
                        <strong>Pricing Research Results:</strong>
                        <p>${aiResponses.step3.substring(0, 500)}...</p>
                    </div>
                `;
            }
        }

        function previewCalendar() {
            const calendarCode = aiResponses.calendar;
            if (calendarCode && calendarCode.trim()) {
                const previewWindow = window.open('', '_blank', 'width=800,height=600');
                previewWindow.document.write(calendarCode);
                previewWindow.document.close();
            } else {
                alert('Calendar code not available. Please complete the AI workflow first.');
            }
        }

        function downloadCompletePackage() {
            // Create a comprehensive package with all data
            const packageData = {
                userData: formData,
                selectedPath,
                aiResponses,
                timestamp: new Date().toISOString(),
                language: currentLanguage
            };
            
            const dataStr = `SMART MOM METHOD - COMPLETE PLAN
Generated: ${new Date().toLocaleDateString()}

=== USER PROFILE ===
Name: ${formData.name}
Email: ${formData.email}
Selected Path: ${selectedPath}
Family Structure: ${formData.familyStructure}
Daily Schedule: ${formData.dailySchedule}
Investment Level: ${formData.investmentLevel}
Income Timeline: ${formData.incomeTimeline}

=== AI ANALYSIS RESULTS ===

--- BUSINESS IDEAS (ChatGPT) ---
${aiResponses.step1 || 'Not completed'}

--- MARKET RESEARCH (Gemini) ---
${aiResponses.step2 || 'Not completed'}

--- PRICING STRATEGY (Gemini) ---
${aiResponses.step3 || 'Not completed'}

--- INTERACTIVE CALENDAR (Claude) ---
${aiResponses.calendar || 'Not completed'}

=== NEXT STEPS ===
1. Review your personalized business ideas
2. Validate market research findings
3. Implement pricing strategy
4. Use your interactive calendar to take action
5. Book a free consultation if needed

=== CONTACT ===
Need help? Book a free call: https://calendly.com/momsurvivaltoolkit/free-smart-mom-call-30-min

Generated by Smart Mom Method - https://smartmommethod.com
            `;
            
            const dataBlob = new Blob([dataStr], {type: 'text/plain'});
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `smart-mom-method-plan-${formData.name.replace(/\s+/g, '-').toLowerCase()}-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            
            URL.revokeObjectURL(url);
        }

        function showCompletion() {
            currentStep = 6;
            updateProgressDisplay();
            
            document.getElementById('successMessage').classList.add('hidden');
            
            const completionHtml = `
                <div style="background: linear-gradient(135deg, var(--sage-green), var(--deep-teal)); color: white; padding: 60px 40px; text-align: center; border-radius: 24px; margin: 40px 0;">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 2.5rem; margin-bottom: 20px;">🎉 Process Complete!</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 30px; opacity: 0.9;">Your Smart Mom Method profile has been created successfully!</p>
                    
                    <div style="background: rgba(255,255,255,0.15); padding: 30px; border-radius: 16px; margin: 30px 0;">
                        <h3 style="margin-bottom: 15px;">Your Information is Saved:</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin: 10px 0;">📊 Profile data stored in Airtable database</li>
                            <li style="margin: 10px 0;">📧 Welcome email sent to your inbox</li>
                            <li style="margin: 10px 0;">🔒 Data securely encrypted and backed up</li>
                            <li style="margin: 10px 0;">💾 Progress automatically saved for return visits</li>
                        </ul>
                    </div>

                    <button onclick="testAirtableConnection()" style="background: var(--soft-gold); color: white; padding: 20px 40px; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: 600; cursor: pointer; margin: 10px;">
                        Test Airtable Connection
                    </button>
                    
                    <button onclick="startOver()" style="background: white; color: var(--sage-green); padding: 20px 40px; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: 600; cursor: pointer; margin: 10px;">
                        Start New Session
                    </button>
                </div>
            `;
            
            document.querySelector('.content').innerHTML = completionHtml;
        }

        // ===== TESTING FUNCTIONS =====
        
        async function testAirtableConnection() {
            const testButton = event.target;
            const originalText = testButton.textContent;
            testButton.disabled = true;
            testButton.innerHTML = '<div class="loading-spinner"></div>Testing connection...';
            
            try {
                // Test basic API connection
                const response = await fetch(`${airtableConfig.apiUrl}/Users?maxRecords=1`, {
                    headers: {
                        'Authorization': `Bearer ${airtableConfig.apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    alert(`✅ Airtable connection successful!\n\nBase ID: ${airtableConfig.baseId}\nRecords found: ${data.records.length}\nAPI Status: Connected`);
                } else {
                    alert(`❌ Airtable connection failed!\n\nStatus: ${response.status}\nError: ${response.statusText}`);
                }
            } catch (error) {
                alert(`❌ Connection error!\n\nError: ${error.message}`);
            } finally {
                testButton.disabled = false;
                testButton.textContent = originalText;
            }
        }

        function startOver() {
            if (confirm('Are you sure you want to start over? This will clear all your data.')) {
                // Clear all data
                currentUser = null;
                formData = {};
                selectedPath = '';
                currentStep = 1;
                
                // Clear storage
                localStorage.removeItem('smartMomUser');
                localStorage.removeItem('smartMomProgress');
                localStorage.removeItem('smartMomGuestData');
                
                // Reload page
                location.reload();
            }
        }

        function skipToPaymentOptions() {
            // Hide all main sections
            document.querySelectorAll('.form-section, .step-description, .empowerment-message, .path-selection, #businessQuestionnaire, #successMessage').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show payment options
            document.getElementById('paymentOptions').classList.remove('hidden');
            document.getElementById('paymentOptions').scrollIntoView({ behavior: 'smooth' });
        }

        function returnToPlanningProcess() {
            // Hide payment sections
            document.getElementById('paymentOptions').classList.add('hidden');
            
            // Show the basic info section
            document.getElementById('basicInfoSection').classList.remove('hidden');
            document.getElementById('basicInfoSection').scrollIntoView({ behavior: 'smooth' });
        }

        // ===== EVENT HANDLERS =====
        
        function checkBasicInfoComplete() {
            const name = document.getElementById('user-name').value.trim();
            const email = document.getElementById('user-email').value.trim();
            
            if (name && email && email.includes('@')) {
                // Save basic info and show path selection
                formData.name = name;
                formData.email = email;
                
                // Send welcome email
                sendWelcomeEmail(name, email);
                
                currentStep = 2;
                updateProgressDisplay();
                
                setTimeout(() => {
                    document.getElementById('pathSelection').classList.remove('hidden');
                    document.getElementById('pathSelection').scrollIntoView({ behavior: 'smooth' });
                }, 500);
            }
        }

        // ===== AUTH FORM HANDLER =====
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Smart Mom Method - Airtable Integration loaded!');
            
            // Check for existing session
            checkExistingSession();
            
            // Load saved language
            const savedLanguage = localStorage.getItem('smartMomLanguage');
            if (savedLanguage) {
                changeLanguage(savedLanguage);
            }
            
            // Setup form validation
            document.getElementById('user-name').addEventListener('input', checkBasicInfoComplete);
            document.getElementById('user-email').addEventListener('input', checkBasicInfoComplete);
            
            // Setup auth form
            document.getElementById('authForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const submitBtn = document.getElementById('authSubmitBtn');
                const originalText = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<div class="loading-spinner"></div>Processing...';
                
                try {
                    const email = document.getElementById('authEmail').value;
                    const password = document.getElementById('authPassword').value;
                    
                    if (authMode === 'signup') {
                        const name = document.getElementById('authName').value;
                        const confirmPassword = document.getElementById('authConfirmPassword').value;
                        
                        if (password !== confirmPassword) {
                            throw new Error('Passwords do not match');
                        }
                        
                        if (password.length < 6) {
                            throw new Error('Password must be at least 6 characters');
                        }
                        
                        // Check if user already exists
                        const existingUser = await findUserByEmail(email);
                        if (existingUser) {
                            throw new Error('An account with this email already exists');
                        }
                        
                        await createUser(email, password, name);
                        showAuthSuccess('Account created successfully!');
                        
                        setTimeout(() => {
                            closeAuthModal();
                        }, 2000);
                        
                    } else {
                        await signIn(email, password);
                        showAuthSuccess('Signed in successfully!');
                        
                        setTimeout(() => {
                            closeAuthModal();
                        }, 2000);
                    }
                    
                } catch (error) {
                    showAuthError(error.message);
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                }
            });
        });

        // Make functions globally accessible
        window.startOnboarding = startOnboarding;
        window.showAuthModal = showAuthModal;
        window.handleReturningUser = handleReturningUser;
        window.closeAuthModal = closeAuthModal;
        window.toggleAuthMode = toggleAuthMode;
        window.signOut = signOut;
        window.changeLanguage = changeLanguage;
        window.validateField = validateField;
        window.updateCharCount = updateCharCount;
        window.selectPath = selectPath;
        window.showBusinessQuestionnaire = showBusinessQuestionnaire;
        window.proceedWithQuestionnaire = proceedWithQuestionnaire;
        window.proceedToAIWorkflow = proceedToAIWorkflow;
        window.testAirtableConnection = testAirtableConnection;
        window.startOver = startOver;
        window.skipToPaymentOptions = skipToPaymentOptions;
        window.returnToPlanningProcess = returnToPlanningProcess;
        window.scrollToForm = scrollToForm;
        
        // AI Workflow Functions
        window.generateChatGPTPrompt = generateChatGPTPrompt;
        window.copyToClipboard = copyToClipboard;
        window.openChatGPT = openChatGPT;
        window.openGemini = openGemini;
        window.openClaude = openClaude;
        window.checkResponseAndEnableNext = checkResponseAndEnableNext;
        window.checkCalendarCodeAndEnableFinish = checkCalendarCodeAndEnableFinish;
        window.generateNextPrompt = generateNextPrompt;
        window.goBackToStep = goBackToStep;
        window.finishAIWorkflow = finishAIWorkflow;
        window.previewCalendar = previewCalendar;
        window.downloadCompletePackage = downloadCompletePackage;
        
        // Calendar System Functions
        window.parseAndDisplayCalendar = parseAndDisplayCalendar;
        window.showInteractiveCalendar = showInteractiveCalendar;
        window.showWeek = showWeek;
        window.toggleTaskCompletion = toggleTaskCompletion;
        window.toggleStepCompletion = toggleStepCompletion;
        window.downloadCalendarProgress = downloadCalendarProgress;
        window.printCalendar = printCalendar;
        window.resetCalendarProgress = resetCalendarProgress;
        
        // Interactive AI Prompt Generation Functions
        window.selectPromptTemplate = selectPromptTemplate;
        window.toggleAdvancedOptions = toggleAdvancedOptions;
        window.generateInteractivePrompt = generateInteractivePrompt;
        window.updatePromptPreview = updatePromptPreview;
        window.resetPromptToDefault = resetPromptToDefault;
        window.initializePromptGeneration = initializePromptGeneration;
        window.updateContextVariables = updateContextVariables;
        
        // Calendar Access Management Functions
        window.showCalendarAccessButton = showCalendarAccessButton;
        window.hideCalendarAccessButton = hideCalendarAccessButton;
        window.checkForExistingCalendar = checkForExistingCalendar;

        console.log('🚀 Smart Mom Method with complete Airtable integration ready!');
    </script>
</body>
</html>
